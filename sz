<!DOCTYPE html>

<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="app-name" content="ZeaUnified">
  <meta name="version" content="4.0">
  <title>ZeaUnified - SaldoZea & ZeaCrew</title>

  <!-- PWA Manifest -->

  <link rel="manifest" href="data:application/json;charset=utf-8,%7B%22name%22%3A%20%22ZeaUnified%20by%20ZeaProperty%22%2C%20%22short_name%22%3A%20%22ZeaUnified%22%2C%20%22start_url%22%3A%20%22.%22%2C%20%22display%22%3A%20%22standalone%22%2C%20%22background_color%22%3A%20%220f1117%22%2C%20%22theme_color%22%3A%20%220d2a5e%22%2C%20%22orientation%22%3A%20%22any%22%7D">
  <meta name="theme-color" content="#0d2a5e">

  <!-- Firebase SDK -->

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <style>
  /* ============================================================
     UNIFIED DARK THEME - ZeaUnified v4.0
     ============================================================ */
  :root {
    --bg-primary: #0f1117;
    --bg-secondary: #1a1d27;
    --bg-card: #1e2130;
    --bg-input: #252838;
    --bg-input-focus: #2a2e42;
    --text-primary: #e2e8f0;
    --text-secondary: #94a3b8;
    --text-muted: #64748b;
    --text-dim: #475569;
    --border-color: #2d3348;
    --border-light: #3d4460;
    --accent-1: #6366f1;
    --accent-success: #10b981;
    --accent-danger: #ef4444;
    --accent-warning: #f59e0b;
    --accent-cyan: #06b6d4;
    --accent-pink: #ec4899;
    --accent-purple: #a855f7;
    --gradient-primary: linear-gradient(135deg, #6366f1, #8b5cf6);
    --gradient-success: linear-gradient(135deg, #10b981, #059669);
    --gradient-danger: linear-gradient(135deg, #ef4444, #dc2626);
    --gradient-warning: linear-gradient(135deg, #f59e0b, #d97706);
    --gradient-secondary: linear-gradient(135deg, #06b6d4, #0891b2);
    --gradient-card: linear-gradient(180deg, #1e2130 0%, #1a1d27 100%);
    --gradient-glass: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
    --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.3);
    --shadow-lg: 0 10px 25px -5px rgba(0,0,0,0.4);
    --shadow-glow: 0 0 40px rgba(99,102,241,0.15);
    --radius-sm: 6px;
    --radius-md: 10px;
    --radius-lg: 14px;
    --radius-xl: 18px;
    --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
    line-height: 1.5;
  }
  
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg-secondary); }
  ::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 3px; }
  
  /* ============================================================
     UNIFIED LOGIN SCREEN - AGGRESSIVE Z-INDEX FOR SAFARI
     ============================================================ */
  .login-screen {
    position: fixed;
    inset: 0;
    z-index: 999999 !important;
    background: var(--bg-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1.5rem;
    background-image: radial-gradient(ellipse at 20% 50%, rgba(99,102,241,0.12) 0%, transparent 60%),
                      radial-gradient(ellipse at 80% 20%, rgba(139,92,246,0.1) 0%, transparent 50%);
  }
  
  .login-screen.hidden { display: none !important; }
  
  .login-box {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-xl);
    padding: 2.5rem 2rem;
    width: 100%;
    max-width: 420px;
    box-shadow: var(--shadow-lg), var(--shadow-glow);
    position: relative;
    overflow: hidden;
  }
  
  .login-box::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient-primary);
  }
  
  .login-logo { text-align: center; margin-bottom: 2rem; }
  .login-logo-icon {
    width: 72px;
    height: 72px;
    border-radius: var(--radius-lg);
    background: var(--gradient-primary);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    font-weight: 800;
    color: white;
    box-shadow: 0 8px 25px rgba(99,102,241,0.4);
    margin-bottom: 1rem;
  }
  .login-logo-title { font-size: 1.5rem; font-weight: 800; color: var(--text-primary); }
  .login-logo-sub { font-size: 0.75rem; color: var(--text-muted); letter-spacing: 1.5px; text-transform: uppercase; margin-top: 0.25rem; }
  
  .login-form { display: flex; flex-direction: column; gap: 1rem; }
  
  .login-input-wrap { position: relative; }
  .login-input-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); font-size: 1rem; color: var(--text-muted); pointer-events: none; }
  
  .login-input {
    width: 100%;
    padding: 0.9rem 1rem 0.9rem 2.75rem;
    background: var(--bg-input);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: 16px !important; /* iOS: prevent auto-zoom */
    font-family: inherit;
    transition: var(--transition);
    letter-spacing: 0.5px;
  }
  
  .login-input:focus {
    outline: none;
    border-color: var(--accent-1);
    background: var(--bg-input-focus);
    box-shadow: 0 0 0 4px rgba(99,102,241,0.15);
  }
  
  .login-input::placeholder { color: var(--text-dim); letter-spacing: 0; }
  
  .login-btn {
    width: 100%;
    padding: 1rem;
    background: var(--gradient-primary);
    border: none;
    border-radius: var(--radius-md);
    color: white;
    font-size: 16px !important; /* iOS: prevent auto-zoom */
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition);
    box-shadow: 0 4px 15px rgba(99,102,241,0.4);
    font-family: inherit;
    letter-spacing: 0.5px;
  }
  
  .login-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(99,102,241,0.5); }
  .login-btn:active { transform: translateY(0); }
  
  .login-error {
    background: rgba(239,68,68,0.15);
    border: 1px solid var(--accent-danger);
    border-radius: var(--radius-md);
    padding: 0.75rem 1rem;
    color: var(--accent-danger);
    font-size: 0.85rem;
    font-weight: 600;
    text-align: center;
    display: none;
  }
  .login-error.show { display: block; animation: fadeSlideIn 0.3s ease; }
  
  .login-footer { text-align: center; margin-top: 1.5rem; font-size: 0.7rem; color: var(--text-dim); }
  
  .app-selector {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
  }
  
  .app-selector-btn {
    flex: 1;
    padding: 0.75rem;
    background: var(--bg-input);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    color: var(--text-secondary);
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
  }
  
  .app-selector-btn:hover { border-color: var(--accent-1); color: var(--text-primary); }
  .app-selector-btn.active { background: var(--gradient-primary); border-color: var(--accent-1); color: white; }
  
  /* ============================================================
     MAIN APP CONTAINER
     ============================================================ */
  .app-container { display: none; min-height: 100vh; }
  .app-container.active { display: block; }
  
  /* ============================================================
     HEADER
     ============================================================ */
  .header {
    background: linear-gradient(135deg, rgba(99,102,241,0.95) 0%, rgba(139,92,246,0.95) 50%, rgba(168,85,247,0.95) 100%);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    padding: 1rem 1.5rem;
    position: sticky;
    top: 36px;
    z-index: 100;
    box-shadow: var(--shadow-lg), var(--shadow-glow);
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  
  .header-content {
    max-width: 1600px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }
  
  .logo { display: flex; align-items: center; gap: 0.75rem; }
  .logo-icon {
    width: 45px;
    height: 45px;
    background: rgba(255,255,255,0.2);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    font-weight: 800;
    color: white;
  }
  .logo-text { display: flex; flex-direction: column; }
  .logo-title { font-size: 1.4rem; font-weight: 800; color: white; letter-spacing: -0.5px; }
  .logo-subtitle { font-size: 0.75rem; color: rgba(255,255,255,0.85); font-weight: 500; letter-spacing: 1px; }
  
  .header-info { display: flex; gap: 1.5rem; align-items: center; }
  .header-stat {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    padding: 0.5rem 1rem;
    background: rgba(255,255,255,0.15);
    border-radius: var(--radius-md);
  }
  .header-stat-label { font-size: 0.65rem; color: rgba(255,255,255,0.7); text-transform: uppercase; letter-spacing: 0.5px; }
  .header-stat-value { font-size: 1.1rem; font-weight: 700; color: white; }
  .header-time { display: flex; flex-direction: column; align-items: flex-end; }
  .header-date { font-size: 0.8rem; color: rgba(255,255,255,0.8); }
  .header-clock { font-size: 1.3rem; font-weight: 700; color: white; font-variant-numeric: tabular-nums; }
  
  /* ============================================================
     NAVIGATION
     ============================================================ */
  .nav {
    background: var(--bg-secondary);
    border-bottom: 1px solid var(--border-color);
    overflow-x: auto;
    position: sticky;
    top: 113px;
    z-index: 99;
    -webkit-overflow-scrolling: touch;
  }
  .nav::-webkit-scrollbar { height: 0; }
  
  .nav-content {
    max-width: 1600px;
    margin: 0 auto;
    display: flex;
    padding: 0 1rem;
  }
  
  .nav-btn {
    padding: 1rem 1.5rem;
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 600;
    transition: var(--transition);
    border-bottom: 3px solid transparent;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    position: relative;
    touch-action: manipulation;
  }
  
  .nav-btn:hover { color: var(--text-primary); background: rgba(99,102,241,0.1); }
  .nav-btn.active {
    color: var(--accent-1);
    border-bottom-color: var(--accent-1);
    background: linear-gradient(180deg, rgba(99,102,241,0.15) 0%, transparent 100%);
  }
  .nav-btn .badge-count {
    position: absolute;
    top: 8px;
    right: 8px;
    background: var(--accent-danger);
    color: white;
    font-size: 0.65rem;
    padding: 2px 6px;
    border-radius: 10px;
    font-weight: 700;
  }
  
  /* ============================================================
     MAIN CONTENT
     ============================================================ */
  .main { max-width: 1600px; margin: 0 auto; padding: 1.5rem; padding-bottom: 100px; }
  
  .tab-content { display: none; }
  .tab-content.active { display: block; animation: fadeSlideIn 0.4s ease; }
  
  @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  
  /* ============================================================
     CARDS
     ============================================================ */
  .card {
    background: var(--gradient-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    margin-bottom: 1rem;
    box-shadow: var(--shadow-md);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
  }
  
  .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: var(--gradient-glass);
  }
  
  .card:hover { border-color: var(--border-light); box-shadow: var(--shadow-lg); }
  
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.25rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-color);
  }
  
  .card-title { font-size: 1.1rem; font-weight: 700; display: flex; align-items: center; gap: 0.6rem; color: var(--text-primary); }
  .card-title-icon { width: 36px; height: 36px; border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }
  .card-title-icon.primary { background: rgba(99,102,241,0.2); }
  .card-title-icon.success { background: rgba(16,185,129,0.2); }
  .card-title-icon.danger { background: rgba(239,68,68,0.2); }
  .card-title-icon.warning { background: rgba(245,158,11,0.2); }
  .card-title-icon.cyan { background: rgba(6,182,212,0.2); }
  
  /* ============================================================
     STATS & DASHBOARD
     ============================================================ */
  .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
  
  .stat-card {
    background: var(--gradient-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: 1.25rem;
    position: relative;
    overflow: hidden;
    transition: var(--transition);
  }
  
  .stat-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
  .stat-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--gradient-primary); }
  .stat-card.success::before { background: var(--gradient-success); }
  .stat-card.danger::before { background: var(--gradient-danger); }
  .stat-card.warning::before { background: var(--gradient-warning); }
  .stat-card.cyan::before { background: var(--gradient-secondary); }
  
  .stat-card-inner { display: flex; justify-content: space-between; align-items: flex-start; }
  
  .stat-icon {
    width: 50px;
    height: 50px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    background: rgba(99,102,241,0.15);
  }
  
  .stat-card.success .stat-icon { background: rgba(16,185,129,0.15); }
  .stat-card.danger .stat-icon { background: rgba(239,68,68,0.15); }
  .stat-card.warning .stat-icon { background: rgba(245,158,11,0.15); }
  .stat-card.cyan .stat-icon { background: rgba(6,182,212,0.15); }
  
  .stat-content { flex: 1; }
  .stat-label { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.75px; font-weight: 600; margin-bottom: 0.4rem; }
  .stat-value {
    font-size: 1.6rem;
    font-weight: 800;
    line-height: 1.2;
    margin-bottom: 0.5rem;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    word-break: break-all;
  }
  
  .stat-card.success .stat-value { background: var(--gradient-success); -webkit-background-clip: text; background-clip: text; }
  .stat-card.danger .stat-value { background: var(--gradient-danger); -webkit-background-clip: text; background-clip: text; }
  .stat-card.warning .stat-value { background: var(--gradient-warning); -webkit-background-clip: text; background-clip: text; }
  .stat-card.cyan .stat-value { background: var(--gradient-secondary); -webkit-background-clip: text; background-clip: text; }
  
  .stat-breakdown { display: flex; gap: 0.75rem; font-size: 0.7rem; color: var(--text-muted); flex-wrap: wrap; }
  .stat-breakdown-item { display: flex; align-items: center; gap: 0.3rem; padding: 0.25rem 0.5rem; background: var(--bg-input); border-radius: var(--radius-sm); }
  .stat-breakdown-item.cash { border-left: 2px solid var(--accent-success); }
  .stat-breakdown-item.transfer { border-left: 2px solid var(--accent-1); }
  .stat-breakdown-item.qr { border-left: 2px solid var(--accent-cyan); }
  
  /* ============================================================
     FORMS - iOS: min 16px to prevent zoom
     ============================================================ */
  .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; }
  .form-group { display: flex; flex-direction: column; gap: 0.5rem; }
  .form-group.full-width { grid-column: 1 / -1; }
  
  .form-label { font-size: 0.8rem; color: var(--text-secondary); font-weight: 600; display: flex; align-items: center; gap: 0.4rem; }
  .form-label .required { color: var(--accent-danger); }
  
  .form-input, .form-select, .form-textarea {
    padding: 0.875rem 1rem;
    background: var(--bg-input);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: 16px !important; /* iOS: prevent auto-zoom */
    font-family: inherit;
    transition: var(--transition);
    -webkit-appearance: none;
    appearance: none;
  }
  
  .form-input:focus, .form-select:focus, .form-textarea:focus {
    outline: none;
    border-color: var(--accent-1);
    background: var(--bg-input-focus);
    box-shadow: 0 0 0 4px rgba(99,102,241,0.15);
  }
  
  .form-input::placeholder { color: var(--text-dim); }
  .form-input.readonly { background: var(--bg-secondary); color: var(--text-muted); cursor: not-allowed; }
  
  .form-select {
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2394a3b8' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    padding-right: 2.5rem;
  }
  
  .form-hint { font-size: 0.7rem; color: var(--text-muted); margin-top: -0.25rem; }
  
  /* ============================================================
     BUTTONS
     ============================================================ */
  .btn {
    padding: 0.875rem 1.5rem;
    border: none;
    border-radius: var(--radius-md);
    font-size: 16px !important; /* iOS: prevent auto-zoom */
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-family: inherit;
    touch-action: manipulation;
  }
  
  .btn-primary { background: var(--gradient-primary); color: white; box-shadow: 0 4px 15px rgba(99,102,241,0.35); }
  .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(99,102,241,0.45); }
  
  .btn-success { background: var(--gradient-success); color: white; box-shadow: 0 4px 15px rgba(16,185,129,0.35); }
  .btn-success:hover { transform: translateY(-3px); }
  
  .btn-danger { background: var(--gradient-danger); color: white; box-shadow: 0 4px 15px rgba(239,68,68,0.35); }
  .btn-danger:hover { transform: translateY(-3px); }
  
  .btn-warning { background: var(--gradient-warning); color: white; }
  .btn-secondary { background: var(--bg-input); color: var(--text-primary); border: 2px solid var(--border-color); }
  .btn-secondary:hover { border-color: var(--accent-1); }
  
  .btn-sm { padding: 0.5rem 1rem; font-size: 14px !important; }
  .btn-lg { padding: 1rem 2rem; font-size: 16px !important; }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }
  .btn-group { display: flex; gap: 0.75rem; flex-wrap: wrap; }
  
  /* ============================================================
     TABLES
     ============================================================ */
  .table-container { overflow-x: auto; border-radius: var(--radius-lg); border: 1px solid var(--border-color); background: var(--bg-card); -webkit-overflow-scrolling: touch; }
  table { width: 100%; border-collapse: collapse; }
  th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border-color); }
  th { background: var(--bg-input); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.75px; color: var(--text-secondary); font-weight: 700; white-space: nowrap; }
  tr:hover { background: rgba(99,102,241,0.05); }
  tr:last-child td { border-bottom: none; }
  td { font-size: 0.8rem; }
  .table-empty { text-align: center; padding: 3rem; color: var(--text-muted); }
  
  /* ============================================================
     BADGES
     ============================================================ */
  .badge { display: inline-flex; align-items: center; gap: 0.3rem; padding: 0.3rem 0.6rem; border-radius: 20px; font-size: 0.65rem; font-weight: 700; }
  .badge-primary { background: rgba(99,102,241,0.2); color: var(--accent-1); }
  .badge-success { background: rgba(16,185,129,0.2); color: var(--accent-success); }
  .badge-danger { background: rgba(239,68,68,0.2); color: var(--accent-danger); }
  .badge-warning { background: rgba(245,158,11,0.2); color: var(--accent-warning); }
  .badge-cyan { background: rgba(6,182,212,0.2); color: var(--accent-cyan); }
  .badge-purple { background: rgba(168,85,247,0.2); color: var(--accent-purple); }
  
  /* ============================================================
     MODALS - AGGRESSIVE Z-INDEX FOR SAFARI
     ============================================================ */
  .modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 99999 !important;
    padding: 1rem;
  }
  
  .modal-overlay.active { display: flex; }
  
  .modal {
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    max-width: 700px;
    width: 100%;
    max-height: 90vh;
    overflow: hidden;
    border: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
  }
  
  .modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--bg-input);
  }
  
  .modal-title { font-size: 1.25rem; font-weight: 700; }
  
  .modal-close {
    width: 40px;
    height: 40px;
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    color: var(--text-secondary);
    font-size: 1.25rem;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    touch-action: manipulation;
  }
  
  .modal-close:hover { background: var(--accent-danger); color: white; }
  .modal-body { padding: 1.5rem; overflow-y: auto; flex: 1; -webkit-overflow-scrolling: touch; }
  .modal-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 0.75rem; }
  
  /* ============================================================
     TOASTS
     ============================================================ */
  .toast-container {
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 99998 !important;
    display: flex;
    flex-direction: column;
    gap: 12px;
    pointer-events: none;
  }
  
  .toast {
    padding: 1rem 1.5rem;
    border-radius: var(--radius-md);
    color: white;
    font-weight: 600;
    animation: toastSlideIn 0.4s cubic-bezier(0.4,0,0.2,1);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    box-shadow: var(--shadow-lg);
    max-width: 400px;
    cursor: pointer;
    pointer-events: auto;
  }
  
  .toast.success { background: linear-gradient(135deg, rgba(16,185,129,0.95), rgba(5,150,105,0.95)); }
  .toast.error { background: linear-gradient(135deg, rgba(239,68,68,0.95), rgba(220,38,38,0.95)); }
  .toast.warning { background: linear-gradient(135deg, rgba(245,158,11,0.95), rgba(217,119,6,0.95)); }
  .toast.info { background: linear-gradient(135deg, rgba(99,102,241,0.95), rgba(139,92,246,0.95)); }
  .toast.boss { background: linear-gradient(135deg, rgba(168,85,247,0.97), rgba(139,92,246,0.97)); font-size: 1rem; }
  
  @keyframes toastSlideIn { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
  
  /* ============================================================
     ROLE BADGES
     ============================================================ */
  .role-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.4rem 0.9rem;
    border-radius: var(--radius-md);
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.5px;
    border: 1.5px solid;
  }
  
  .role-badge.supreme { background: rgba(168,85,247,0.2); color: #c084fc; border-color: #c084fc; }
  .role-badge.owner { background: rgba(245,158,11,0.2); color: var(--accent-warning); border-color: var(--accent-warning); }
  .role-badge.admin { background: rgba(6,182,212,0.2); color: var(--accent-cyan); border-color: var(--accent-cyan); }
  .role-badge.crew { background: rgba(16,185,129,0.2); color: var(--accent-success); border-color: var(--accent-success); }
  .role-badge.leader { background: rgba(99,102,241,0.2); color: var(--accent-1); border-color: var(--accent-1); }
  .role-badge.staff { background: rgba(100,116,139,0.2); color: var(--text-secondary); border-color: var(--text-secondary); }
  .role-badge.marketing { background: rgba(236,72,153,0.2); color: var(--accent-pink); border-color: var(--accent-pink); }
  
  .logout-btn {
    padding: 0.4rem 0.9rem;
    background: rgba(239,68,68,0.15);
    border: 1.5px solid var(--accent-danger);
    border-radius: var(--radius-md);
    color: var(--accent-danger);
    font-size: 0.75rem;
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition);
    font-family: inherit;
    touch-action: manipulation;
  }
  
  .logout-btn:hover { background: var(--accent-danger); color: white; }
  
  .crew-banner {
    background: linear-gradient(135deg, rgba(16,185,129,0.15), rgba(6,182,212,0.1));
    border-bottom: 1px solid rgba(16,185,129,0.3);
    padding: 0.5rem 1.5rem;
    text-align: center;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--accent-success);
    letter-spacing: 0.5px;
    display: none;
  }
  .crew-banner.show { display: block; }
  
  body.crew-mode .crew-hide { display: none !important; }
  body.crew-mode .quick-action-btn.success,
  body.crew-mode .quick-action-btn.danger { display: none !important; }
  body.crew-mode [data-crew-hide] { display: none !important; }
  
  /* ============================================================
     CONNECTION STATUS
     ============================================================ */
  .connection-status {
    position: fixed;
    top: 80px;
    right: 20px;
    padding: 0.75rem 1rem;
    border-radius: var(--radius-md);
    font-size: 0.85rem;
    font-weight: 600;
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: var(--transition);
  }
  
  .connection-status.online { background: rgba(16,185,129,0.2); color: var(--accent-success); border: 1px solid var(--accent-success); }
  .connection-status.offline { background: rgba(239,68,68,0.2); color: var(--accent-danger); border: 1px solid var(--accent-danger); }
  .connection-status.connecting { background: rgba(245,158,11,0.2); color: var(--accent-warning); border: 1px solid var(--accent-warning); }
  
  /* ============================================================
     LED MOVING SIGN
     ============================================================ */
  .led-bar {
    width: 100%;
    overflow: hidden;
    position: relative;
    z-index: 101;
    padding: 0;
    display: flex;
    align-items: center;
    background: #0a0a0a;
    border-bottom: 2px solid;
    height: 36px;
    flex-shrink: 0;
  }
  
  .led-bar-inner {
    display: flex;
    align-items: center;
    white-space: nowrap;
    will-change: transform;
    animation: ledScroll 28s linear infinite;
    font-family: 'Courier New', Courier, monospace;
    font-size: 0.88rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-shadow: 0 0 8px currentColor, 0 0 16px currentColor;
    padding-right: 80px;
  }
  
  @keyframes ledScroll {
    0% { transform: translateX(100vw); }
    100% { transform: translateX(-100%); }
  }
  
  .led-bar.paused .led-bar-inner { animation-play-state: paused; }
  
  .led-green { border-color: #00ff41; color: #00ff41; }
  .led-red { border-color: #ff2200; color: #ff2200; }
  .led-amber { border-color: #ffb300; color: #ffb300; }
  .led-cyan { border-color: #00e5ff; color: #00e5ff; }
  .led-pink { border-color: #ff4da6; color: #ff4da6; }
  .led-white { border-color: #e2e8f0; color: #e2e8f0; }
  .led-purple { border-color: #c084fc; color: #c084fc; }
  
  /* ============================================================
     UNIT GRID
     ============================================================ */
  .unit-section { margin-bottom: 2rem; }
  .unit-section-title {
    font-size: 1rem;
    font-weight: 700;
    color: var(--text-secondary);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--border-color);
  }
  .unit-section-title .count { background: var(--bg-input); padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; }
  
  .unit-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 0.75rem; }
  
  .unit-card {
    background: var(--bg-card);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    padding: 1rem;
    transition: var(--transition);
    cursor: pointer;
    position: relative;
    overflow: hidden;
    touch-action: manipulation;
  }
  
  .unit-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
  .unit-card.available { border-color: var(--accent-success); background: linear-gradient(135deg, rgba(16,185,129,0.08) 0%, transparent 100%); }
  .unit-card.occupied { border-color: var(--accent-danger); background: linear-gradient(135deg, rgba(239,68,68,0.08) 0%, transparent 100%); }
  .unit-card.checkout-soon { border-color: var(--accent-warning); background: linear-gradient(135deg, rgba(245,158,11,0.08) 0%, transparent 100%); animation: pulse 2s infinite; }
  
  @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.8; } }
  
  .unit-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem; }
  .unit-number { font-weight: 800; font-size: 1.1rem; color: var(--text-primary); }
  .unit-type-badge { font-size: 0.6rem; padding: 0.2rem 0.5rem; border-radius: 4px; font-weight: 700; background: var(--bg-input); color: var(--text-secondary); }
  .unit-status { font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 0.3rem; }
  .unit-card.available .unit-status { color: var(--accent-success); }
  .unit-card.occupied .unit-status { color: var(--accent-danger); }
  .unit-card.checkout-soon .unit-status { color: var(--accent-warning); }
  .unit-info { margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border-color); font-size: 0.7rem; color: var(--text-secondary); }
  .unit-guest { display: flex; align-items: center; gap: 0.3rem; margin-bottom: 0.25rem; }
  .unit-timer { display: flex; align-items: center; gap: 0.3rem; font-weight: 700; color: var(--accent-warning); }
  
  /* ============================================================
     FILTER SECTION
     ============================================================ */
  .filter-section {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    padding: 1.25rem;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-color);
    margin-bottom: 1.5rem;
    align-items: flex-end;
  }
  
  .filter-section .form-group { min-width: 160px; flex: 1; }
  
  /* ============================================================
     QUICK ACTIONS
     ============================================================ */
  .quick-actions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-color);
  }
  
  .quick-action-btn {
    padding: 0.75rem 1.25rem;
    background: var(--bg-input);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    touch-action: manipulation;
  }
  
  .quick-action-btn:hover { background: var(--accent-1); border-color: var(--accent-1); transform: translateY(-2px); box-shadow: 0 4px 15px rgba(99,102,241,0.3); }
  .quick-action-btn.success:hover { background: var(--accent-success); border-color: var(--accent-success); }
  .quick-action-btn.danger:hover { background: var(--accent-danger); border-color: var(--accent-danger); }
  
  /* ============================================================
     PRICE DISPLAY
     ============================================================ */
  .price-display {
    background: linear-gradient(135deg, rgba(99,102,241,0.15) 0%, rgba(139,92,246,0.1) 100%);
    border: 2px solid var(--accent-1);
    border-radius: var(--radius-lg);
    padding: 1.25rem;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  
  .price-display::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: var(--gradient-primary); }
  .price-display .label { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem; font-weight: 600; }
  .price-display .value { font-size: 2rem; font-weight: 800; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
  
  /* ============================================================
     PAYMENT SPLIT
     ============================================================ */
  .payment-split { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; }
  .payment-split-item { text-align: center; padding: 1rem; background: var(--bg-input); border-radius: var(--radius-md); border: 1px solid var(--border-color); }
  .payment-split-item .icon { font-size: 1.5rem; margin-bottom: 0.5rem; }
  .payment-split-item .amount { font-size: 1.1rem; font-weight: 700; }
  .payment-split-item .label { font-size: 0.7rem; color: var(--text-secondary); text-transform: uppercase; }
  .payment-split-item.cash .amount { color: var(--accent-success); }
  .payment-split-item.transfer .amount { color: var(--accent-1); }
  .payment-split-item.qr .amount { color: var(--accent-cyan); }
  
  /* ============================================================
     TOP LISTS
     ============================================================ */
  .top-list { display: flex; flex-direction: column; gap: 0.5rem; }
  .top-list-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; background: var(--bg-input); border-radius: var(--radius-md); }
  .top-list-item .rank { font-size: 1.25rem; margin-right: 0.75rem; }
  .top-list-item .name { flex: 1; font-weight: 600; }
  .top-list-item .value { font-weight: 700; color: var(--accent-1); }
  
  /* ============================================================
     CHECKOUT ALERT
     ============================================================ */
  .checkout-alert {
    background: linear-gradient(135deg, rgba(245,158,11,0.15) 0%, rgba(217,119,6,0.1) 100%);
    border: 1px solid var(--accent-warning);
    border-radius: var(--radius-lg);
    padding: 1rem 1.25rem;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  
  .checkout-alert-icon { font-size: 2rem; animation: bounce 1s infinite; }
  @keyframes bounce { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
  
  .checkout-alert-content { flex: 1; }
  .checkout-alert-title { font-weight: 700; color: var(--accent-warning); margin-bottom: 0.25rem; }
  .checkout-alert-list { font-size: 0.85rem; color: var(--text-secondary); }
  
  /* ============================================================
     ALARM OVERLAY
     ============================================================ */
  .alarm-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(239,68,68,0.12);
    backdrop-filter: blur(3px);
    -webkit-backdrop-filter: blur(3px);
    z-index: 8888;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }
  
  .alarm-overlay.active { display: flex; animation: alarmFlash 0.6s ease infinite alternate; }
  @keyframes alarmFlash { from { background: rgba(239,68,68,0.08); } to { background: rgba(239,68,68,0.22); } }
  
  .alarm-card {
    background: var(--bg-card);
    border: 3px solid var(--accent-danger);
    border-radius: var(--radius-xl);
    padding: 2rem;
    text-align: center;
    max-width: 420px;
    width: 100%;
    box-shadow: 0 0 70px rgba(239,68,68,0.45);
  }
  
  .alarm-icon { font-size: 4rem; margin-bottom: 0.75rem; animation: alarmShake 0.4s infinite; }
  @keyframes alarmShake { 0%,100% { transform: rotate(-8deg); } 50% { transform: rotate(8deg); } }
  .alarm-title { font-size: 1.6rem; font-weight: 800; color: var(--accent-danger); margin-bottom: 0.5rem; }
  .alarm-units { font-size: 1rem; color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.7; }
  
  /* ============================================================
     NOTIFICATION TOGGLE
     ============================================================ */
  .notif-toggle {
    position: fixed;
    bottom: 28px;
    left: 24px;
    z-index: 9998;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    transition: var(--transition);
    box-shadow: var(--shadow-lg);
    touch-action: manipulation;
  }
  
  .notif-toggle.on { background: linear-gradient(135deg, #10b981, #059669); box-shadow: 0 4px 20px rgba(16,185,129,0.55); animation: notifPulse 2.5s infinite; }
  .notif-toggle.off { background: var(--bg-input); border: 2px solid var(--border-light); filter: grayscale(1) opacity(0.6); }
  
  @keyframes notifPulse { 0%,100% { box-shadow: 0 4px 20px rgba(16,185,129,0.5); } 50% { box-shadow: 0 4px 32px rgba(16,185,129,0.85); } }
  
  /* ============================================================
     BUG REPORT BUTTON
     ============================================================ */
  .report-bug-btn {
    position: fixed;
    bottom: 28px;
    right: 24px;
    z-index: 9997;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0 1.2rem 0 0.9rem;
    height: 48px;
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border: none;
    border-radius: 24px;
    color: white;
    font-size: 0.82rem;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 4px 16px rgba(239,68,68,0.45);
    transition: var(--transition);
    font-family: inherit;
    letter-spacing: 0.3px;
    touch-action: manipulation;
    white-space: nowrap;
  }
  
  .report-bug-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 24px rgba(239,68,68,0.6); }
  .report-bug-btn:active { transform: translateY(0); }
  
  /* ============================================================
     ONLINE PANEL
     ============================================================ */
  .online-panel { position: fixed; top: 140px; right: 20px; z-index: 990; display: flex; flex-direction: column; gap: 6px; pointer-events: none; }
  
  .online-pill {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.72rem;
    font-weight: 700;
    border: 1px solid;
    animation: pillIn 0.4s cubic-bezier(0.4,0,0.2,1);
    pointer-events: auto;
    white-space: nowrap;
    box-shadow: var(--shadow-md);
  }
  
  @keyframes pillIn { from { opacity: 0; transform: translateX(60px); } to { opacity: 1; transform: translateX(0); } }
  
  .online-pill.supreme { background: rgba(168,85,247,0.2); color: #c084fc; border-color: rgba(192,132,252,0.5); }
  .online-pill.owner { background: rgba(245,158,11,0.2); color: #fbbf24; border-color: rgba(251,191,36,0.5); }
  .online-pill.admin { background: rgba(6,182,212,0.2); color: #22d3ee; border-color: rgba(34,211,238,0.5); }
  .online-pill.crew { background: rgba(16,185,129,0.2); color: #34d399; border-color: rgba(52,211,153,0.5); }
  .online-pill.leader { background: rgba(99,102,241,0.2); color: #818cf8; border-color: rgba(129,140,248,0.5); }
  .online-pill.staff { background: rgba(100,116,139,0.2); color: #94a3b8; border-color: rgba(148,163,184,0.5); }
  .online-pill.marketing { background: rgba(236,72,153,0.2); color: #f472b6; border-color: rgba(244,114,182,0.5); }
  
  .online-dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; animation: dotPulse 1.8s ease infinite; flex-shrink: 0; }
  @keyframes dotPulse { 0%,100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.7); } }
  .online-pill.supreme .online-dot, .online-pill.owner .online-dot { animation: dotPulse 1s ease infinite; }
  
  /* ============================================================
     EMPTY STATE
     ============================================================ */
  .empty-state { text-align: center; padding: 2rem; color: var(--text-muted); }
  .empty-state-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }
  .empty-state-text { font-size: 0.9rem; }
  
  /* ============================================================
     SUPREME SECTION
     ============================================================ */
  .supreme-section { margin-bottom: 2rem; }
  .supreme-section-title {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--text-muted);
    font-weight: 700;
    padding: 0 0 0.75rem 0;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .led-color-grid { display: flex; flex-wrap: wrap; gap: 0.75rem; margin-top: 0.75rem; }
  .led-color-btn {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-md);
    border: 3px solid transparent;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    touch-action: manipulation;
    box-shadow: 0 0 12px currentColor;
  }
  .led-color-btn:hover { transform: scale(1.15); }
  .led-color-btn.active { border-color: white; transform: scale(1.15); }
  
  .led-preview {
    background: #0a0a0a;
    border-radius: var(--radius-md);
    padding: 1rem 1.5rem;
    overflow: hidden;
    position: relative;
    margin-top: 1rem;
    min-height: 52px;
    display: flex;
    align-items: center;
    border: 2px solid var(--border-color);
  }
  
  .led-preview-inner {
    font-family: 'Courier New', Courier, monospace;
    font-size: 1rem;
    font-weight: 700;
    letter-spacing: 2px;
    white-space: nowrap;
    text-shadow: 0 0 8px currentColor, 0 0 16px currentColor;
    animation: ledScroll 10s linear infinite;
  }
  
  .supreme-badge-big {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius-lg);
    background: linear-gradient(135deg, rgba(168,85,247,0.2), rgba(99,102,241,0.15));
    border: 1.5px solid rgba(192,132,252,0.5);
    margin-bottom: 1.5rem;
    font-size: 0.85rem;
    font-weight: 700;
    color: #c084fc;
  }
  
  /* ============================================================
     ZEACREW SPECIFIC STYLES
     ============================================================ */
  .zea-sidebar {
    width: 260px;
    background: var(--bg-card);
    min-height: calc(100vh - 70px);
    padding: 20px 0;
    border-right: 1px solid var(--border-color);
    position: sticky;
    top: 70px;
    height: calc(100vh - 70px);
    overflow-y: auto;
  }
  
  .zea-nav-item {
    padding: 12px 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    transition: all 0.3s;
    border-left: 3px solid transparent;
    font-size: 14px;
    color: var(--text-secondary);
  }
  
  .zea-nav-item:hover { background: var(--bg-input); color: var(--text-primary); }
  .zea-nav-item.active {
    background: rgba(99,102,241,0.1);
    border-left-color: var(--accent-1);
    color: var(--accent-1);
    font-weight: 600;
  }
  
  .zea-nav-icon { font-size: 18px; }
  .zea-content { flex: 1; padding: 20px; overflow-x: hidden; }
  .zea-page { display: none; }
  .zea-page.active { display: block; animation: fadeSlideIn 0.4s ease; }
  
  .zea-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }
  
  .zea-stat-card {
    background: var(--bg-card);
    padding: 20px;
    border-radius: 16px;
    box-shadow: var(--shadow-md);
    text-align: center;
    border: 1px solid var(--border-color);
  }
  
  .zea-stat-icon { font-size: 28px; margin-bottom: 8px; }
  .zea-stat-value { font-size: 26px; font-weight: 700; color: var(--accent-1); }
  .zea-stat-label { color: var(--text-secondary); font-size: 13px; }
  
  .zea-unit-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 10px;
  }
  
  .zea-unit-card {
    padding: 14px 8px;
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    border: 2px solid;
  }
  
  .zea-unit-card.ready { background: rgba(16,185,129,0.1); border-color: var(--accent-success); }
  .zea-unit-card.maintenance { background: rgba(239,68,68,0.1); border-color: var(--accent-danger); }
  .zea-unit-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-lg); }
  
  .zea-unit-name { font-weight: 700; font-size: 12px; color: var(--text-primary); }
  .zea-unit-type { font-size: 10px; color: var(--text-secondary); margin-top: 2px; }
  .zea-unit-warning { position: absolute; top: -6px; right: -6px; font-size: 16px; }
  
  .zea-tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
  .zea-tab-btn {
    padding: 10px 18px;
    border: 2px solid var(--border-color);
    border-radius: 10px;
    background: var(--bg-card);
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    color: var(--text-secondary);
  }
  .zea-tab-btn:hover, .zea-tab-btn.active { border-color: var(--accent-1); background: var(--accent-1); color: white; }
  
  .zea-feed-input {
    width: 100%;
    padding: 14px;
    border: 2px solid var(--border-color);
    border-radius: 12px;
    font-size: 16px !important;
    resize: vertical;
    min-height: 80px;
    margin-bottom: 12px;
    font-family: inherit;
    background: var(--bg-input);
    color: var(--text-primary);
  }
  
  .zea-feed-input:focus { outline: none; border-color: var(--accent-1); }
  
  .zea-feed-type-btn {
    padding: 8px 14px;
    border: 2px solid var(--border-color);
    border-radius: 20px;
    background: var(--bg-card);
    cursor: pointer;
    font-size: 13px;
    transition: all 0.3s;
    color: var(--text-secondary);
  }
  
  .zea-feed-type-btn:hover, .zea-feed-type-btn.active { border-color: var(--accent-1); background: rgba(99,102,241,0.1); color: var(--accent-1); }
  
  .zea-post-card {
    background: var(--bg-card);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 16px;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-color);
  }
  
  .zea-post-card.owner-post { border: 2px solid var(--accent-warning); background: linear-gradient(135deg, rgba(245,158,11,0.05) 0%, var(--bg-card) 100%); }
  
  .zea-post-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
  .zea-post-avatar {
    width: 42px; height: 42px; border-radius: 50%;
    background: var(--accent-1);
    display: flex; align-items: center; justify-content: center;
    color: white; font-weight: 600; flex-shrink: 0;
  }
  .zea-post-meta { flex: 1; }
  .zea-post-author { font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 8px; flex-wrap: wrap; color: var(--text-primary); }
  .zea-verified-badge { background: var(--accent-1); color: white; font-size: 10px; padding: 2px 8px; border-radius: 10px; }
  .zea-post-time { font-size: 12px; color: var(--text-secondary); }
  .zea-post-type { font-size: 11px; padding: 4px 10px; border-radius: 20px; font-weight: 600; }
  .zea-post-type.pengumuman { background: rgba(99,102,241,0.2); color: var(--accent-1); }
  .zea-post-type.info { background: rgba(16,185,129,0.2); color: var(--accent-success); }
  .zea-post-type.keluhan { background: rgba(245,158,11,0.2); color: var(--accent-warning); }
  .zea-post-type.lainnya { background: rgba(236,72,153,0.2); color: var(--accent-pink); }
  .zea-post-content { margin-bottom: 14px; line-height: 1.6; white-space: pre-wrap; font-size: 14px; color: var(--text-primary); }
  .zea-post-actions { display: flex; gap: 20px; padding-top: 12px; border-top: 1px solid var(--border-color); }
  .zea-post-action-btn {
    background: none; border: none; cursor: pointer;
    display: flex; align-items: center; gap: 6px;
    color: var(--text-secondary); font-size: 13px;
  }
  .zea-post-action-btn.liked { color: var(--accent-danger); }
  
  .zea-slip-container {
    background: var(--bg-input);
    border: 2px dashed var(--border-color);
    border-radius: 12px;
    padding: 24px;
    margin-top: 20px;
  }
  
  .zea-slip-header { text-align: center; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid var(--border-color); }
  .zea-slip-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 14px; color: var(--text-primary); }
  .zea-slip-total { font-weight: 700; font-size: 16px; border-top: 2px solid var(--border-color); margin-top: 12px; padding-top: 12px; }
  
  .zea-section-title { font-size: 14px; font-weight: 600; color: var(--text-secondary); margin: 20px 0 10px 0; padding-bottom: 8px; border-bottom: 2px solid var(--border-color); }
  
  .zea-info-box { background: rgba(99,102,241,0.1); border-left: 4px solid var(--accent-1); padding: 12px 16px; border-radius: 0 8px 8px 0; margin: 16px 0; font-size: 13px; color: var(--text-primary); }
  .zea-warning-box { background: rgba(245,158,11,0.1); border-left: 4px solid var(--accent-warning); padding: 12px 16px; border-radius: 0 8px 8px 0; margin: 16px 0; font-size: 13px; color: var(--text-primary); }
  
  .zea-token-item { background: var(--bg-input); padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
  .zea-token-high { border-left: 3px solid var(--accent-danger); }
  .zea-token-normal { border-left: 3px solid var(--accent-success); }
  
  .zea-staff-info { display: flex; align-items: center; gap: 12px; }
  .zea-staff-avatar {
    width: 40px; height: 40px; border-radius: 50%;
    background: var(--accent-1); color: white;
    display: flex; align-items: center; justify-content: center;
    font-weight: 600; font-size: 14px;
  }
  .zea-staff-name { font-weight: 600; color: var(--text-primary); }
  .zea-staff-wa { font-size: 12px; color: var(--text-secondary); }
  
  .zea-action-btns { display: flex; gap: 6px; }
  
  .zea-menu-toggle { background: none; border: none; font-size: 24px; cursor: pointer; display: none; color: white; }
  .zea-sidebar-overlay { display: none; position: fixed; top: 70px; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 98; }
  .zea-sidebar-overlay.open { display: block; }
  
  /* ============================================================
     RESPONSIVE
     ============================================================ */
  @media (max-width: 768px) {
    .header-content { flex-direction: column; }
    .header-info { width: 100%; justify-content: space-between; }
    .header-stat { padding: 0.4rem 0.75rem; }
    .header-stat-value { font-size: 0.9rem; }
    .logo-title { font-size: 1.1rem; }
    .nav-btn { padding: 0.875rem 1rem; font-size: 0.8rem; }
    .main { padding: 1rem; padding-bottom: 80px; }
    .form-grid { grid-template-columns: 1fr; }
    .unit-grid { grid-template-columns: repeat(2, 1fr); }
    .payment-split { grid-template-columns: 1fr; }
    .stat-value { font-size: 1.2rem; }
    .connection-status { top: auto; bottom: 80px; right: 10px; left: 10px; justify-content: center; }
    .toast-container { left: 10px; right: 10px; bottom: 10px; }
    .toast { max-width: 100%; }
    .notif-toggle { bottom: 88px; left: 16px; width: 50px; height: 50px; font-size: 1.3rem; }
    .report-bug-btn { bottom: 88px; right: 16px; height: 44px; font-size: 0.78rem; padding: 0 1rem 0 0.8rem; }
    .online-panel { top: auto; bottom: 150px; right: 10px; }
    .online-pill { font-size: 0.68rem; padding: 5px 10px; }
    
    .zea-menu-toggle { display: block; }
    .zea-sidebar { position: fixed; left: -260px; top: 70px; height: calc(100vh - 70px); z-index: 99; transition: left 0.3s; }
    .zea-sidebar.open { left: 0; }
    .zea-stats-grid { grid-template-columns: repeat(2, 1fr); }
    .zea-unit-grid { grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); }
  }
  
  @media print {
    .header, .nav, .filter-section, .btn, .toast-container, .connection-status, .quick-actions,
    .notif-toggle, .report-bug-btn, .online-panel, .zea-sidebar, .zea-menu-toggle { display: none !important; }
    body { background: white; color: black; }
    .stat-value { -webkit-text-fill-color: black !important; }
  }
  </style>

</head>
<body>
  <!-- ============================================================
       UNIFIED LOGIN SCREEN
       ============================================================ -->
  <div class="login-screen" id="loginScreen">
    <div class="login-box">
      <div class="login-logo">
        <div class="login-logo-icon">ZU</div>
        <div class="login-logo-title">ZeaUnified</div>
        <div class="login-logo-sub">SaldoZea + ZeaCrew v4.0</div>
      </div>

```
  <div class="app-selector">
    <button class="app-selector-btn active" id="btnSaldoZea" onclick="selectApp('saldozea')"> SaldoZea</button>
    <button class="app-selector-btn" id="btnZeaCrew" onclick="selectApp('zeacrew')"> ZeaCrew</button>
  </div>
  
  <div class="login-form">
    <div class="login-input-wrap">
      <span class="login-input-icon"></span>
      <input type="text" class="login-input" id="loginUsername" placeholder="Username" autocomplete="off" autocapitalize="off" spellcheck="false">
    </div>
    <div class="login-input-wrap">
      <span class="login-input-icon"></span>
      <input type="password" class="login-input" id="loginPassword" placeholder="Password" autocomplete="current-password">
    </div>
    <div class="login-error" id="loginError">Username atau password salah!</div>
    <button class="login-btn" onclick="doLogin()">Masuk </button>
  </div>
  <div class="login-footer">ZeaUnified  2026  Zea Property GWP</div>
</div>
```

  </div>

  <!-- ============================================================
       SALDOZEA APP CONTAINER
       ============================================================ -->

  <div class="app-container" id="saldozeaApp">
    <div class="crew-banner" id="crewBanner"> MODE VIEW ONLY  Akun CREW tidak dapat melakukan input atau perubahan data</div>

```
<div class="connection-status connecting" id="connectionStatus"> Menghubungkan...</div>
<div class="toast-container" id="toastContainer"></div>

<div class="alarm-overlay" id="alarmOverlay">
  <div class="alarm-card">
    <div class="alarm-icon"></div>
    <div class="alarm-title">WAKTU CHECKOUT!</div>
    <div class="alarm-units" id="alarmUnitList">Unit sedang checkout...</div>
    <button class="btn btn-danger" onclick="SaldoApp.dismissAlarm()" style="width:100%;font-size:1rem;"> Sudah Ditangani</button>
  </div>
</div>

<button class="report-bug-btn" id="reportBugBtn" onclick="SaldoApp.openBugModal()" title="Laporkan bug">
  <span class="bug-icon"></span> Report Bug
</button>

<div class="bug-modal-overlay" id="bugModalOverlay" onclick="if(event.target===this)SaldoApp.closeBugModal()" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);justify-content:center;align-items:center;z-index:99999 !important;padding:1rem;">
  <div class="bug-modal" style="background:var(--bg-card);border:2px solid var(--accent-danger);border-radius:var(--radius-xl);padding:2rem;max-width:460px;width:100%;box-shadow:0 0 60px rgba(239,68,68,0.3);position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;left:0;right:0;height:4px;background:var(--gradient-danger);"></div>
    <div style="font-size:1.2rem;font-weight:800;color:var(--accent-danger);margin-bottom:0.25rem;display:flex;align-items:center;gap:0.5rem;"> Laporkan Bug</div>
    <div style="font-size:0.8rem;color:var(--text-muted);margin-bottom:1.5rem;">Laporan akan dikirim langsung ke WhatsApp Ketua</div>
    <div style="background:var(--bg-input);border-radius:var(--radius-md);padding:0.75rem 1rem;margin-bottom:1rem;font-size:0.85rem;color:var(--text-secondary);">Tab bermasalah: <strong id="bugTabName" style="color:var(--text-primary);"></strong></div>
    <textarea class="bug-notes" id="bugNotes" placeholder="Opsional: jelaskan bug-nya secara singkat..." style="width:100%;padding:0.875rem 1rem;background:var(--bg-input);border:2px solid var(--border-color);border-radius:var(--radius-md);color:var(--text-primary);font-size:16px;font-family:inherit;resize:vertical;min-height:90px;"></textarea>
    <div style="display:flex;gap:0.75rem;margin-top:1rem;">
      <button class="btn btn-danger" style="flex:1" onclick="SaldoApp.sendBugReport()"> Kirim via WhatsApp</button>
      <button class="btn btn-secondary" onclick="SaldoApp.closeBugModal()">Batal</button>
    </div>
  </div>
</div>

<div class="online-panel" id="onlinePanel"></div>
<button class="notif-toggle on" id="notifToggle" onclick="SaldoApp.toggleNotification()" title="Toggle Notifikasi Suara"></button>

<div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this)SaldoApp.closeModal()">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle">Detail</div>
      <button class="modal-close" onclick="SaldoApp.closeModal()"></button>
    </div>
    <div class="modal-body" id="modalBody"></div>
    <div class="modal-footer" id="modalFooter"></div>
  </div>
</div>

<div class="led-bar led-green" id="ledBar">
  <div class="led-bar-inner" id="ledBarInner">
     &nbsp; Selamat datang di ZeaUnified  SaldoZea & ZeaCrew Management System &nbsp;  &nbsp; Pastikan setiap transaksi dicatat dengan benar &nbsp;  &nbsp; Terima kasih atas kerja keras kalian semua &nbsp; 
  </div>
</div>

<div class="header">
  <div class="header-content">
    <div class="logo">
      <div class="logo-icon">SZ</div>
      <div class="logo-text">
        <div class="logo-title">SaldoZea by ZeaProperty</div>
        <div class="logo-subtitle">Finance Tracker v4.0</div>
      </div>
    </div>
    <div class="header-info">
      <div class="header-stat">
        <div class="header-stat-label">Unit Tersedia</div>
        <div class="header-stat-value" id="headerAvailable">0</div>
      </div>
      <div class="header-stat">
        <div class="header-stat-label">Saldo Hari Ini</div>
        <div class="header-stat-value" id="headerSaldo">Rp 0</div>
      </div>
      <div class="header-time">
        <div class="header-date" id="headerDate"></div>
        <div class="header-clock" id="headerClock"></div>
      </div>
      <div id="userBadge" class="role-badge supreme" style="text-transform:uppercase"></div>
      <button class="logout-btn" onclick="doLogout()">Keluar</button>
    </div>
  </div>
</div>

<nav class="nav">
  <div class="nav-content">
    <button class="nav-btn active" data-tab="dashboard" onclick="SaldoApp.switchTab('dashboard')">Dashboard</button>
    <button class="nav-btn" data-tab="rental" onclick="SaldoApp.switchTab('rental')">Input Sewa</button>
    <button class="nav-btn" data-tab="transaction" onclick="SaldoApp.switchTab('transaction')">Transaksi</button>
    <button class="nav-btn" data-tab="units" onclick="SaldoApp.switchTab('units')">Unit<span class="badge-count" id="checkoutBadge" style="display:none">0</span></button>
    <button class="nav-btn" data-tab="history" onclick="SaldoApp.switchTab('history')">Riwayat</button>
    <button class="nav-btn" data-tab="report" onclick="SaldoApp.switchTab('report')">Laporan</button>
    <button class="nav-btn" data-tab="supreme" id="supremeNavBtn" onclick="SaldoApp.switchTab('supreme')" style="display:none;color:#c084fc"></button>
  </div>
</nav>

<div class="main">
  <!-- DASHBOARD -->
  <div id="dashboard" class="tab-content active">
    <div class="checkout-alert" id="checkoutAlert" style="display:none">
      <div class="checkout-alert-icon"></div>
      <div class="checkout-alert-content">
        <div class="checkout-alert-title">Unit Segera Checkout!</div>
        <div class="checkout-alert-list" id="checkoutAlertList"></div>
      </div>
      <button class="btn btn-warning btn-sm" onclick="SaldoApp.switchTab('units')">Lihat Unit</button>
    </div>
    
    <div class="quick-actions">
      <button class="quick-action-btn success" onclick="SaldoApp.switchTab('rental')">+ Input Sewa Baru</button>
      <button class="quick-action-btn crew-hide" onclick="SaldoApp.switchTab('transaction')">+ Tambah Pemasukan</button>
      <button class="quick-action-btn danger" onclick="SaldoApp.switchTab('transaction')">- Tambah Pengeluaran</button>
      <button class="quick-action-btn" onclick="SaldoApp.exportDailyReport()"> Export Hari Ini</button>
    </div>
    
    <div class="dashboard-grid">
      <div class="stat-card">
        <div class="stat-card-inner">
          <div class="stat-content">
            <div class="stat-label">Saldo Hari Ini</div>
            <div class="stat-value" id="todaySaldo">Rp 0</div>
            <div class="stat-breakdown">
              <div class="stat-breakdown-item cash">C: <span id="todayCash">0</span></div>
              <div class="stat-breakdown-item transfer">T: <span id="todayTransfer">0</span></div>
              <div class="stat-breakdown-item qr">Q: <span id="todayQR">0</span></div>
            </div>
          </div>
          <div class="stat-icon"></div>
        </div>
      </div>
      <div class="stat-card success">
        <div class="stat-card-inner">
          <div class="stat-content">
            <div class="stat-label">Pemasukan Hari Ini</div>
            <div class="stat-value" id="todayIncome">Rp 0</div>
            <div class="stat-breakdown">
              <div class="stat-breakdown-item">Sewa: <span id="todayRentalIncome">0</span></div>
              <div class="stat-breakdown-item">Lain: <span id="todayOtherIncome">0</span></div>
            </div>
          </div>
          <div class="stat-icon"></div>
        </div>
      </div>
      <div class="stat-card danger">
        <div class="stat-card-inner">
          <div class="stat-content">
            <div class="stat-label">Pengeluaran Hari Ini</div>
            <div class="stat-value" id="todayExpense">Rp 0</div>
            <div class="stat-breakdown">
              <div class="stat-breakdown-item" id="topExpenseCategory">-</div>
            </div>
          </div>
          <div class="stat-icon"></div>
        </div>
      </div>
      <div class="stat-card cyan">
        <div class="stat-card-inner">
          <div class="stat-content">
            <div class="stat-label">Tamu Hari Ini</div>
            <div class="stat-value" id="todayGuests">0</div>
            <div class="stat-breakdown">
              <div class="stat-breakdown-item"><span id="todayUnitsUsed">0</span> unit terpakai</div>
            </div>
          </div>
          <div class="stat-icon"></div>
        </div>
      </div>
      <div class="stat-card warning">
        <div class="stat-card-inner">
          <div class="stat-content">
            <div class="stat-label">Fee Marketing Pending</div>
            <div class="stat-value" id="unpaidFee">Rp 0</div>
            <div class="stat-breakdown">
              <div class="stat-breakdown-item" id="feeBreakdown">-</div>
            </div>
          </div>
          <div class="stat-icon"></div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-card-inner">
          <div class="stat-content">
            <div class="stat-label">Saldo Bulan Ini</div>
            <div class="stat-value" id="monthSaldo">Rp 0</div>
            <div class="stat-breakdown">
              <div class="stat-breakdown-item"><span id="monthGuests">0</span> total tamu</div>
            </div>
          </div>
          <div class="stat-icon"></div>
        </div>
      </div>
    </div>
    
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1rem;">
      <div class="card">
        <div class="card-header"><div class="card-title"><div class="card-title-icon warning"></div>Top Marketing Hari Ini</div></div>
        <div class="top-list" id="topMarketing"><div class="empty-state"><div class="empty-state-text">Belum ada data</div></div></div>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title"><div class="card-title-icon danger"></div>Unit Terlaris Hari Ini</div></div>
        <div class="top-list" id="topUnits"><div class="empty-state"><div class="empty-state-text">Belum ada data</div></div></div>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title"><div class="card-title-icon cyan"></div>Durasi Populer Hari Ini</div></div>
        <div class="top-list" id="topDurations"><div class="empty-state"><div class="empty-state-text">Belum ada data</div></div></div>
      </div>
    </div>
  </div>
  
  <!-- RENTAL -->
  <div id="rental" class="tab-content">
    <div class="card">
      <div class="card-header">
        <div class="card-title"><div class="card-title-icon primary"></div>Input Data Penyewaan Unit</div>
        <button class="btn btn-secondary btn-sm" onclick="SaldoApp.resetRentalForm()">Reset</button>
      </div>
      <form id="rentalForm" onsubmit="return SaldoApp.handleRentalSubmit(event)">
        <div class="form-grid" style="margin-bottom:1.5rem">
          <div class="form-group">
            <label class="form-label">Tipe Unit <span class="required">*</span></label>
            <select class="form-select" id="unitType" required onchange="SaldoApp.populateUnitNumbers()">
              <option value="">Pilih Tipe</option>
              <option value="Studio">Studio</option>
              <option value="1BR">1 Bedroom</option>
              <option value="2BR">2 Bedroom</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Nomor Unit <span class="required">*</span></label>
            <select class="form-select" id="unitNumber" required><option value="">Pilih Unit</option></select>
          </div>
          <div class="form-group">
            <label class="form-label">Marketing <span class="required">*</span></label>
            <select class="form-select" id="marketing" required onchange="SaldoApp.onMarketingChange(this.value)">
              <option value="">Pilih Marketing</option>
              <option value="Raisya">Raisya</option>
              <option value="Ibu">Ibu</option>
              <option value="Security">Security</option>
              <option value="Sani">Sani</option>
              <option value="Ari">Ari</option>
              <option value="Iwa">Iwa</option>
              <option value="DS">DS (Datang Sendiri)</option>
              <option value="other">Lainnya...</option>
            </select>
          </div>
          <div class="form-group" id="otherMarketingGroup" style="display:none">
            <label class="form-label">Nama Marketing</label>
            <input type="text" class="form-input" id="otherMarketing" placeholder="Ketik nama...">
          </div>
        </div>
        <div class="form-grid" style="margin-bottom:1.5rem">
          <div class="form-group">
            <label class="form-label">Durasi <span class="required">*</span></label>
            <select class="form-select" id="duration" required onchange="SaldoApp.calcCheckout(); SaldoApp.calcBasePrice(); SaldoApp.updateDurationHint();">
              <option value="">Pilih Durasi</option>
              <optgroup label="Charge">
                <option value="1J">1 Jam (Charge)</option>
                <option value="2J">2 Jam (Charge)</option>
              </optgroup>
              <optgroup label="Regular">
                <option value="3J">3 Jam</option>
                <option value="4J">4 Jam</option>
                <option value="5J">5 Jam</option>
                <option value="6J">6 Jam</option>
                <option value="7J">7 Jam</option>
                <option value="8J">8 Jam</option>
              </optgroup>
              <optgroup label="Special">
                <option value="PM">PM (Promo Malam)</option>
                <option value="FD">Fullday (24 Jam)</option>
              </optgroup>
            </select>
            <div class="form-hint" id="durationHint"></div>
          </div>
          <div class="form-group">
            <label class="form-label">Check-in <span class="required">*</span></label>
            <input type="time" class="form-input" id="checkIn" required onchange="SaldoApp.calcCheckout()">
          </div>
          <div class="form-group">
            <label class="form-label">Check-out (Auto)</label>
            <input type="time" class="form-input readonly" id="checkOut" readonly>
          </div>
          <div class="form-group">
            <label class="form-label">Tipe Harga <span class="required">*</span></label>
            <select class="form-select" id="priceType" required onchange="SaldoApp.calcBasePrice()">
              <option value="weekday">Weekday</option>
              <option value="weekend">Weekend</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Harga Dasar</label>
            <input type="number" class="form-input" id="basePrice" placeholder="0">
            <div class="form-hint">Harga standar referensi</div>
          </div>
        </div>
        <div style="background:var(--bg-input);border-radius:var(--radius-lg);padding:1.5rem;margin-bottom:1.5rem">
          <h3 style="margin-bottom:1rem;font-size:1rem;color:var(--text-primary);">Pembayaran Diterima Kantor</h3>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Cash</label>
              <input type="number" class="form-input" id="cashAmount" placeholder="0" value="0" oninput="SaldoApp.updateTotal()">
            </div>
            <div class="form-group">
              <label class="form-label">Transfer</label>
              <input type="number" class="form-input" id="transferAmount" placeholder="0" value="0" oninput="SaldoApp.updateTotal()">
            </div>
            <div class="form-group">
              <label class="form-label">QRIS</label>
              <input type="number" class="form-input" id="qrAmount" placeholder="0" value="0" oninput="SaldoApp.updateTotal()">
            </div>
          </div>
          <div class="price-display" style="margin-top:1rem">
            <div class="label">Total Pembayaran Masuk Saldo</div>
            <div class="value" id="totalPayment">Rp 0</div>
          </div>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Rekening Bank</label>
            <select class="form-select" id="bankAccount">
              <option value="">- Pilih jika Transfer -</option>
              <option>BCA</option><option>Mandiri</option><option>BRI</option>
              <option>BNI</option><option>Dana</option><option>OVO</option><option>GoPay</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Fee Marketing</label>
            <input type="number" class="form-input" id="marketingFee" placeholder="0" value="0">
            <div class="form-hint">Isi 0 jika fee sudah dipotong</div>
          </div>
          <div class="form-group">
            <label class="form-label">Status Bayar</label>
            <select class="form-select" id="paymentStatus">
              <option value="Lunas">Lunas</option>
              <option value="Belum Lunas">Belum Lunas</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Identitas Tamu</label>
            <input type="text" class="form-input" id="guestIdentity" placeholder="Nama / STNK / KTP">
          </div>
          <div class="form-group full-width">
            <label class="form-label">Keterangan</label>
            <input type="text" class="form-input" id="rentalNotes" placeholder="Catatan tambahan...">
          </div>
        </div>
        <div class="btn-group" style="margin-top:1.5rem">
          <button type="submit" class="btn btn-primary btn-lg"> Simpan Penyewaan</button>
          <button type="button" class="btn btn-secondary" onclick="SaldoApp.resetRentalForm()">Reset</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- TRANSACTION -->
  <div id="transaction" class="tab-content">
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(380px,1fr));gap:1.5rem">
      <div class="card">
        <div class="card-header"><div class="card-title"><div class="card-title-icon success"></div>Tambah Pemasukan</div></div>
        <form id="incomeForm" onsubmit="return SaldoApp.handleIncomeSubmit(event)">
          <div class="form-grid">
            <div class="form-group full-width">
              <label class="form-label">Sumber <span class="required">*</span></label>
              <input type="text" class="form-input" id="incomeSource" placeholder="Contoh: Setoran Jarrdin, Bonus" required>
            </div>
            <div class="form-group">
              <label class="form-label">Nominal <span class="required">*</span></label>
              <input type="number" class="form-input" id="incomeAmount" placeholder="0" required>
            </div>
            <div class="form-group">
              <label class="form-label">Metode <span class="required">*</span></label>
              <select class="form-select" id="incomeMethod" required>
                <option value="Cash">Cash</option>
                <option value="Transfer">Transfer</option>
                <option value="QR">QRIS</option>
              </select>
            </div>
            <div class="form-group full-width">
              <label class="form-label">Keterangan</label>
              <input type="text" class="form-input" id="incomeNotes" placeholder="Detail...">
            </div>
          </div>
          <button type="submit" class="btn btn-success" style="margin-top:1rem;width:100%">Tambah Pemasukan</button>
        </form>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title"><div class="card-title-icon danger"></div>Tambah Pengeluaran</div></div>
        <form id="expenseForm" onsubmit="return SaldoApp.handleExpenseSubmit(event)">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Kategori <span class="required">*</span></label>
              <select class="form-select" id="expenseCategory" required>
                <option value="">Pilih</option>
                <option value="UM">UM</option>
                <option value="Gaji">Gaji</option>
                <option value="Kasbon">Kasbon</option>
                <option value="Supplies">Supplies</option>
                <option value="Maintenance">Maintenance</option>
                <option value="Utilitas">Utilitas</option>
                <option value="Abodemen">Abodemen</option>
                <option value="Top Up Link">Top Up Link</option>
                <option value="Setoran Kantor">Setoran Kantor</option>
                <option value="Fee Marketing">Fee Marketing</option>
                <option value="Lainnya">Lainnya</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Penerima <span class="required">*</span></label>
              <input type="text" class="form-input" id="expenseRecipient" placeholder="Nama" required>
            </div>
            <div class="form-group">
              <label class="form-label">Nominal <span class="required">*</span></label>
              <input type="number" class="form-input" id="expenseAmount" placeholder="0" required>
            </div>
            <div class="form-group">
              <label class="form-label">Metode <span class="required">*</span></label>
              <select class="form-select" id="expenseMethod" required>
                <option value="Cash">Cash</option>
                <option value="Transfer">Transfer</option>
                <option value="QR">QRIS</option>
              </select>
            </div>
            <div class="form-group full-width">
              <label class="form-label">Keterangan</label>
              <input type="text" class="form-input" id="expenseNotes" placeholder="Detail...">
            </div>
          </div>
          <button type="submit" class="btn btn-danger" style="margin-top:1rem;width:100%">Tambah Pengeluaran</button>
        </form>
      </div>
    </div>
    <div class="card" style="margin-top:1.5rem">
      <div class="card-header"><div class="card-title"><div class="card-title-icon primary"></div>Transaksi Terbaru</div></div>
      <div class="table-container" style="max-height:400px;overflow-y:auto">
        <table><thead><tr><th>Waktu</th><th>Jenis</th><th>Keterangan</th><th>Metode</th><th>Nominal</th></tr></thead>
        <tbody id="recentTransactions"></tbody></table>
      </div>
    </div>
  </div>
  
  <!-- UNITS -->
  <div id="units" class="tab-content">
    <div class="card">
      <div class="card-header"><div class="card-title"><div class="card-title-icon cyan"></div>Manajemen Unit</div></div>
      <div class="form-grid" style="padding:1rem;">
        <div class="form-group">
          <label class="form-label">Tambah Unit Baru</label>
          <input type="text" class="form-input" id="newUnitNumber" placeholder="Contoh: TA1123">
          <select class="form-select" id="newUnitType" style="margin-top:0.5rem;">
            <option value="">Pilih Tipe</option>
            <option value="Studio">Studio</option>
            <option value="1BR">1BR</option>
            <option value="2BR">2BR</option>
          </select>
          <button class="btn btn-success btn-sm" onclick="SaldoApp.handleAddUnit()" style="margin-top:0.5rem;">Tambah</button>
        </div>
        <div class="form-group">
          <label class="form-label">Hapus Unit</label>
          <input type="text" class="form-input" id="removeUnitNumber" placeholder="Ketik nomor unit">
          <button class="btn btn-danger btn-sm" onclick="SaldoApp.handleRemoveUnit()" style="margin-top:0.5rem;">Hapus</button>
        </div>
      </div>
      <div class="form-hint" style="padding:0 1rem 1rem;">Gunakan dengan hati-hati. Unit yang sedang disewa tidak dapat dihapus.</div>
    </div>
    <div class="filter-section">
      <div class="form-group" style="flex:2">
        <label class="form-label">Cari Unit</label>
        <input type="text" class="form-input" id="searchUnit" placeholder="Ketik nomor unit..." oninput="SaldoApp.renderUnitGrid()">
      </div>
      <div class="form-group">
        <label class="form-label">Tipe</label>
        <select class="form-select" id="filterUnitType" onchange="SaldoApp.renderUnitGrid()">
          <option value="">Semua</option><option value="Studio">Studio</option>
          <option value="1BR">1BR</option><option value="2BR">2BR</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Status</label>
        <select class="form-select" id="filterUnitStatus" onchange="SaldoApp.renderUnitGrid()">
          <option value="">Semua</option>
          <option value="available">Tersedia</option>
          <option value="occupied">Terisi</option>
          <option value="checkout-soon">Segera CO</option>
        </select>
      </div>
    </div>
    <div class="dashboard-grid" style="margin-bottom:1.5rem">
      <div class="stat-card success"><div class="stat-label">Tersedia</div><div class="stat-value" id="availableCount">0</div></div>
      <div class="stat-card danger"><div class="stat-label">Terisi</div><div class="stat-value" id="occupiedCount">0</div></div>
      <div class="stat-card warning"><div class="stat-label">Segera CO</div><div class="stat-value" id="checkoutSoonCountStat">0</div></div>
    </div>
    <div id="unitGridContainer"></div>
  </div>
  
  <!-- HISTORY -->
  <div id="history" class="tab-content">
    <div class="filter-section">
      <div class="form-group">
        <label class="form-label">Tanggal Bisnis</label>
        <input type="date" class="form-input" id="filterDate" onchange="SaldoApp.applyFilters()">
        <div class="form-hint" id="filterDateHint">Menampilkan data 08:00 s/d 07:59 hari berikutnya</div>
      </div>
      <div class="form-group">
        <label class="form-label">Jenis</label>
        <select class="form-select" id="filterType">
          <option value="">Semua</option>
          <option value="rental">Sewa</option>
          <option value="income">Pemasukan</option>
          <option value="expense">Pengeluaran</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Marketing</label>
        <select class="form-select" id="filterMarketing">
          <option value="">Semua</option>
          <option>Raisya</option><option>Ibu</option><option>Security</option>
          <option>Sani</option><option>Ari</option><option>Iwa</option><option>DS</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">&nbsp;</label>
        <div class="btn-group">
          <button class="btn btn-primary btn-sm" onclick="SaldoApp.applyFilters()">Filter</button>
          <button class="btn btn-secondary btn-sm" onclick="SaldoApp.clearFilters()">Clear</button>
          <button class="btn btn-success btn-sm" onclick="SaldoApp.exportCSV()">Export</button>
        </div>
      </div>
    </div>
    <div class="dashboard-grid" style="margin-bottom:1rem">
      <div class="stat-card success" style="padding:1rem"><div class="stat-label" style="font-size:0.7rem">Total Masuk</div><div class="stat-value" id="historyTotalIn" style="font-size:1.25rem">Rp 0</div></div>
      <div class="stat-card danger" style="padding:1rem"><div class="stat-label" style="font-size:0.7rem">Total Keluar</div><div class="stat-value" id="historyTotalOut" style="font-size:1.25rem">Rp 0</div></div>
      <div class="stat-card" style="padding:1rem"><div class="stat-label" style="font-size:0.7rem">Saldo</div><div class="stat-value" id="historyNet" style="font-size:1.25rem">Rp 0</div></div>
      <div class="stat-card cyan" style="padding:1rem"><div class="stat-label" style="font-size:0.7rem">Total Record</div><div class="stat-value" id="historyCount" style="font-size:1.25rem">0</div></div>
    </div>
    <div class="table-container">
      <table><thead><tr><th>#</th><th>Waktu</th><th>Jenis</th><th>Unit/Sumber</th><th>Marketing</th><th>Durasi</th><th>Total</th><th>Metode</th><th>Ket</th><th>Aksi</th></tr></thead>
      <tbody id="historyTable"></tbody></table>
    </div>
  </div>
  
  <!-- REPORT -->
  <div id="report" class="tab-content">
    <div class="card">
      <div class="card-header"><div class="card-title"><div class="card-title-icon primary"></div>Generate Laporan</div></div>
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">Dari Tanggal Bisnis</label>
          <input type="date" class="form-input" id="reportStart">
          <div class="form-hint">mulai 08:00 tanggal ini</div>
        </div>
        <div class="form-group">
          <label class="form-label">Sampai Tanggal Bisnis</label>
          <input type="date" class="form-input" id="reportEnd">
          <div class="form-hint">sampai 07:59 hari berikutnya</div>
        </div>
        <div class="form-group">
          <label class="form-label">&nbsp;</label>
          <div class="btn-group">
            <button class="btn btn-primary" onclick="SaldoApp.generateReport()">Generate</button>
            <button class="btn btn-success" onclick="SaldoApp.exportReport()">Export</button>
          </div>
        </div>
      </div>
    </div>
    <div id="reportResults" style="display:none;margin-top:1.5rem">
      <div class="dashboard-grid">
        <div class="stat-card success"><div class="stat-label">Total Pemasukan</div><div class="stat-value" id="reportIncome">Rp 0</div></div>
        <div class="stat-card danger"><div class="stat-label">Total Pengeluaran</div><div class="stat-value" id="reportExpense">Rp 0</div></div>
        <div class="stat-card"><div class="stat-label">Saldo Bersih</div><div class="stat-value" id="reportNet">Rp 0</div></div>
        <div class="stat-card cyan"><div class="stat-label">Total Tamu</div><div class="stat-value" id="reportGuests">0</div></div>
      </div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1rem;margin-top:1rem">
        <div class="card"><div class="card-header"><div class="card-title">Top Marketing</div></div><div class="top-list" id="reportTopMarketing"></div></div>
        <div class="card"><div class="card-header"><div class="card-title">Top Unit</div></div><div class="top-list" id="reportTopUnits"></div></div>
        <div class="card"><div class="card-header"><div class="card-title">Durasi Populer</div></div><div class="top-list" id="reportTopDuration"></div></div>
        <div class="card"><div class="card-header"><div class="card-title">Metode Bayar</div></div><div class="payment-split" id="reportPaymentBreakdown"></div></div>
      </div>
    </div>
  </div>
  
  <!-- SUPREME -->
  <div id="supreme" class="tab-content">
    <div class="supreme-badge-big">
      <span style="font-size:1.5rem"></span>
      <div>
        <div style="font-size:1rem;font-weight:800">Supreme Playground</div>
        <div style="font-size:0.7rem;opacity:0.7;letter-spacing:1px">AKSES EKSKLUSIF  HANYA TERLIHAT OLEH ANDA</div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <div class="card-title"><div class="card-title-icon warning"></div>Edit LED Moving Sign</div>
        <div style="font-size:0.75rem;color:var(--text-muted)">Pesan tampil realtime ke semua pengguna</div>
      </div>
      
      <div class="supreme-section">
        <div class="supreme-section-title"> Preview Live</div>
        <div class="led-preview led-green" id="ledPreviewBox">
          <div class="led-preview-inner" id="ledPreviewText">Preview pesan...</div>
        </div>
      </div>
      
      <div class="supreme-section">
        <div class="supreme-section-title"> Warna LED</div>
        <div class="led-color-grid" id="ledColorGrid">
          <button class="led-color-btn active" data-color="led-green" style="background:#003b0f;color:#00ff41" onclick="SaldoApp.selectLedColor('led-green',this)" title="Matrix Green"></button>
          <button class="led-color-btn" data-color="led-amber" style="background:#3b2500;color:#ffb300" onclick="SaldoApp.selectLedColor('led-amber',this)" title="Amber"></button>
          <button class="led-color-btn" data-color="led-red" style="background:#3b0000;color:#ff2200" onclick="SaldoApp.selectLedColor('led-red',this)" title="Red Alert"></button>
          <button class="led-color-btn" data-color="led-cyan" style="background:#003033;color:#00e5ff" onclick="SaldoApp.selectLedColor('led-cyan',this)" title="Cyan"></button>
          <button class="led-color-btn" data-color="led-purple" style="background:#1e0038;color:#c084fc" onclick="SaldoApp.selectLedColor('led-purple',this)" title="Purple"></button>
          <button class="led-color-btn" data-color="led-pink" style="background:#38001e;color:#ff4da6" onclick="SaldoApp.selectLedColor('led-pink',this)" title="Pink"></button>
          <button class="led-color-btn" data-color="led-white" style="background:#1a1a2e;color:#e2e8f0" onclick="SaldoApp.selectLedColor('led-white',this)" title="White"></button>
        </div>
      </div>
      
      <div class="supreme-section">
        <div class="supreme-section-title"> Kecepatan Scroll</div>
        <div style="display:flex;gap:0.75rem;flex-wrap:wrap">
          <button class="btn btn-secondary btn-sm" onclick="SaldoApp.setLedSpeed('slow')"> Lambat</button>
          <button class="btn btn-secondary btn-sm" onclick="SaldoApp.setLedSpeed('normal')"> Normal</button>
          <button class="btn btn-secondary btn-sm" onclick="SaldoApp.setLedSpeed('fast')"> Cepat</button>
        </div>
      </div>
      
      <div class="supreme-section">
        <div class="supreme-section-title"> Teks Pesan</div>
        <textarea class="form-input" id="ledMessageInput" rows="4" placeholder="Ketik pesan pengumuman di sini..." oninput="SaldoApp.previewLedMessage()" style="font-family:'Courier New',monospace;letter-spacing:1px;resize:vertical;"></textarea>
        <div class="form-hint" style="margin-top:0.5rem">Pisahkan segmen dengan <code style="background:var(--bg-input);padding:0 4px;border-radius:3px"></code> untuk spasi antar kalimat</div>
      </div>
      
      <div class="btn-group">
        <button class="btn btn-primary btn-lg" onclick="SaldoApp.saveLedMessage()"> Publish ke Semua User</button>
        <button class="btn btn-secondary" onclick="SaldoApp.resetLedDefault()"> Reset ke Default</button>
        <button class="btn btn-warning btn-sm" onclick="SaldoApp.toggleLedPause()"> Pause/Play</button>
      </div>
    </div>
  </div>
</div>
```

  </div>

  <!-- ============================================================
       ZEACREW APP CONTAINER
       ============================================================ -->

  <div class="app-container" id="zeacrewApp">
    <div class="connection-status online" id="zeaConnectionStatus">
      <div class="sync-dot"></div>
      <span id="zeaSyncText"> Online</span>
    </div>

```
<header class="header" style="top:0;">
  <div class="header-content">
    <div class="logo">
      <button class="zea-menu-toggle" id="zeaMenuToggle" onclick="ZeaApp.toggleSidebar()"></button>
      <div class="logo-icon">ZC</div>
      <div class="logo-text">
        <div class="logo-title">ZEA CREW</div>
        <div class="logo-subtitle">HR & Staff Management v4.0</div>
      </div>
    </div>
    <div class="header-info">
      <div class="header-time">
        <div class="header-date" id="zeaHeaderDate"></div>
        <div class="header-clock" id="zeaHeaderClock"></div>
      </div>
      <div id="zeaUserBadge" class="role-badge owner" style="text-transform:uppercase"></div>
      <button class="logout-btn" onclick="doLogout()">Keluar</button>
    </div>
  </div>
</header>

<div class="zea-sidebar-overlay" id="zeaSidebarOverlay" onclick="ZeaApp.toggleSidebar()"></div>

<div class="main-layout" style="display:flex;">
  <nav class="zea-sidebar" id="zeaSidebar">
    <div class="zea-nav-item active" data-page="dashboard" onclick="ZeaApp.switchPage('dashboard')">
      <span class="zea-nav-icon"></span><span>Dashboard</span>
    </div>
    <div class="zea-nav-item" data-page="staff" data-roles="owner,admin,leader" onclick="ZeaApp.switchPage('staff')">
      <span class="zea-nav-icon"></span><span>Staff</span>
    </div>
    <div class="zea-nav-item" data-page="unit" onclick="ZeaApp.switchPage('unit')">
      <span class="zea-nav-icon"></span><span>Unit Apartemen</span>
    </div>
    <div class="zea-nav-item" data-page="token" onclick="ZeaApp.switchPage('token')">
      <span class="zea-nav-icon"></span><span>Token Listrik</span>
    </div>
    <div class="zea-nav-item" data-page="pengajuan" onclick="ZeaApp.switchPage('pengajuan')">
      <span class="zea-nav-icon"></span><span>Pengajuan</span>
    </div>
    <div class="zea-nav-item" data-page="report" onclick="ZeaApp.switchPage('report')">
      <span class="zea-nav-icon"></span><span>Report Kerusakan</span>
    </div>
    <div class="zea-nav-item" data-page="absensi" data-roles="owner,admin,leader" onclick="ZeaApp.switchPage('absensi')">
      <span class="zea-nav-icon"></span><span>Absensi</span>
    </div>
    <div class="zea-nav-item" data-page="gaji" data-roles="owner,admin,leader" onclick="ZeaApp.switchPage('gaji')">
      <span class="zea-nav-icon"></span><span>Penggajian</span>
    </div>
    <div class="zea-nav-item" data-page="akun" data-roles="owner,admin" onclick="ZeaApp.switchPage('akun')">
      <span class="zea-nav-icon"></span><span>Kelola Akun</span>
    </div>
    <div class="zea-nav-item" data-page="panduan" onclick="ZeaApp.switchPage('panduan')">
      <span class="zea-nav-icon"></span><span>Panduan</span>
    </div>
  </nav>
  
  <main class="zea-content">
    <!-- Dashboard -->
    <div class="zea-page active" id="zea-page-dashboard">
      <div class="page-header" style="margin-bottom:24px;">
        <h1 class="page-title" style="font-size:24px;font-weight:700;margin-bottom:8px;color:var(--text-primary);"> Dashboard</h1>
        <p class="page-subtitle" id="zeaWelcomeText" style="color:var(--text-secondary);font-size:14px;">Selamat datang di ZEA CREW</p>
      </div>
      <div class="zea-stats-grid">
        <div class="zea-stat-card"><div class="zea-stat-icon"></div><div class="zea-stat-value" id="statStaff">0</div><div class="zea-stat-label">Total Staff</div></div>
        <div class="zea-stat-card"><div class="zea-stat-icon"></div><div class="zea-stat-value" id="statUnit">0</div><div class="zea-stat-label">Total Unit</div></div>
        <div class="zea-stat-card"><div class="zea-stat-icon"></div><div class="zea-stat-value" id="statMaint">0</div><div class="zea-stat-label">Maintenance</div></div>
        <div class="zea-stat-card"><div class="zea-stat-icon"></div><div class="zea-stat-value" id="statReady">0</div><div class="zea-stat-label">Ready</div></div>
      </div>
      <div class="card">
        <div class="card-header"><h3 class="card-title"> Feed Posting</h3></div>
        <textarea class="zea-feed-input" id="feedInput" placeholder="Tulis sesuatu untuk tim..."></textarea>
        <div class="zea-tabs">
          <button class="zea-feed-type-btn active" data-type="info" onclick="ZeaApp.selectPostType('info')"> Info</button>
          <button class="zea-feed-type-btn" data-type="pengumuman" onclick="ZeaApp.selectPostType('pengumuman')"> Pengumuman</button>
          <button class="zea-feed-type-btn" data-type="keluhan" onclick="ZeaApp.selectPostType('keluhan')"> Keluhan</button>
          <button class="zea-feed-type-btn" data-type="lainnya" onclick="ZeaApp.selectPostType('lainnya')"> Lainnya</button>
          <button class="btn btn-primary btn-sm" onclick="ZeaApp.postFeed()">Posting</button>
        </div>
        <div id="feedContainer" style="margin-top:20px"></div>
      </div>
    </div>
    
    <!-- Staff -->
    <div class="zea-page" id="zea-page-staff">
      <div class="page-header" style="margin-bottom:24px;">
        <h1 class="page-title" style="font-size:24px;font-weight:700;color:var(--text-primary);"> Manajemen Staff</h1>
      </div>
      <div class="zea-info-box"> Data tersimpan otomatis ke Firebase. Semua perubahan akan sync ke semua device.</div>
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Daftar Staff</h3>
          <button class="btn btn-primary btn-sm" id="addStaffBtn" onclick="ZeaApp.showStaffModal()">+ Tambah Staff</button>
        </div>
        <div class="table-container">
          <table>
            <thead><tr><th>Staff</th><th>Role</th><th>Cabang</th><th>Gaji</th><th>Uang Makan/Hari</th><th>Jam Kerja</th><th>Libur</th><th>Aksi</th></tr></thead>
            <tbody id="staffTable"></tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Unit -->
    <div class="zea-page" id="zea-page-unit">
      <div class="page-header" style="margin-bottom:24px;">
        <h1 class="page-title" style="font-size:24px;font-weight:700;color:var(--text-primary);"> Unit Apartemen</h1>
      </div>
      <div class="zea-stats-grid">
        <div class="zea-stat-card"><div class="zea-stat-icon"></div><div class="zea-stat-value" id="unitReady">0</div><div class="zea-stat-label">Ready</div></div>
        <div class="zea-stat-card"><div class="zea-stat-icon"></div><div class="zea-stat-value" id="unitMaint">0</div><div class="zea-stat-label">Maintenance</div></div>
      </div>
      <div class="card" id="unitFormCard">
        <h3 class="card-title" id="unitFormTitle">Tambah/Update Unit</h3>
        <input type="hidden" id="unitEditId">
        <div class="form-grid" style="margin-top:16px">
          <div class="form-group">
            <label class="form-label">Nomor Unit</label>
            <input type="text" class="form-input" id="uNomor" placeholder="DB12B">
          </div>
          <div class="form-group">
            <label class="form-label">Status</label>
            <select class="form-select" id="uStatus">
              <option value="ready"> READY</option>
              <option value="maintenance"> MAINTENANCE</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Tipe Unit</label>
            <select class="form-select" id="uTipe">
              <option value="Studio"> Studio</option>
              <option value="1BR"> 1 Bedroom</option>
              <option value="2BR"> 2 Bedroom</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Nama Owner (Opsional)</label>
            <input type="text" class="form-input" id="uOwner" placeholder="Nama pemilik unit">
          </div>
          <div class="form-group">
            <label class="form-label">WiFi</label>
            <select class="form-select" id="uWifi">
              <option value="ada"> WiFi</option>
              <option value="tidak"> Non WiFi</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Nominal Perpanjangan (Rp)</label>
            <input type="number" class="form-input" id="uNominal" value="2500000">
          </div>
          <div class="form-group">
            <label class="form-label">Tanggal Jatuh Tempo</label>
            <input type="date" class="form-input" id="uTempo">
          </div>
        </div>
        <div class="btn-group" style="margin-top:1rem;">
          <button class="btn btn-primary" onclick="ZeaApp.saveUnit()"> Simpan Unit</button>
          <button class="btn btn-secondary" onclick="ZeaApp.resetUnitForm()">Reset</button>
        </div>
      </div>
      <div class="card">
        <h3 class="card-title">Daftar Unit</h3>
        <div class="zea-section-title"> Studio (<span id="countStudio">0</span>)</div>
        <div class="zea-unit-grid" id="unitGridStudio"></div>
        <div class="zea-section-title"> 1 Bedroom (<span id="count1BR">0</span>)</div>
        <div class="zea-unit-grid" id="unitGrid1BR"></div>
        <div class="zea-section-title"> 2 Bedroom (<span id="count2BR">0</span>)</div>
        <div class="zea-unit-grid" id="unitGrid2BR"></div>
      </div>
    </div>
    
    <!-- Token -->
    <div class="zea-page" id="zea-page-token">
      <div class="page-header" style="margin-bottom:24px;">
        <h1 class="page-title" style="font-size:24px;font-weight:700;color:var(--text-primary);"> Token Listrik</h1>
        <p class="page-subtitle" style="color:var(--text-secondary);font-size:14px;">Catat pembelian token untuk deteksi unit boros listrik</p>
      </div>
      <div class="card">
        <h3 class="card-title" id="tokenFormTitle">Form Input Token Listrik</h3>
        <form id="tokenForm" onsubmit="return ZeaApp.saveToken(event)" style="margin-top:16px">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label"> Pilih Unit</label>
              <select class="form-select" id="tokenUnit" required></select>
            </div>
            <div class="form-group">
              <label class="form-label"> Tanggal Beli</label>
              <input type="date" class="form-input" id="tokenDate" required>
            </div>
            <div class="form-group">
              <label class="form-label"> Nominal (Rp)</label>
              <input type="number" class="form-input" id="tokenNominal" placeholder="100000" required>
            </div>
            <div class="form-group">
              <label class="form-label"> Angka Meteran (kWh)</label>
              <input type="number" class="form-input" id="tokenMeteran" placeholder="1234" step="0.01">
            </div>
            <div class="form-group full-width">
              <label class="form-label"> Keterangan (opsional)</label>
              <input type="text" class="form-input" id="tokenKet" placeholder="Token rutin / darurat / dll">
            </div>
          </div>
          <div class="btn-group" style="margin-top:1rem;">
            <button type="submit" class="btn btn-primary"> Simpan Token</button>
            <button type="button" class="btn btn-secondary" id="cancelTokenEdit" style="display:none" onclick="ZeaApp.resetTokenForm()"> Batal Edit</button>
          </div>
        </form>
      </div>
      <div class="card">
        <div class="card-header"><h3 class="card-title"> Analisis Pemakaian Listrik</h3></div>
        <div class="zea-warning-box"> Unit dengan pengeluaran token <b>> Rp 500.000/bulan</b> ditandai sebagai <b style="color:var(--accent-danger)">BOROS</b></div>
        <div id="tokenAnalysis"></div>
      </div>
      <div class="card">
        <div class="card-header">
          <h3 class="card-title"> Riwayat Token Listrik</h3>
          <select class="form-select" id="filterTokenUnit" onchange="ZeaApp.renderToken()" style="padding:8px 12px;border:2px solid var(--border-color);border-radius:8px;max-width:200px;">
            <option value="">Semua Unit</option>
          </select>
        </div>
        <div class="table-container">
          <table>
            <thead><tr><th>Tanggal</th><th>Unit</th><th>Nominal</th><th>Meteran</th><th>Keterangan</th><th>Input By</th><th>Aksi</th></tr></thead>
            <tbody id="tokenTable"></tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Pengajuan -->
    <div class="zea-page" id="zea-page-pengajuan">
      <div class="page-header" style="margin-bottom:24px;">
        <h1 class="page-title" style="font-size:24px;font-weight:700;color:var(--text-primary);"> Pengajuan</h1>
      </div>
      <div class="zea-tabs" id="pengajuanTabs">
        <button class="zea-tab-btn active" data-filter="semua" onclick="ZeaApp.filterPengajuan('semua')">Semua</button>
        <button class="zea-tab-btn" data-filter="kasbon" onclick="ZeaApp.filterPengajuan('kasbon')"> Kasbon</button>
        <button class="zea-tab-btn" data-filter="cuti" onclick="ZeaApp.filterPengajuan('cuti')"> Cuti</button>
        <button class="zea-tab-btn" data-filter="reimburse" onclick="ZeaApp.filterPengajuan('reimburse')"> Reimburse</button>
      </div>
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Daftar Pengajuan</h3>
          <button class="btn btn-primary btn-sm" id="addPengajuanBtn" onclick="ZeaApp.showPengajuanModal()">+ Buat Pengajuan</button>
        </div>
        <div class="table-container">
          <table>
            <thead><tr><th>Tanggal</th><th>Nama</th><th>Jenis</th><th>Detail</th><th>Status</th><th>Aksi</th></tr></thead>
            <tbody id="pengajuanTable"></tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Report -->
    <div class="zea-page" id="zea-page-report">
      <div class="page-header" style="margin-bottom:24px;">
        <h1 class="page-title" style="font-size:24px;font-weight:700;color:var(--text-primary);"> Report Kerusakan</h1>
      </div>
      <div class="card">
        <h3 class="card-title" style="margin-bottom:20px">Form Report Kerusakan</h3>
        <form id="reportForm" onsubmit="return ZeaApp.saveReport(event)">
          <div class="form-group">
            <label class="form-label"> Pilih Unit</label>
            <select class="form-select" id="reportUnit" required></select>
          </div>
          <div class="form-group">
            <label class="form-label"> Prioritas</label>
            <select class="form-select" id="reportPriority">
              <option value="low"> Rendah</option>
              <option value="medium"> Sedang</option>
              <option value="high"> Tinggi - URGENT!</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label"> Keterangan Kerusakan</label>
            <textarea class="form-input" id="reportDesc" rows="4" required placeholder="Tulis semua kerusakan/komplain..."></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Kirim Report</button>
        </form>
      </div>
      <div class="card">
        <h3 class="card-title" style="margin-bottom:20px">Riwayat Report</h3>
        <div class="table-container">
          <table>
            <thead><tr><th>Tanggal</th><th>Unit</th><th>Prioritas</th><th>Keterangan</th><th>Reporter</th><th>Status</th></tr></thead>
            <tbody id="reportTable"></tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Absensi -->
    <div class="zea-page" id="zea-page-absensi">
      <div class="page-header" style="margin-bottom:24px;">
        <h1 class="page-title" style="font-size:24px;font-weight:700;color:var(--text-primary);"> Sistem Absensi</h1>
      </div>
      <div class="zea-warning-box">
        <b> Aturan Potongan:</b> 0-10 menit = Rp 0 | 11-30 menit = Rp 25.000 | >30 menit = 1 hari kerja | IZIN/SAKIT/ALFA = 1 hari kerja | LIBUR = Tidak ada potongan
      </div>
      <div class="card">
        <h3 class="card-title" style="margin-bottom:20px">Input Absensi</h3>
        <form id="absensiForm" onsubmit="return ZeaApp.saveAbsensi(event)">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label"> Pilih Staff</label>
              <select class="form-select" id="absensiStaff" required onchange="ZeaApp.updateAbsensiPreview()"></select>
            </div>
            <div class="form-group">
              <label class="form-label"> Tanggal</label>
              <input type="date" class="form-input" id="absensiDate" required>
            </div>
            <div class="form-group">
              <label class="form-label"> Status</label>
              <select class="form-select" id="absensiStatus" onchange="ZeaApp.updateAbsensiPreview()">
                <option value="hadir"> HADIR</option>
                <option value="izin"> IZIN</option>
                <option value="sakit"> SAKIT</option>
                <option value="alfa"> ALFA</option>
                <option value="libur"> LIBUR</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label"> Jam Masuk Aktual</label>
              <input type="time" class="form-input" id="absensiAktual" onchange="ZeaApp.updateAbsensiPreview()">
            </div>
          </div>
          <div id="absensiPreview" class="zea-info-box" style="display:none"></div>
          <button type="submit" class="btn btn-primary" style="margin-top:1rem;"> Simpan Absensi</button>
        </form>
      </div>
      <div class="card">
        <h3 class="card-title" style="margin-bottom:20px">Riwayat Absensi</h3>
        <div class="table-container">
          <table>
            <thead><tr><th>Tanggal</th><th>Nama</th><th>Status</th><th>Jadwal</th><th>Aktual</th><th>Terlambat</th><th>Potongan</th></tr></thead>
            <tbody id="absensiTable"></tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Gaji -->
    <div class="zea-page" id="zea-page-gaji">
      <div class="page-header" style="margin-bottom:24px;">
        <h1 class="page-title" style="font-size:24px;font-weight:700;color:var(--text-primary);"> Sistem Penggajian</h1>
      </div>
      <div class="zea-info-box">
        <b>Formula:</b> GAJI TRANSFER = Gaji Pokok - (Potongan Terlambat + Absen + Kasbon + Ganti Rugi)<br>
        <b>Periode Gaji:</b> Tanggal 27 bulan lalu s/d 26 bulan ini<br>
        <b>Uang Makan:</b> Catatan saja (sudah diambil cash harian, TIDAK ditransfer)<br>
        <b>Catatan:</b> Status LIBUR tidak dikenakan potongan
      </div>
      <div class="card">
        <h3 class="card-title" style="margin-bottom:20px">Proses Gaji</h3>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label"> Pilih Staff</label>
            <select class="form-select" id="gajiStaff" onchange="ZeaApp.calcGaji()"></select>
          </div>
          <div class="form-group">
            <label class="form-label"> Bulan Gaji</label>
            <select class="form-select" id="gajiBulan" onchange="ZeaApp.calcGaji()">
              <option value="0">Januari</option>
              <option value="1">Februari</option>
              <option value="2">Maret</option>
              <option value="3">April</option>
              <option value="4">Mei</option>
              <option value="5">Juni</option>
              <option value="6">Juli</option>
              <option value="7">Agustus</option>
              <option value="8">September</option>
              <option value="9">Oktober</option>
              <option value="10">November</option>
              <option value="11">Desember</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label"> Pot. Kasbon</label>
            <input type="number" class="form-input" id="gajiKasbon" value="0" onchange="ZeaApp.calcGaji()">
          </div>
          <div class="form-group">
            <label class="form-label"> Pot. Ganti Rugi</label>
            <input type="number" class="form-input" id="gajiGantiRugi" value="0" onchange="ZeaApp.calcGaji()">
          </div>
        </div>
        <div class="zea-slip-container" id="slipContainer" style="display:none">
          <div class="zea-slip-header"><h3> ZEA PROPERTY</h3><p>SLIP GAJI</p><p id="slipPeriode"></p></div>
          <div class="zea-slip-row"><span> Nama</span><span id="slipNama">-</span></div>
          <div class="zea-slip-row"><span> Gaji Pokok</span><span id="slipGaji">Rp 0</span></div>
          <hr style="margin:12px 0;border:none;border-top:1px dashed var(--border-color)">
          <div class="zea-slip-row"><span> Hari Masuk</span><span id="slipHari">0</span></div>
          <div class="zea-slip-row"><span> Uang Makan (Cash)</span><span id="slipMakan">Rp 0</span></div>
          <hr style="margin:12px 0;border:none;border-top:1px dashed var(--border-color)">
          <p style="font-weight:600;margin-bottom:8px;color:var(--accent-danger)">POTONGAN:</p>
          <div class="zea-slip-row" style="color:var(--accent-danger)"><span> Terlambat</span><span id="slipTelat">- Rp 0</span></div>
          <div class="zea-slip-row" style="color:var(--accent-danger)"><span> Absen (tidak termasuk libur)</span><span id="slipAbsen">- Rp 0</span></div>
          <div class="zea-slip-row" style="color:var(--accent-danger)"><span> Kasbon</span><span id="slipKasbon">- Rp 0</span></div>
          <div class="zea-slip-row" style="color:var(--accent-danger)"><span> Ganti Rugi</span><span id="slipGantiRugi">- Rp 0</span></div>
          <div class="zea-slip-row zea-slip-total" style="color:var(--accent-success)"><span> GAJI TRANSFER</span><span id="slipBersih">Rp 0</span></div>
        </div>
        <div style="margin-top:20px;display:flex;gap:12px;flex-wrap:wrap">
          <button class="btn btn-success" id="sendWABtn" onclick="ZeaApp.sendWA()"> Kirim WA</button>
          <button class="btn btn-primary" id="saveGajiBtn" onclick="ZeaApp.saveGaji()"> Simpan</button>
          <button class="btn btn-warning" id="editGajiBtn" style="display:none" onclick="ZeaApp.showEditGajiModal()"> Edit Gaji Pokok</button>
        </div>
      </div>
    </div>
    
    <!-- Akun -->
    <div class="zea-page" id="zea-page-akun">
      <div class="page-header" style="margin-bottom:24px;">
        <h1 class="page-title" style="font-size:24px;font-weight:700;color:var(--text-primary);"> Kelola Akun</h1>
      </div>
      <div class="zea-info-box"> Buat akun di sini, lalu tambahkan data staff di menu "Staff"</div>
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Daftar Akun</h3>
          <button class="btn btn-primary btn-sm" id="addAkunBtn" onclick="ZeaApp.showAkunModal()">+ Tambah Akun</button>
        </div>
        <div class="table-container">
          <table>
            <thead><tr><th>Username</th><th>Role</th><th>Status</th><th>Aksi</th></tr></thead>
            <tbody id="akunTable"></tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Panduan -->
    <div class="zea-page" id="zea-page-panduan">
      <div class="page-header" style="margin-bottom:24px;">
        <h1 class="page-title" style="font-size:24px;font-weight:700;color:var(--text-primary);"> Panduan</h1>
      </div>
      <div class="card">
        <div class="zea-info-box" style="background:rgba(245,158,11,0.1);border-color:var(--accent-warning)">
           <b>Firebase Connected!</b> Semua data tersimpan di cloud dan sync otomatis ke semua device.
        </div>
        <div class="zea-section-title"> Role & Akses</div>
        <p style="padding:12px 0;color:var(--text-primary);"> Owner: Full |  Admin: Edit semua |  Leader: Staff & Unit |  Marketing: View & Posting |  Staff: Data sendiri</p>
        <div class="zea-section-title"> Formula Gaji</div>
        <p style="padding:12px 0;color:var(--text-primary);">GAJI TRANSFER = Gaji Pokok - (Terlambat + Absen + Kasbon + Ganti Rugi)<br>Periode: 27 bulan lalu s/d 26 bulan ini<br>Uang makan = Cash harian (tidak ditransfer)<br>LIBUR = Tidak ada potongan gaji</p>
        <div class="zea-section-title"> Potongan Terlambat</div>
        <p style="padding:12px 0;color:var(--text-primary);">0-10 menit: Rp 0 | 11-30 menit: Rp 25.000 | >30 menit: 1 hari kerja</p>
        <div class="zea-section-title"> Bantuan</div>
        <p style="padding:12px 0;color:var(--text-primary);">Teknis: Wulan/Riko | Operasional: Iwa | Keputusan: Ibu Zea/King Bejh</p>
      </div>
    </div>
  </main>
</div>

<!-- Staff Modal -->
<div class="modal-overlay" id="staffModal">
  <div class="modal">
    <div class="modal-header"><h3 class="modal-title" id="staffModalTitle"> Tambah Staff</h3><button class="modal-close" onclick="ZeaApp.hideModal('staffModal')"></button></div>
    <div class="modal-body">
      <input type="hidden" id="staffEditId">
      <div class="form-group"><label>Pilih Akun Staff</label><select class="form-select" id="sAkun"></select></div>
      <div class="form-grid">
        <div class="form-group"><label>Nama Lengkap</label><input type="text" class="form-input" id="sNama"></div>
        <div class="form-group"><label>No WhatsApp</label><input type="text" class="form-input" id="sWA" placeholder="08xxx"></div>
      </div>
      <div class="form-group"><label>Cabang</label><select class="form-select" id="sCabang"><option>Gateway Pasteur</option><option>Jarrdin Cihampelas</option></select></div>
      <div class="form-grid">
        <div class="form-group"><label>Gaji Pokok (Rp)</label><input type="number" class="form-input" id="sGaji" value="3000000"></div>
        <div class="form-group"><label>Uang Makan/HARI (Rp)</label><input type="number" class="form-input" id="sMakan" value="20000"></div>
      </div>
      <div class="form-grid">
        <div class="form-group"><label>Jam Masuk</label><input type="time" class="form-input" id="sJamMasuk" value="08:00"></div>
        <div class="form-group"><label>Jam Pulang</label><input type="time" class="form-input" id="sJamPulang" value="17:00"></div>
      </div>
      <div class="form-group"><label>Libur Tetap</label><select class="form-select" id="sLibur"><option value="">Tidak ada</option><option>Senin</option><option>Selasa</option><option>Rabu</option><option>Kamis</option><option>Jumat</option><option>Sabtu</option><option>Minggu</option></select></div>
    </div>
    <div class="modal-footer"><button class="btn btn-secondary btn-sm" onclick="ZeaApp.hideModal('staffModal')">Batal</button><button class="btn btn-primary btn-sm" onclick="ZeaApp.saveStaff()"> Simpan</button></div>
  </div>
</div>

<!-- Pengajuan Modal -->
<div class="modal-overlay" id="pengajuanModal">
  <div class="modal">
    <div class="modal-header"><h3 class="modal-title"> Buat Pengajuan</h3><button class="modal-close" onclick="ZeaApp.hideModal('pengajuanModal')"></button></div>
    <div class="modal-body">
      <div class="form-group"><label>Jenis</label><select class="form-select" id="pJenis" onchange="ZeaApp.onPengajuanJenisChange()"><option value="kasbon"> Kasbon</option><option value="cuti"> Cuti</option><option value="reimburse"> Reimburse</option></select></div>
      <div class="form-group" id="pNominalG"><label>Nominal (Rp)</label><input type="number" class="form-input" id="pNominal" value="0"></div>
      <div class="form-group" id="pDurasiG" style="display:none"><label>Durasi (Hari)</label><input type="number" class="form-input" id="pDurasi" value="1"></div>
      <div class="form-group"><label>Keterangan</label><textarea class="form-input" id="pKet" rows="3"></textarea></div>
      <div class="form-group" id="pBuktiG" style="display:none"><label>Bukti</label><input type="text" class="form-input" id="pBukti"></div>
    </div>
    <div class="modal-footer"><button class="btn btn-secondary btn-sm" onclick="ZeaApp.hideModal('pengajuanModal')">Batal</button><button class="btn btn-primary btn-sm" onclick="ZeaApp.savePengajuan()">Kirim</button></div>
  </div>
</div>

<!-- Akun Modal -->
<div class="modal-overlay" id="akunModal">
  <div class="modal">
    <div class="modal-header"><h3 class="modal-title"> Tambah Akun</h3><button class="modal-close" onclick="ZeaApp.hideModal('akunModal')"></button></div>
    <div class="modal-body">
      <div class="form-group"><label>Username</label><input type="text" class="form-input" id="aUser"></div>
      <div class="form-group"><label>Password</label><input type="text" class="form-input" id="aPass"></div>
      <div class="form-group"><label>Role</label><select class="form-select" id="aRole"><option value="staff"> Staff</option><option value="marketing"> Marketing</option><option value="leader"> Leader</option><option value="admin"> Admin</option><option value="owner"> Owner</option></select></div>
    </div>
    <div class="modal-footer"><button class="btn btn-secondary btn-sm" onclick="ZeaApp.hideModal('akunModal')">Batal</button><button class="btn btn-primary btn-sm" onclick="ZeaApp.saveAkun()"> Simpan</button></div>
  </div>
</div>

<!-- Unit Detail Modal -->
<div class="modal-overlay" id="unitDetailModal">
  <div class="modal">
    <div class="modal-header"><h3 class="modal-title"> Detail Unit</h3><button class="modal-close" onclick="ZeaApp.hideModal('unitDetailModal')"></button></div>
    <div class="modal-body" id="unitDetailContent"></div>
  </div>
</div>

<!-- Edit Gaji Modal -->
<div class="modal-overlay" id="editGajiModal">
  <div class="modal">
    <div class="modal-header"><h3 class="modal-title"> Edit Gaji Pokok Staff</h3><button class="modal-close" onclick="ZeaApp.hideModal('editGajiModal')"></button></div>
    <div class="modal-body">
      <input type="hidden" id="editGajiStaffId">
      <div class="zea-info-box"> Fitur khusus Owner untuk memperbaiki data gaji yang keliru.</div>
      <p style="font-weight:700;margin:16px 0 8px;color:var(--text-primary);">Staff: <span id="editGajiStaffName" style="color:var(--accent-1)"></span></p>
      <div class="form-grid">
        <div class="form-group"><label> Gaji Pokok (Rp)</label><input type="number" class="form-input" id="editGajiPokok" value="3000000"></div>
        <div class="form-group"><label> Uang Makan/Hari (Rp)</label><input type="number" class="form-input" id="editGajiMakan" value="20000"></div>
      </div>
      <div class="zea-warning-box"> Perubahan akan mempengaruhi perhitungan gaji.</div>
    </div>
    <div class="modal-footer"><button class="btn btn-secondary btn-sm" onclick="ZeaApp.hideModal('editGajiModal')">Batal</button><button class="btn btn-primary btn-sm" onclick="ZeaApp.saveEditGaji()"> Simpan Perubahan</button></div>
  </div>
</div>
```

  </div>

  <!-- ============================================================
       UNIFIED JAVASCRIPT - SaldoApp & ZeaApp
       ============================================================ -->

  <script>
  /* ============================================================
     FIREBASE CONFIGURATION - Unified to saldozeav2
     ============================================================ */
  const firebaseConfig = {
    apiKey: "AIzaSyA2lSXx1OJYMIm3YdVMX1h0fSp6EfNIH_s",
    authDomain: "saldozeav2.firebaseapp.com",
    databaseURL: "https://saldozeav2-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "saldozeav2",
    storageBucket: "saldozeav2.firebasestorage.app",
    messagingSenderId: "340325272493",
    appId: "1:340325272493:web:21f6d7485ff94f3f88ef24"
  };
  
  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  
  /* ============================================================
     GLOBAL VARIABLES
     ============================================================ */
  let currentUser = null;
  let currentApp = 'saldozea';
  let saldozeaUserData = null;
  let zeacrewUserData = null;
  let soundEnabled = true;
  let alarmDismissed = false;
  let onlineUsers = {};
  
  /* ============================================================
     APP SELECTION
     ============================================================ */
  /* ============================================================
     BUSINESS DATE HELPERS (WIB-aware, cutoff at 08:00)
     ============================================================ */
  function getBusinessDate() {
    const now = new Date();
    if (now.getHours() < 8) now.setDate(now.getDate() - 1);
    const y = now.getFullYear();
    const m = String(now.getMonth() + 1).padStart(2, '0');
    const d = String(now.getDate()).padStart(2, '0');
    return y + '-' + m + '-' + d;
  }
  
  function getBusinessMonth() {
    const now = new Date();
    if (now.getHours() < 8) now.setDate(now.getDate() - 1);
    const y = now.getFullYear();
    const m = String(now.getMonth() + 1).padStart(2, '0');
    return y + '-' + m;
  }
  
  function selectApp(appName) {
    currentApp = appName;
    document.getElementById('btnSaldoZea').classList.toggle('active', appName === 'saldozea');
    document.getElementById('btnZeaCrew').classList.toggle('active', appName === 'zeacrew');
  }
  
  /* ============================================================
     LOGIN SYSTEM
     ============================================================ */
  function doLogin() {
    const username = document.getElementById('loginUsername').value.trim().toLowerCase();
    const password = document.getElementById('loginPassword').value;
    const errorEl = document.getElementById('loginError');
    
    if (!username || !password) {
      errorEl.textContent = 'Username dan password wajib diisi!';
      errorEl.classList.add('show');
      return;
    }
    
    // Check SaldoZea users
    if (currentApp === 'saldozea') {
      const ACCOUNTS = [
        { username: 'KINGBEJH',  password: 'kotabaru99', role: 'supreme', label: ' SUPREME' },
        { username: 'IBUZEA',    password: '190277',      role: 'owner',   label: ' OWNER'   },
        { username: 'ADMINZEA',  password: 'zeakelola',   role: 'admin',   label: ' ADMIN'   },
        { username: 'ZEACREW',   password: 'zeagwp',      role: 'crew',    label: ' CREW'    },
      ];
      const BUG_WA_NUMBER = '6289512443677'; // eslint-disable-line
      const found = ACCOUNTS.find(a => a.username.toLowerCase() === username.toLowerCase() && a.password === password);
      if (found) {
        saldozeaUserData = { username: found.username, role: found.role, name: found.label };
        currentUser = saldozeaUserData;
        startSaldoZeaApp();
        return;
      }
    }
    
    // Check ZeaCrew users from Firebase
    if (currentApp === 'zeacrew') {
      db.ref('zeacrew/akun').once('value').then(snapshot => {
        const akunData = snapshot.val() || {};
        let foundUser = null;
        
        Object.keys(akunData).forEach(key => {
          const akun = akunData[key];
          if (akun.username.toLowerCase() === username && akun.password === password) {
            foundUser = { id: key, ...akun };
          }
        });
        
        if (foundUser) {
          zeacrewUserData = foundUser;
          currentUser = foundUser;
          startZeaCrewApp();
        } else {
          // Fallback default accounts
          const defaultAccounts = {
            'owner': { password: 'owner2026', role: 'owner', name: 'Owner' },
            'admin': { password: 'admin2026', role: 'admin', name: 'Admin' },
            'leader': { password: 'leader2026', role: 'leader', name: 'Leader' },
            'marketing': { password: 'marketing2026', role: 'marketing', name: 'Marketing' },
            'staff': { password: 'staff2026', role: 'staff', name: 'Staff' }
          };
          
          if (defaultAccounts[username] && defaultAccounts[username].password === password) {
            zeacrewUserData = { username, ...defaultAccounts[username] };
            currentUser = zeacrewUserData;
            startZeaCrewApp();
          } else {
            errorEl.textContent = 'Username atau password salah!';
            errorEl.classList.add('show');
          }
        }
      }).catch(err => {
        errorEl.textContent = 'Error: ' + err.message;
        errorEl.classList.add('show');
      });
      return;
    }
    
    errorEl.textContent = 'Username atau password salah!';
    errorEl.classList.add('show');
  }
  
  function doLogout() {
    if (currentUser && currentUser.username) {
      db.ref('saldozea/onlineUsers/' + currentUser.username).remove();
      db.ref('zeacrew/onlineUsers/' + currentUser.username).remove();
    }
    // Cleanup Firebase listeners
    db.ref('saldozea/units').off();
    db.ref('saldozea/transactions').off();
    db.ref('saldozea/rentals').off();
    db.ref('saldozea/ledMessage').off();
    db.ref('saldozea/onlineUsers').off();
    db.ref('zeacrew/staff').off();
    db.ref('zeacrew/unit').off();
    db.ref('zeacrew/token').off();
    db.ref('zeacrew/pengajuan').off();
    db.ref('zeacrew/report').off();
    db.ref('zeacrew/absensi').off();
    db.ref('zeacrew/akun').off();
    db.ref('zeacrew/feed').off();
    db.ref('.info/connected').off();
    // Cleanup intervals
    if (SaldoApp.intervals) SaldoApp.intervals.forEach(clearInterval);
    if (ZeaApp.intervals) ZeaApp.intervals.forEach(clearInterval);
    SaldoApp.intervals = [];
    ZeaApp.intervals = [];
    // Reset state
    SaldoApp.data = {};
    SaldoApp.units = [];
    ZeaApp.data = { staff:{}, unit:{}, token:{}, pengajuan:{}, report:{}, absensi:{}, gaji:{}, akun:{}, feed:{} };
    currentUser = null;
    saldozeaUserData = null;
    zeacrewUserData = null;
    // Reset UI
    document.getElementById('loginScreen').classList.remove('hidden');
    document.getElementById('saldozeaApp').classList.remove('active');
    document.getElementById('zeacrewApp').classList.remove('active');
    document.body.classList.remove('crew-mode');
    document.getElementById('crewBanner').classList.remove('show');
    document.getElementById('loginUsername').value = '';
    document.getElementById('loginPassword').value = '';
    document.getElementById('loginError').classList.remove('show');
    document.getElementById('recentTransactions').innerHTML = '';
    document.getElementById('historyTable').innerHTML = '';
  }
  
  /* ============================================================
     START APPS
     ============================================================ */
  function startSaldoZeaApp() {
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('saldozeaApp').classList.add('active');
    
    // Setup user badge
    const badge = document.getElementById('userBadge');
    badge.textContent = currentUser.role;
    badge.className = 'role-badge ' + currentUser.role;
    
    // Setup crew mode
    if (currentUser.role === 'crew') {
      document.body.classList.add('crew-mode');
      document.getElementById('crewBanner').classList.add('show');
    }
    
    // Show supreme tab for supreme user
    if (currentUser.role === 'supreme') {
      document.getElementById('supremeNavBtn').style.display = 'inline-flex';
    }
    
    // Initialize SaldoZea
    SaldoApp.init();
  }
  
  function startZeaCrewApp() {
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('zeacrewApp').classList.add('active');
    
    // Setup user badge
    const badge = document.getElementById('zeaUserBadge');
    badge.textContent = currentUser.role;
    badge.className = 'role-badge ' + currentUser.role;
    
    // Initialize ZeaCrew
    ZeaApp.init();
  }
  
  // Enter key on password field
  document.getElementById('loginPassword').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') doLogin();
  });

  /* ============================================================
     SALDOZEA APP NAMESPACE
     ============================================================ */
  const SaldoApp = {
    data: {},
    units: [],
    currentTab: 'dashboard',
    intervals: [],
    ledSpeed: 28,
    selectedLedColor: 'led-green',
    
    init: function() {
      this.setupClock();
      this.setupFirebaseListeners();
      this.setupOnlinePresence();
      this.switchTab('dashboard');
      
      // Set default dates
      const today = new Date();
      document.getElementById('filterDate').value = today.toISOString().split('T')[0];
      document.getElementById('reportStart').value = today.toISOString().split('T')[0];
      document.getElementById('reportEnd').value = today.toISOString().split('T')[0];
    },
    
    setupClock: function() {
      const updateClock = () => {
        const now = new Date();
        const dateStr = now.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
        const timeStr = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        document.getElementById('headerDate').textContent = dateStr;
        document.getElementById('headerClock').textContent = timeStr;
      };
      updateClock();
      this.intervals.push(setInterval(updateClock, 1000));
    },
    
    setupFirebaseListeners: function() {
      // Units listener
      db.ref('saldozea/units').on('value', (snapshot) => {
        this.units = snapshot.val() || [];
        // Fix: handle both array and object from Firebase
        const raw = snapshot.val();
        if (!raw) { this.units = []; }
        else if (Array.isArray(raw)) { this.units = raw.filter(u => u !== null); }
        else { this.units = Object.values(raw); }
        this.renderUnitGrid();
        this.updateHeaderStats();
        this.checkCheckoutAlarms();
      });
      
      // Transactions listener
      db.ref('saldozea/transactions').on('value', (snapshot) => {
        this.data.transactions = snapshot.val() || {};
        this.updateDashboard();
        this.renderRecentTransactions();
      });
      
      // Rentals listener
      db.ref('saldozea/rentals').on('value', (snapshot) => {
        this.data.rentals = snapshot.val() || {};
        this.updateDashboard();
        this.checkCheckoutAlarms();
      });
      
      // LED message listener
      db.ref('saldozea/ledMessage').on('value', (snapshot) => {
        const msg = snapshot.val();
        if (msg) {
          document.getElementById('ledBarInner').textContent = msg.text || msg;
          if (msg.color) {
            this.selectedLedColor = msg.color;
            document.getElementById('ledBar').className = 'led-bar ' + msg.color;
          }
          if (msg.speed) {
            this.ledSpeed = msg.speed;
            this.updateLedSpeed();
          }
        }
      });
      
      // Connection status
      db.ref('.info/connected').on('value', (snapshot) => {
        const status = document.getElementById('connectionStatus');
        if (snapshot.val()) {
          status.className = 'connection-status online';
          status.textContent = ' Terhubung';
        } else {
          status.className = 'connection-status offline';
          status.textContent = ' Offline';
        }
      });
    },
    
    setupOnlinePresence: function() {
      if (!currentUser) return;
      
      const userRef = db.ref(`saldozea/onlineUsers/${currentUser.username}`);
      const connectedRef = db.ref('.info/connected');
      
      connectedRef.on('value', (snap) => {
        if (snap.val()) {
          userRef.set({
            role: currentUser.role,
            name: currentUser.name || currentUser.username,
            timestamp: firebase.database.ServerValue.TIMESTAMP
          });
          userRef.onDisconnect().remove();
        }
      });
      
      // Listen for online users
      db.ref('saldozea/onlineUsers').on('value', (snapshot) => {
        const users = snapshot.val() || {};
        this.renderOnlinePanel(users);
      });
    },
    
    renderOnlinePanel: function(users) {
      const panel = document.getElementById('onlinePanel');
      panel.innerHTML = '';
      
      Object.keys(users).forEach(username => {
        if (username === currentUser.username) return;
        const user = users[username];
        const pill = document.createElement('div');
        pill.className = 'online-pill ' + (user.role || 'crew');
        pill.innerHTML = `<div class="online-dot"></div><span>${user.name || username}</span>`;
        panel.appendChild(pill);
      });
    },
    
    switchTab: function(tabName) {
      this.currentTab = tabName;
      
      // Update nav buttons
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tab === tabName);
      });
      
      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(tabName).classList.add('active');
      
      // Tab-specific actions
      if (tabName === 'dashboard') this.updateDashboard();
      if (tabName === 'units') this.renderUnitGrid();
      if (tabName === 'history') this.renderHistory();
      if (tabName === 'transaction') this.renderRecentTransactions();
    },
    
    updateDashboard: function() {
      const today = new Date();
      const todayStr = today.toISOString().split('T')[0];
      
      // Get today's transactions
      let todayIncome = 0, todayExpense = 0, todayCash = 0, todayTransfer = 0, todayQR = 0;
      let todayRentalIncome = 0, todayOtherIncome = 0;
      let marketingStats = {}, unitStats = {}, durationStats = {};
      let todayGuests = 0, todayUnitsUsed = new Set();
      
      const transactions = this.data.transactions || {};
      Object.values(transactions).forEach(t => {
        const tDate = t.timestamp ? new Date(t.timestamp).toISOString().split('T')[0] : '';
        if (tDate === todayStr) {
          if (t.type === 'income') {
            todayIncome += parseFloat(t.amount) || 0;
            if (t.source && t.source.toLowerCase().includes('sewa')) {
              todayRentalIncome += parseFloat(t.amount) || 0;
            } else {
              todayOtherIncome += parseFloat(t.amount) || 0;
            }
            if (t.method === 'Cash') todayCash += parseFloat(t.amount) || 0;
            if (t.method === 'Transfer') todayTransfer += parseFloat(t.amount) || 0;
            if (t.method === 'QR') todayQR += parseFloat(t.amount) || 0;
          } else if (t.type === 'expense') {
            todayExpense += parseFloat(t.amount) || 0;
          }
        }
      });
      
      // Get rental data
      const rentals = this.data.rentals || {};
      Object.values(rentals).forEach(r => {
        const rDate = r.timestamp ? new Date(r.timestamp).toISOString().split('T')[0] : '';
        if (rDate === todayStr) {
          todayIncome += parseFloat(r.totalPayment) || 0;
          todayRentalIncome += parseFloat(r.totalPayment) || 0;
          todayCash += parseFloat(r.cash) || 0;
          todayTransfer += parseFloat(r.transfer) || 0;
          todayQR += parseFloat(r.qr) || 0;
          
          const isCharge = (r.duration === '1J' || r.duration === '2J');
          if (!isCharge) {
            todayGuests++;
            todayUnitsUsed.add(r.unit);
          }
          
          // Marketing stats
          if (r.marketing) {
            marketingStats[r.marketing] = (marketingStats[r.marketing] || 0) + 1;
          }
          // Unit stats
          if (r.unit) {
            unitStats[r.unit] = (unitStats[r.unit] || 0) + 1;
          }
          // Duration stats
          if (r.duration) {
            durationStats[r.duration] = (durationStats[r.duration] || 0) + 1;
          }
        }
      });
      
      // Unpaid fee calculation
      let unpaidFee = 0;
      let feeByMarketing = {};
      Object.values(this.data.rentals || {}).forEach(r => {
        const rDate = r.timestamp ? new Date(r.timestamp).toISOString().split('T')[0] : '';
        if (rDate === todayStr && parseFloat(r.marketingFee) > 0 && r.paymentStatus !== 'Lunas') {
          unpaidFee += parseFloat(r.marketingFee) || 0;
          const m = r.marketing || 'Unknown';
          feeByMarketing[m] = (feeByMarketing[m] || 0) + (parseFloat(r.marketingFee) || 0);
        }
      });
      
      // Expense by category
      let expenseByCat = {};
      Object.values(this.data.transactions || {}).forEach(t => {
        const tDate = t.timestamp ? new Date(t.timestamp).toISOString().split('T')[0] : '';
        if (tDate === todayStr && t.type === 'expense' && t.category) {
          expenseByCat[t.category] = (expenseByCat[t.category] || 0) + (parseFloat(t.amount) || 0);
        }
      });
      
      // Update stats display
      document.getElementById('todaySaldo').textContent = this.formatRupiah(todayIncome - todayExpense);
      document.getElementById('todayIncome').textContent = this.formatRupiah(todayIncome);
      document.getElementById('todayExpense').textContent = this.formatRupiah(todayExpense);
      document.getElementById('todayCash').textContent = this.formatRupiah(todayCash);
      document.getElementById('todayTransfer').textContent = this.formatRupiah(todayTransfer);
      document.getElementById('todayQR').textContent = this.formatRupiah(todayQR);
      document.getElementById('todayRentalIncome').textContent = this.formatRupiah(todayRentalIncome);
      document.getElementById('todayOtherIncome').textContent = this.formatRupiah(todayOtherIncome);
      document.getElementById('todayGuests').textContent = todayGuests;
      document.getElementById('todayUnitsUsed').textContent = todayUnitsUsed.size;
      
      // Unpaid fee display
      const unpaidFeeEl = document.getElementById('unpaidFee');
      if (unpaidFeeEl) unpaidFeeEl.textContent = this.formatRupiah(unpaidFee);
      const topFee = Object.entries(feeByMarketing).sort((a,b) => b[1]-a[1])[0];
      const feeBreakdownEl = document.getElementById('feeBreakdown');
      if (feeBreakdownEl) feeBreakdownEl.innerHTML = topFee
        ? '<span>' + topFee[0] + ': ' + this.formatRupiah(topFee[1]) + '</span>'
        : '<span>-</span>';
      
      // Top expense category
      const topExpCat = Object.entries(expenseByCat).sort((a,b) => b[1]-a[1])[0];
      const topExpCatEl = document.getElementById('topExpenseCategory');
      if (topExpCatEl) topExpCatEl.innerHTML = topExpCat
        ? '<span class="stat-breakdown-item">' + topExpCat[0] + ': ' + this.formatRupiah(topExpCat[1]) + '</span>'
        : '<span class="stat-breakdown-item">-</span>';
      
      // Top marketing
      const topMarketing = Object.entries(marketingStats).sort((a, b) => b[1] - a[1]).slice(0, 5);
      const topMarketingEl = document.getElementById('topMarketing');
      topMarketingEl.innerHTML = topMarketing.length ? topMarketing.map((m, i) => `
        <div class="top-list-item">
          <span class="rank">${i + 1}.</span>
          <span class="name">${m[0]}</span>
          <span class="value">${m[1]} tamu</span>
        </div>
      `).join('') : '<div class="empty-state"><div class="empty-state-text">Belum ada data</div></div>';
      
      // Top units
      const topUnits = Object.entries(unitStats).sort((a, b) => b[1] - a[1]).slice(0, 5);
      const topUnitsEl = document.getElementById('topUnits');
      topUnitsEl.innerHTML = topUnits.length ? topUnits.map((u, i) => `
        <div class="top-list-item">
          <span class="rank">${i + 1}.</span>
          <span class="name">${u[0]}</span>
          <span class="value">${u[1]}x</span>
        </div>
      `).join('') : '<div class="empty-state"><div class="empty-state-text">Belum ada data</div></div>';
      
      // Top durations
      const topDurations = Object.entries(durationStats).sort((a, b) => b[1] - a[1]).slice(0, 5);
      const topDurationsEl = document.getElementById('topDurations');
      topDurationsEl.innerHTML = topDurations.length ? topDurations.map((d, i) => `
        <div class="top-list-item">
          <span class="rank">${i + 1}.</span>
          <span class="name">${this.formatDuration(d[0])}</span>
          <span class="value">${d[1]}x</span>
        </div>
      `).join('') : '<div class="empty-state"><div class="empty-state-text">Belum ada data</div></div>';
      
      // Month stats
      this.updateMonthStats();
      
      // Update header
      document.getElementById('headerSaldo').textContent = this.formatRupiah(todayIncome - todayExpense);
    },
    
    updateMonthStats: function() {
      const now = new Date();
      const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
      const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0);
      
      let monthIncome = 0, monthGuests = 0;
      
      const transactions = this.data.transactions || {};
      Object.values(transactions).forEach(t => {
        if (t.timestamp) {
          const tDate = new Date(t.timestamp);
          if (tDate >= monthStart && tDate <= monthEnd && t.type === 'income') {
            monthIncome += parseFloat(t.amount) || 0;
          }
        }
      });
      
      const rentals = this.data.rentals || {};
      Object.values(rentals).forEach(r => {
        if (r.timestamp) {
          const rDate = new Date(r.timestamp);
          if (rDate >= monthStart && rDate <= monthEnd) {
            monthIncome += parseFloat(r.totalPayment) || 0;
            monthGuests++;
          }
        }
      });
      
      document.getElementById('monthSaldo').textContent = this.formatRupiah(monthIncome);
      document.getElementById('monthGuests').textContent = monthGuests;
    },
    
    updateHeaderStats: function() {
      const available = this.units.filter(u => !u.occupied).length;
      document.getElementById('headerAvailable').textContent = available;
    },
    
    checkCheckoutAlarms: function() {
      const now = new Date();
      
      // Reset notified checkouts at 08:00
      if (now.getHours() === 8 && now.getMinutes() < 1) {
        alarmDismissed = false;
      }
      
      const checkoutSoon = [];
      const checkoutNow = [];
      
      this.units.forEach(unit => {
        if (unit.occupied && unit.checkOutTime) {
          const checkout = new Date(unit.checkOutTime);
          const diffMinutes = (checkout - now) / (1000 * 60);
          
          if (diffMinutes <= 0 && diffMinutes > -60) {
            checkoutNow.push(unit.number);
          } else if (diffMinutes > 0 && diffMinutes <= 30) {
            checkoutSoon.push({ unit: unit.number, minutes: Math.floor(diffMinutes) });
          }
        }
      });
      
      // Update alert
      const alertEl = document.getElementById('checkoutAlert');
      const alertList = document.getElementById('checkoutAlertList');
      
      if (checkoutSoon.length > 0) {
        alertEl.style.display = 'flex';
        alertList.innerHTML = checkoutSoon.map(c => `${c.unit} (${c.minutes} menit lagi)`).join(', ');
      } else {
        alertEl.style.display = 'none';
      }
      
      // Update badge
      const badge = document.getElementById('checkoutBadge');
      if (checkoutSoon.length > 0) {
        badge.textContent = checkoutSoon.length;
        badge.style.display = 'inline-block';
      } else {
        badge.style.display = 'none';
      }
      
      // Alarm for checkout now
      if (checkoutNow.length > 0 && !alarmDismissed && soundEnabled) {
        this.showAlarm(checkoutNow);
      }
    },
    
    showAlarm: function(units) {
      const overlay = document.getElementById('alarmOverlay');
      const list = document.getElementById('alarmUnitList');
      list.innerHTML = units.map(u => `<div style="font-size:1.2rem;font-weight:700;">${u}</div>`).join('');
      overlay.classList.add('active');
      
      // Play sound
      if (soundEnabled) {
        this.playSound('alarm');
      }
    },
    
    dismissAlarm: function() {
      document.getElementById('alarmOverlay').classList.remove('active');
      alarmDismissed = true;
      setTimeout(() => { alarmDismissed = false; }, 60000);
    },
    
    playSound: function(type) {
      // Simple beep using Web Audio API
      try {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        
        if (type === 'alarm') {
          oscillator.frequency.value = 800;
          oscillator.type = 'square';
          gainNode.gain.value = 0.3;
        } else {
          oscillator.frequency.value = 600;
          oscillator.type = 'sine';
          gainNode.gain.value = 0.2;
        }
        
        oscillator.start();
        oscillator.stop(audioCtx.currentTime + 0.2);
      } catch (e) {
        console.log('Audio not supported');
      }
    },
    
    toggleNotification: function() {
      soundEnabled = !soundEnabled;
      const btn = document.getElementById('notifToggle');
      btn.className = 'notif-toggle ' + (soundEnabled ? 'on' : 'off');
      btn.textContent = soundEnabled ? '' : '';
      this.showToast(soundEnabled ? 'Notifikasi suara AKTIF' : 'Notifikasi suara NONAKTIF', 'info');
    },
    
    renderUnitGrid: function() {
      const container = document.getElementById('unitGridContainer');
      const search = document.getElementById('searchUnit').value.toLowerCase();
      const typeFilter = document.getElementById('filterUnitType').value;
      const statusFilter = document.getElementById('filterUnitStatus').value;
      
      let available = 0, occupied = 0, checkoutSoon = 0;
      const now = new Date();
      
      // Group by type
      const grouped = { 'Studio': [], '1BR': [], '2BR': [] };
      
      this.units.forEach(unit => {
        // Apply filters
        if (search && !unit.number.toLowerCase().includes(search)) return;
        if (typeFilter && unit.type !== typeFilter) return;
        
        // Check status
        let status = 'available';
        if (unit.occupied) {
          status = 'occupied';
          if (unit.checkOutTime) {
            const checkout = new Date(unit.checkOutTime);
            const diffMinutes = (checkout - now) / (1000 * 60);
            if (diffMinutes <= 30 && diffMinutes > 0) {
              status = 'checkout-soon';
            }
          }
        }
        
        if (statusFilter && status !== statusFilter) return;
        
        // Count
        if (status === 'available') available++;
        else if (status === 'occupied') occupied++;
        else if (status === 'checkout-soon') checkoutSoon++;
        
        // Add to group
        if (grouped[unit.type]) {
          grouped[unit.type].push({ ...unit, status });
        }
      });
      
      // Update counts
      document.getElementById('availableCount').textContent = available;
      document.getElementById('occupiedCount').textContent = occupied;
      document.getElementById('checkoutSoonCountStat').textContent = checkoutSoon;
      
      // Render groups
      let html = '';
      Object.keys(grouped).forEach(type => {
        const units = grouped[type];
        if (units.length === 0) return;
        
        html += `
          <div class="unit-section">
            <div class="unit-section-title">
              ${type === 'Studio' ? '' : type === '1BR' ? '' : ''} ${type}
              <span class="count">${units.length} unit</span>
            </div>
            <div class="unit-grid">
              ${units.map(u => this.renderUnitCard(u)).join('')}
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html || '<div class="empty-state"><div class="empty-state-text">Tidak ada unit</div></div>';
    },
    
    renderUnitCard: function(unit) {
      const now = new Date();
      let checkoutTime = '';
      let guestInfo = '';
      
      if (unit.occupied && unit.checkOutTime) {
        const checkout = new Date(unit.checkOutTime);
        const diffMs = checkout - now;
        const diffHrs = Math.floor(diffMs / (1000 * 60 * 60));
        const diffMins = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
        
        if (diffMs > 0) {
          checkoutTime = `${diffHrs}j ${diffMins}m`;
        } else {
          checkoutTime = 'OVERDUE';
        }
        
        guestInfo = unit.guestIdentity || 'Tamu';
      }
      
      return `
        <div class="unit-card ${unit.status}" onclick="SaldoApp.showUnitDetail('${unit.number}')">
          <div class="unit-header">
            <span class="unit-number">${unit.number}</span>
            <span class="unit-type-badge">${unit.type}</span>
          </div>
          <div class="unit-status">
            ${unit.status === 'available' ? ' Tersedia' : unit.status === 'occupied' ? ' Terisi' : ' Segera CO'}
          </div>
          ${unit.occupied ? `
            <div class="unit-info">
              <div class="unit-guest"> ${guestInfo}</div>
              <div class="unit-timer"> ${checkoutTime}</div>
            </div>
          ` : ''}
        </div>
      `;
    },
    
    showUnitDetail: function(unitNumber) {
      const unit = this.units.find(u => u.number === unitNumber);
      if (!unit) return;
      
      const modalBody = document.getElementById('modalBody');
      const modalTitle = document.getElementById('modalTitle');
      const modalFooter = document.getElementById('modalFooter');
      
      modalTitle.textContent = `Detail Unit ${unit.number}`;
      
      modalBody.innerHTML = `
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Nomor Unit</label>
            <input type="text" class="form-input readonly" value="${unit.number}" readonly>
          </div>
          <div class="form-group">
            <label class="form-label">Tipe</label>
            <input type="text" class="form-input readonly" value="${unit.type}" readonly>
          </div>
          <div class="form-group">
            <label class="form-label">Status</label>
            <input type="text" class="form-input readonly" value="${unit.occupied ? 'Terisi' : 'Tersedia'}" readonly>
          </div>
          ${unit.occupied ? `
            <div class="form-group">
              <label class="form-label">Check-in</label>
              <input type="text" class="form-input readonly" value="${unit.checkInTime || '-'}" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">Check-out</label>
              <input type="text" class="form-input readonly" value="${unit.checkOutTime || '-'}" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">Marketing</label>
              <input type="text" class="form-input readonly" value="${unit.marketing || '-'}" readonly>
            </div>
            <div class="form-group full-width">
              <label class="form-label">Identitas Tamu</label>
              <input type="text" class="form-input readonly" value="${unit.guestIdentity || '-'}" readonly>
            </div>
          ` : ''}
        </div>
      `;
      
      modalFooter.innerHTML = `
        <button class="btn btn-secondary" onclick="SaldoApp.closeModal()">Tutup</button>
        ${unit.occupied ? `<button class="btn btn-success" onclick="SaldoApp.checkoutUnit('${unit.number}')">Checkout</button>` : ''}
      `;
      
      document.getElementById('modalOverlay').classList.add('active');
    },
    
    checkoutUnit: function(unitNumber) {
      const unitIndex = this.units.findIndex(u => u.number === unitNumber);
      if (unitIndex === -1) return;
      
      // Update unit status
      this.units[unitIndex].occupied = false;
      this.units[unitIndex].checkInTime = null;
      this.units[unitIndex].checkOutTime = null;
      this.units[unitIndex].marketing = null;
      this.units[unitIndex].guestIdentity = null;
      
      // Save to Firebase
      this.saveUnits();
      
      this.closeModal();
      this.showToast(`Unit ${unitNumber} berhasil checkout!`, 'success');
    },
    
    closeModal: function() {
      document.getElementById('modalOverlay').classList.remove('active');
    },
    
    populateUnitNumbers: function() {
      const type = document.getElementById('unitType').value;
      const select = document.getElementById('unitNumber');
      select.innerHTML = '<option value="">Pilih Unit</option>';
      
      if (!type) return;
      
      const availableUnits = this.units.filter(u => u.type === type && !u.occupied);
      availableUnits.forEach(u => {
        const option = document.createElement('option');
        option.value = u.number;
        option.textContent = u.number;
        select.appendChild(option);
      });
    },
    
    saveUnits: function() {
      const unitsObj = {};
      this.units.forEach((u, i) => { unitsObj[u.number || i] = u; });
      db.ref('saldozea/units').set(unitsObj);
    },
    
    onMarketingChange: function(val) {
      document.getElementById('otherMarketingGroup').style.display = val === 'other' ? 'block' : 'none';
      if (val !== 'other') document.getElementById('otherMarketing').value = '';
    },
    
    calcCheckout: function() {
      const duration = document.getElementById('duration').value;
      const checkIn = document.getElementById('checkIn').value;
      
      if (!duration || !checkIn) return;
      
      const [hours, minutes] = checkIn.split(':').map(Number);
      const checkInDate = new Date();
      checkInDate.setHours(hours, minutes, 0, 0);
      
      let durationHours = 0;
      if (duration === 'PM') durationHours = 12;
      else if (duration === 'FD') durationHours = 24;
      else durationHours = parseInt(duration) || 0;
      
      const checkOutDate = new Date(checkInDate.getTime() + durationHours * 60 * 60 * 1000);
      const coH = String(checkOutDate.getHours()).padStart(2, '0');
      const coM = String(checkOutDate.getMinutes()).padStart(2, '0');
      document.getElementById('checkOut').value = coH + ':' + coM;
      this._checkoutCrossesDay = checkOutDate.getDate() !== checkInDate.getDate();
    },
    
    calcBasePrice: function() {
      const duration = document.getElementById('duration').value;
      const priceType = document.getElementById('priceType').value;
      
      const prices = {
        '1J': { weekday: 50000, weekend: 60000 },
        '2J': { weekday: 80000, weekend: 100000 },
        '3J': { weekday: 100000, weekend: 120000 },
        '4J': { weekday: 120000, weekend: 140000 },
        '5J': { weekday: 140000, weekend: 160000 },
        '6J': { weekday: 160000, weekend: 180000 },
        '7J': { weekday: 180000, weekend: 200000 },
        '8J': { weekday: 200000, weekend: 220000 },
        'PM': { weekday: 250000, weekend: 300000 },
        'FD': { weekday: 350000, weekend: 400000 }
      };
      
      if (prices[duration]) {
        document.getElementById('basePrice').value = prices[duration][priceType];
        this.updateTotal();
      }
    },
    
    updateTotal: function() {
      const cash = parseFloat(document.getElementById('cashAmount').value) || 0;
      const transfer = parseFloat(document.getElementById('transferAmount').value) || 0;
      const qr = parseFloat(document.getElementById('qrAmount').value) || 0;
      const total = cash + transfer + qr;
      
      document.getElementById('totalPayment').textContent = this.formatRupiah(total);
    },
    
    updateDurationHint: function() {
      const duration = document.getElementById('duration').value;
      const hints = {
        '1J': 'Charge rate - untuk durasi singkat',
        '2J': 'Charge rate - untuk durasi singkat',
        'PM': 'Promo Malam - 12 jam (19:00-07:00)',
        'FD': 'Fullday - 24 jam'
      };
      document.getElementById('durationHint').textContent = hints[duration] || '';
    },
    
    handleRentalSubmit: function(e) {
      e.preventDefault();
      
      if (currentUser.role === 'crew') {
        this.showToast('Akun CREW tidak dapat melakukan input!', 'error');
        return false;
      }
      
      const unitType = document.getElementById('unitType').value;
      const unitNumber = document.getElementById('unitNumber').value;
      let marketing = document.getElementById('marketing').value;
      const otherMarketing = document.getElementById('otherMarketing').value;
      
      if (marketing === 'other' && otherMarketing) {
        marketing = otherMarketing;
      }
      
      const duration = document.getElementById('duration').value;
      const checkIn = document.getElementById('checkIn').value;
      const checkOut = document.getElementById('checkOut').value;
      const cash = parseFloat(document.getElementById('cashAmount').value) || 0;
      const transfer = parseFloat(document.getElementById('transferAmount').value) || 0;
      const qr = parseFloat(document.getElementById('qrAmount').value) || 0;
      const totalPayment = cash + transfer + qr;
      const marketingFee = parseFloat(document.getElementById('marketingFee').value) || 0;
      
      const rentalData = {
        id: Date.now().toString(),
        unitType,
        unit: unitNumber,
        marketing,
        duration,
        checkIn,
        checkOut,
        priceType: document.getElementById('priceType').value,
        basePrice: parseFloat(document.getElementById('basePrice').value) || 0,
        cash,
        transfer,
        qr,
        totalPayment,
        bankAccount: document.getElementById('bankAccount').value,
        marketingFee,
        paymentStatus: document.getElementById('paymentStatus').value,
        guestIdentity: document.getElementById('guestIdentity').value,
        notes: document.getElementById('rentalNotes').value,
        timestamp: firebase.database.ServerValue.TIMESTAMP,
        createdBy: currentUser.username
      };
      
      // Save rental
      db.ref(`saldozea/rentals/${rentalData.id}`).set(rentalData);
      
      // Update unit status
      const unitIndex = this.units.findIndex(u => u.number === unitNumber);
      if (unitIndex !== -1) {
        const today = new Date();
        const [checkOutH, checkOutM] = checkOut.split(':').map(Number);
        const checkOutDate = new Date(today);
        checkOutDate.setHours(checkOutH, checkOutM, 0, 0);
        if (this._checkoutCrossesDay) {
          checkOutDate.setDate(checkOutDate.getDate() + 1);
        }
        
        this.units[unitIndex].occupied = true;
        this.units[unitIndex].checkInTime = today.toISOString();
        this.units[unitIndex].checkOutTime = checkOutDate.toISOString();
        this.units[unitIndex].marketing = marketing;
        this.units[unitIndex].guestIdentity = rentalData.guestIdentity;
        
        this.saveUnits();
      }
      
      // Create transaction record
      const transactionData = {
        id: Date.now().toString() + '_tx',
        type: 'income',
        category: 'rental',
        source: `Sewa ${unitNumber}`,
        amount: totalPayment,
        method: cash > 0 ? 'Cash' : transfer > 0 ? 'Transfer' : 'QR',
        notes: `Marketing: ${marketing}`,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      };
      
      db.ref(`saldozea/transactions/${transactionData.id}`).set(transactionData);
      
      this.showToast('Data penyewaan berhasil disimpan!', 'success');
      this.resetRentalForm();
      this.switchTab('dashboard');
      
      return false;
    },
    
    handleIncomeSubmit: function(e) {
      e.preventDefault();
      
      if (currentUser.role === 'crew') {
        this.showToast('Akun CREW tidak dapat melakukan input!', 'error');
        return false;
      }
      
      const transactionData = {
        id: Date.now().toString(),
        type: 'income',
        source: document.getElementById('incomeSource').value,
        amount: parseFloat(document.getElementById('incomeAmount').value) || 0,
        method: document.getElementById('incomeMethod').value,
        notes: document.getElementById('incomeNotes').value,
        timestamp: firebase.database.ServerValue.TIMESTAMP,
        createdBy: currentUser.username
      };
      
      db.ref(`saldozea/transactions/${transactionData.id}`).set(transactionData);
      
      this.showToast('Pemasukan berhasil ditambahkan!', 'success');
      document.getElementById('incomeForm').reset();
      
      return false;
    },
    
    handleExpenseSubmit: function(e) {
      e.preventDefault();
      
      if (currentUser.role === 'crew') {
        this.showToast('Akun CREW tidak dapat melakukan input!', 'error');
        return false;
      }
      
      const transactionData = {
        id: Date.now().toString(),
        type: 'expense',
        category: document.getElementById('expenseCategory').value,
        recipient: document.getElementById('expenseRecipient').value,
        amount: parseFloat(document.getElementById('expenseAmount').value) || 0,
        method: document.getElementById('expenseMethod').value,
        notes: document.getElementById('expenseNotes').value,
        timestamp: firebase.database.ServerValue.TIMESTAMP,
        createdBy: currentUser.username
      };
      
      db.ref(`saldozea/transactions/${transactionData.id}`).set(transactionData);
      
      this.showToast('Pengeluaran berhasil ditambahkan!', 'success');
      document.getElementById('expenseForm').reset();
      
      return false;
    },
    
    renderRecentTransactions: function() {
      const tbody = document.getElementById('recentTransactions');
      const transactions = Object.values(this.data.transactions || {})
        .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0))
        .slice(0, 20);
      
      tbody.innerHTML = transactions.map(t => `
        <tr>
          <td>${t.timestamp ? new Date(t.timestamp).toLocaleString('id-ID') : '-'}</td>
          <td><span class="badge badge-${t.type === 'income' ? 'success' : 'danger'}">${t.type === 'income' ? 'Masuk' : 'Keluar'}</span></td>
          <td>${t.source || t.category || '-'}</td>
          <td>${t.method || '-'}</td>
          <td style="font-weight:600;color:${t.type === 'income' ? 'var(--accent-success)' : 'var(--accent-danger)'}">${this.formatRupiah(t.amount)}</td>
        </tr>
      `).join('') || '<tr><td colspan="5" class="table-empty">Belum ada transaksi</td></tr>';
    },
    
    handleAddUnit: function() {
      if (currentUser.role === 'crew') {
        this.showToast('Akun CREW tidak dapat menambah unit!', 'error');
        return;
      }
      
      const number = document.getElementById('newUnitNumber').value.trim().toUpperCase();
      const type = document.getElementById('newUnitType').value;
      
      if (!number || !type) {
        this.showToast('Nomor unit dan tipe wajib diisi!', 'error');
        return;
      }
      
      if (this.units.some(u => u.number === number)) {
        this.showToast('Unit sudah ada!', 'error');
        return;
      }
      
      this.units.push({
        number,
        type,
        occupied: false,
        checkInTime: null,
        checkOutTime: null,
        marketing: null,
        guestIdentity: null
      });
      
      this.saveUnits();
      
      document.getElementById('newUnitNumber').value = '';
      document.getElementById('newUnitType').value = '';
      this.showToast(`Unit ${number} berhasil ditambahkan!`, 'success');
    },
    
    handleRemoveUnit: function() {
      if (currentUser.role === 'crew') {
        this.showToast('Akun CREW tidak dapat menghapus unit!', 'error');
        return;
      }
      
      const number = document.getElementById('removeUnitNumber').value.trim().toUpperCase();
      const unitIndex = this.units.findIndex(u => u.number === number);
      
      if (unitIndex === -1) {
        this.showToast('Unit tidak ditemukan!', 'error');
        return;
      }
      
      if (this.units[unitIndex].occupied) {
        this.showToast('Unit sedang disewa, tidak dapat dihapus!', 'error');
        return;
      }
      
      if (!confirm(`Yakin ingin menghapus unit ${number}?`)) return;
      
      this.units.splice(unitIndex, 1);
      this.saveUnits();
      
      document.getElementById('removeUnitNumber').value = '';
      this.showToast(`Unit ${number} berhasil dihapus!`, 'success');
    },
    
    renderHistory: function() {
      const filterDate = document.getElementById('filterDate').value;
      const filterType = document.getElementById('filterType').value;
      const filterMarketing = document.getElementById('filterMarketing').value;
      
      let allData = [];
      
      // Add rentals
      Object.values(this.data.rentals || {}).forEach(r => {
        allData.push({ ...r, dataType: 'rental' });
      });
      
      // Add transactions
      Object.values(this.data.transactions || {}).forEach(t => {
        allData.push({ ...t, dataType: t.type });
      });
      
      // Filter
      if (filterDate) {
        allData = allData.filter(d => {
          const dDate = d.timestamp ? new Date(d.timestamp).toISOString().split('T')[0] : '';
          return dDate === filterDate;
        });
      }
      
      if (filterType) {
        allData = allData.filter(d => d.dataType === filterType);
      }
      
      if (filterMarketing) {
        allData = allData.filter(d => d.marketing === filterMarketing);
      }
      
      // Sort by timestamp
      allData.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
      
      // Calculate totals
      let totalIn = 0, totalOut = 0;
      allData.forEach(d => {
        if (d.dataType === 'rental' || d.dataType === 'income') {
          totalIn += parseFloat(d.totalPayment || d.amount) || 0;
        } else if (d.dataType === 'expense') {
          totalOut += parseFloat(d.amount) || 0;
        }
      });
      
      document.getElementById('historyTotalIn').textContent = this.formatRupiah(totalIn);
      document.getElementById('historyTotalOut').textContent = this.formatRupiah(totalOut);
      document.getElementById('historyNet').textContent = this.formatRupiah(totalIn - totalOut);
      document.getElementById('historyCount').textContent = allData.length;
      
      // Render table
      const tbody = document.getElementById('historyTable');
      tbody.innerHTML = allData.map((d, i) => {
        const isIncome = d.dataType === 'rental' || d.dataType === 'income';
        const amount = d.totalPayment || d.amount || 0;
        
        return `
          <tr>
            <td>${i + 1}</td>
            <td>${d.timestamp ? new Date(d.timestamp).toLocaleString('id-ID') : '-'}</td>
            <td><span class="badge badge-${isIncome ? 'success' : 'danger'}">${d.dataType === 'rental' ? 'Sewa' : d.dataType === 'income' ? 'Masuk' : 'Keluar'}</span></td>
            <td>${d.unit || d.source || d.category || '-'}</td>
            <td>${d.marketing || '-'}</td>
            <td>${d.duration ? this.formatDuration(d.duration) : '-'}</td>
            <td style="font-weight:600;color:${isIncome ? 'var(--accent-success)' : 'var(--accent-danger)'}">${this.formatRupiah(amount)}</td>
            <td>${d.method || '-'}</td>
            <td>${d.notes || '-'}</td>
            <td>
              ${currentUser.role !== 'crew' ? `
                <button class="btn btn-danger btn-sm" onclick="SaldoApp.deleteHistory('${d.id}', '${d.dataType}')">Hapus</button>
              ` : '-'}
            </td>
          </tr>
        `;
      }).join('') || '<tr><td colspan="10" class="table-empty">Tidak ada data</td></tr>';
    },
    
    deleteHistory: function(id, type) {
      if (currentUser.role === 'crew') {
        this.showToast('Akun CREW tidak dapat menghapus data!', 'error');
        return;
      }
      
      if (!confirm('Yakin ingin menghapus data ini?')) return;
      
      if (type === 'rental') {
        db.ref(`saldozea/rentals/${id}`).remove();
      } else {
        db.ref(`saldozea/transactions/${id}`).remove();
      }
      
      this.showToast('Data berhasil dihapus!', 'success');
    },
    
    applyFilters: function() {
      this.renderHistory();
    },
    
    clearFilters: function() {
      document.getElementById('filterDate').value = '';
      document.getElementById('filterType').value = '';
      document.getElementById('filterMarketing').value = '';
      this.renderHistory();
    },
    
    generateReport: function() {
      const startDate = document.getElementById('reportStart').value;
      const endDate = document.getElementById('reportEnd').value;
      
      if (!startDate || !endDate) {
        this.showToast('Pilih rentang tanggal!', 'error');
        return;
      }
      
      let allData = [];
      
      Object.values(this.data.rentals || {}).forEach(r => {
        allData.push({ ...r, dataType: 'rental' });
      });
      
      Object.values(this.data.transactions || {}).forEach(t => {
        allData.push({ ...t, dataType: t.type });
      });
      
      const filtered = allData.filter(d => {
        if (!d.timestamp) return false;
        const dDate = new Date(d.timestamp).toISOString().split('T')[0];
        return dDate >= startDate && dDate <= endDate;
      });
      
      let totalIncome = 0, totalExpense = 0, totalGuests = 0;
      let marketingStats = {}, unitStats = {}, durationStats = {};
      let paymentMethods = { Cash: 0, Transfer: 0, QR: 0 };
      
      filtered.forEach(d => {
        if (d.dataType === 'rental' || d.dataType === 'income') {
          totalIncome += parseFloat(d.totalPayment || d.amount) || 0;
          if (d.dataType === 'rental') {
            totalGuests++;
            if (d.marketing) marketingStats[d.marketing] = (marketingStats[d.marketing] || 0) + 1;
            if (d.unit) unitStats[d.unit] = (unitStats[d.unit] || 0) + 1;
            if (d.duration) durationStats[d.duration] = (durationStats[d.duration] || 0) + 1;
            if (d.cash) paymentMethods.Cash += d.cash;
            if (d.transfer) paymentMethods.Transfer += d.transfer;
            if (d.qr) paymentMethods.QR += d.qr;
          }
        } else if (d.dataType === 'expense') {
          totalExpense += parseFloat(d.amount) || 0;
        }
      });
      
      document.getElementById('reportIncome').textContent = this.formatRupiah(totalIncome);
      document.getElementById('reportExpense').textContent = this.formatRupiah(totalExpense);
      document.getElementById('reportNet').textContent = this.formatRupiah(totalIncome - totalExpense);
      document.getElementById('reportGuests').textContent = totalGuests;
      
      // Top marketing
      const topMarketing = Object.entries(marketingStats).sort((a, b) => b[1] - a[1]).slice(0, 5);
      document.getElementById('reportTopMarketing').innerHTML = topMarketing.map((m, i) => `
        <div class="top-list-item"><span class="rank">${i + 1}.</span><span class="name">${m[0]}</span><span class="value">${m[1]} tamu</span></div>
      `).join('') || '<div class="empty-state">Belum ada data</div>';
      
      // Top units
      const topUnits = Object.entries(unitStats).sort((a, b) => b[1] - a[1]).slice(0, 5);
      document.getElementById('reportTopUnits').innerHTML = topUnits.map((u, i) => `
        <div class="top-list-item"><span class="rank">${i + 1}.</span><span class="name">${u[0]}</span><span class="value">${u[1]}x</span></div>
      `).join('') || '<div class="empty-state">Belum ada data</div>';
      
      // Top durations
      const topDurations = Object.entries(durationStats).sort((a, b) => b[1] - a[1]).slice(0, 5);
      document.getElementById('reportTopDuration').innerHTML = topDurations.map((d, i) => `
        <div class="top-list-item"><span class="rank">${i + 1}.</span><span class="name">${this.formatDuration(d[0])}</span><span class="value">${d[1]}x</span></div>
      `).join('') || '<div class="empty-state">Belum ada data</div>';
      
      // Payment breakdown
      document.getElementById('reportPaymentBreakdown').innerHTML = `
        <div class="payment-split-item cash"><div class="icon"></div><div class="amount">${this.formatRupiah(paymentMethods.Cash)}</div><div class="label">Cash</div></div>
        <div class="payment-split-item transfer"><div class="icon"></div><div class="amount">${this.formatRupiah(paymentMethods.Transfer)}</div><div class="label">Transfer</div></div>
        <div class="payment-split-item qr"><div class="icon"></div><div class="amount">${this.formatRupiah(paymentMethods.QR)}</div><div class="label">QRIS</div></div>
      `;
      
      document.getElementById('reportResults').style.display = 'block';
    },
    
    resetRentalForm: function() {
      document.getElementById('rentalForm').reset();
      document.getElementById('unitNumber').innerHTML = '<option value="">Pilih Unit</option>';
      document.getElementById('checkOut').value = '';
      document.getElementById('totalPayment').textContent = 'Rp 0';
    },
    
    formatRupiah: function(amount) {
      return 'Rp ' + (amount || 0).toLocaleString('id-ID');
    },
    
    formatDuration: function(duration) {
      const map = {
        '1J': '1 Jam', '2J': '2 Jam', '3J': '3 Jam', '4J': '4 Jam',
        '5J': '5 Jam', '6J': '6 Jam', '7J': '7 Jam', '8J': '8 Jam',
        'PM': 'Promo Malam', 'FD': 'Fullday'
      };
      return map[duration] || duration;
    },
    
    showToast: function(message, type = 'info') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = 'toast ' + type;
      toast.textContent = message;
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'toastSlideIn 0.4s cubic-bezier(0.4,0,0.2,1) reverse';
        setTimeout(() => toast.remove(), 400);
      }, 4000);
    },
    
    // LED Functions
    selectLedColor: function(color, btn) {
      this.selectedLedColor = color;
      document.querySelectorAll('.led-color-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      document.getElementById('ledPreviewBox').className = 'led-preview ' + color;
      document.getElementById('ledBar').className = 'led-bar ' + color;
    },
    
    setLedSpeed: function(speed) {
      const speeds = { slow: 45, normal: 28, fast: 15 };
      this.ledSpeed = speeds[speed] || 28;
      this.updateLedSpeed();
    },
    
    updateLedSpeed: function() {
      const inner = document.getElementById('ledBarInner');
      inner.style.animationDuration = this.ledSpeed + 's';
      document.getElementById('ledPreviewText').style.animationDuration = (this.ledSpeed / 2.8) + 's';
    },
    
    previewLedMessage: function() {
      const text = document.getElementById('ledMessageInput').value;
      document.getElementById('ledPreviewText').textContent = text || 'Preview pesan...';
    },
    
    saveLedMessage: function() {
      const text = document.getElementById('ledMessageInput').value;
      if (!text.trim()) {
        this.showToast('Pesan tidak boleh kosong!', 'error');
        return;
      }
      
      db.ref('saldozea/ledMessage').set({
        text: text,
        color: this.selectedLedColor,
        speed: this.ledSpeed,
        updatedBy: currentUser.username,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
      
      this.showToast('Pesan LED berhasil dipublish!', 'success');
    },
    
    resetLedDefault: function() {
      const defaultMsg = ' Selamat datang di ZeaUnified  SaldoZea & ZeaCrew Management System  Pastikan setiap transaksi dicatat dengan benar  Terima kasih atas kerja keras kalian semua ';
      document.getElementById('ledMessageInput').value = defaultMsg;
      this.previewLedMessage();
      this.selectLedColor('led-green', document.querySelector('[data-color="led-green"]'));
      this.setLedSpeed('normal');
    },
    
    toggleLedPause: function() {
      document.getElementById('ledBar').classList.toggle('paused');
    },
    
    // Bug Report
    openBugModal: function() {
      document.getElementById('bugModalOverlay').style.display = 'flex';
      document.getElementById('bugTabName').textContent = this.currentTab.toUpperCase();
    },
    
    closeBugModal: function() {
      document.getElementById('bugModalOverlay').style.display = 'none';
    },
    
    sendBugReport: function() {
      const notes = document.getElementById('bugNotes').value;
      const tab = this.currentTab;
      const message = ` BUG REPORT ZeaUnified\n\nTab: ${tab}\nUser: ${currentUser.username}\nRole: ${currentUser.role}\n\nCatatan: ${notes || 'Tidak ada catatan'}\n\nWaktu: ${new Date().toLocaleString('id-ID')}`;
      
      const waUrl = `https://wa.me/6289512443677?text=${encodeURIComponent(message)}`;
      window.open(waUrl, '_blank');
      this.closeBugModal();
    },
    
    exportDailyReport: function() {
      const todayStr = new Date().toISOString().split('T')[0];
      let allData = [];
      Object.values(this.data.rentals || {}).forEach(r => allData.push({...r, dataType:'rental'}));
      Object.values(this.data.transactions || {}).forEach(t => allData.push({...t, dataType:t.type}));
      allData = allData.filter(d => {
        const dDate = d.timestamp ? new Date(d.timestamp).toISOString().split('T')[0] : '';
        return dDate === todayStr;
      });
      allData.sort((a,b) => (b.timestamp||0)-(a.timestamp||0));
      const headers = ['Waktu','Jenis','Unit/Sumber','Marketing','Durasi','Total','Metode','Keterangan'];
      const rows = allData.map(d => [
        d.timestamp ? new Date(d.timestamp).toLocaleString('id-ID') : '-',
        d.dataType === 'rental' ? 'Sewa' : d.dataType === 'income' ? 'Pemasukan' : 'Pengeluaran',
        d.unit || d.source || d.category || '-',
        d.marketing || '-',
        d.duration ? this.formatDuration(d.duration) : '-',
        d.totalPayment || d.amount || 0,
        d.method || '-',
        d.notes || '-'
      ]);
      const csvContent = [headers, ...rows].map(row => row.map(cell => '"' + String(cell).replace(/"/g,'""') + '"').join(',')).join('\n');
      const blob = new Blob(['\uFEFF' + csvContent], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'saldozea_harian_' + todayStr + '.csv';
      a.click();
      URL.revokeObjectURL(url);
      this.showToast('Export harian berhasil!', 'success');
    },
    
    exportCSV: function() {
      const filterDate = document.getElementById('filterDate').value;
      let allData = [];
      Object.values(this.data.rentals || {}).forEach(r => allData.push({...r, dataType:'rental'}));
      Object.values(this.data.transactions || {}).forEach(t => allData.push({...t, dataType:t.type}));
      if (filterDate) {
        allData = allData.filter(d => {
          const dDate = d.timestamp ? new Date(d.timestamp).toISOString().split('T')[0] : '';
          return dDate === filterDate;
        });
      }
      allData.sort((a,b) => (b.timestamp||0)-(a.timestamp||0));
      const headers = ['Waktu','Jenis','Unit/Sumber','Marketing','Durasi','Total','Metode','Keterangan'];
      const rows = allData.map(d => [
        d.timestamp ? new Date(d.timestamp).toLocaleString('id-ID') : '-',
        d.dataType === 'rental' ? 'Sewa' : d.dataType === 'income' ? 'Pemasukan' : 'Pengeluaran',
        d.unit || d.source || d.category || '-',
        d.marketing || '-',
        d.duration ? this.formatDuration(d.duration) : '-',
        d.totalPayment || d.amount || 0,
        d.method || '-',
        d.notes || '-'
      ]);
      const csvContent = [headers, ...rows].map(row => row.map(cell => '"' + String(cell).replace(/"/g,'""') + '"').join(',')).join('\n');
      const blob = new Blob(['\uFEFF' + csvContent], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'saldozea_' + (filterDate || 'semua') + '.csv';
      a.click();
      URL.revokeObjectURL(url);
      this.showToast('Export CSV berhasil!', 'success');
    },
    
    exportReport: function() {
      const startDate = document.getElementById('reportStart') ? document.getElementById('reportStart').value : '';
      const endDate = document.getElementById('reportEnd') ? document.getElementById('reportEnd').value : '';
      let allData = [];
      Object.values(this.data.rentals || {}).forEach(r => allData.push({...r, dataType:'rental'}));
      Object.values(this.data.transactions || {}).forEach(t => allData.push({...t, dataType:t.type}));
      if (startDate || endDate) {
        allData = allData.filter(d => {
          const dDate = d.timestamp ? new Date(d.timestamp).toISOString().split('T')[0] : '';
          if (startDate && dDate < startDate) return false;
          if (endDate && dDate > endDate) return false;
          return true;
        });
      }
      allData.sort((a,b) => (b.timestamp||0)-(a.timestamp||0));
      const headers = ['Waktu','Jenis','Unit/Sumber','Marketing','Durasi','Total','Metode','Keterangan'];
      const rows = allData.map(d => [
        d.timestamp ? new Date(d.timestamp).toLocaleString('id-ID') : '-',
        d.dataType === 'rental' ? 'Sewa' : d.dataType === 'income' ? 'Pemasukan' : 'Pengeluaran',
        d.unit || d.source || d.category || '-',
        d.marketing || '-',
        d.duration ? this.formatDuration(d.duration) : '-',
        d.totalPayment || d.amount || 0,
        d.method || '-',
        d.notes || '-'
      ]);
      const csvContent = [headers, ...rows].map(row => row.map(cell => '"' + String(cell).replace(/"/g,'""') + '"').join(',')).join('\n');
      const blob = new Blob(['\uFEFF' + csvContent], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'saldozea_report_' + (startDate || 'awal') + '_sd_' + (endDate || 'akhir') + '.csv';
      a.click();
      URL.revokeObjectURL(url);
      this.showToast('Export report berhasil!', 'success');
    }
  };



  /* ============================================================
     ZEACREW APP NAMESPACE
     ============================================================ */
  const ZeaApp = {
    data: { staff: {}, unit: {}, token: {}, pengajuan: {}, report: {}, absensi: {}, gaji: {}, akun: {}, feed: {} },
    currentPage: 'dashboard',
    currentPostType: 'info',
    currentFilter: 'semua',
    editingTokenId: null,
    intervals: [],
    
    init: function() {
      this.setupClock();
      this.setupFirebaseListeners();
      this.setupOnlinePresence();
      this.applyRolePermissions();
      this.switchPage('dashboard');
      
      // Set default dates
      const today = new Date();
      document.getElementById('tokenDate').value = today.toISOString().split('T')[0];
      document.getElementById('absensiDate').value = today.toISOString().split('T')[0];
      document.getElementById('gajiBulan').value = today.getMonth().toString();
      document.getElementById('uTempo').value = today.toISOString().split('T')[0];
    },
    
    setupClock: function() {
      const updateClock = () => {
        const now = new Date();
        const dateStr = now.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
        const timeStr = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
        document.getElementById('zeaHeaderDate').textContent = dateStr;
        document.getElementById('zeaHeaderClock').textContent = timeStr;
      };
      updateClock();
      this.intervals.push(setInterval(updateClock, 1000));
    },
    
    setupFirebaseListeners: function() {
      // Staff listener
      db.ref('zeacrew/staff').on('value', (snapshot) => {
        this.data.staff = snapshot.val() || {};
        this.renderStaff();
        this.updateDashboardStats();
        this.populateStaffSelects();
      });
      
      // Unit listener
      db.ref('zeacrew/unit').on('value', (snapshot) => {
        this.data.unit = snapshot.val() || {};
        this.renderUnit();
        this.updateDashboardStats();
        this.populateUnitSelects();
      });
      
      // Token listener
      db.ref('zeacrew/token').on('value', (snapshot) => {
        this.data.token = snapshot.val() || {};
        this.renderToken();
        this.renderTokenAnalysis();
      });
      
      // Pengajuan listener
      db.ref('zeacrew/pengajuan').on('value', (snapshot) => {
        this.data.pengajuan = snapshot.val() || {};
        this.renderPengajuan();
      });
      
      // Report listener
      db.ref('zeacrew/report').on('value', (snapshot) => {
        this.data.report = snapshot.val() || {};
        this.renderReport();
      });
      
      // Absensi listener
      db.ref('zeacrew/absensi').on('value', (snapshot) => {
        this.data.absensi = snapshot.val() || {};
        this.renderAbsensi();
      });
      
      // Akun listener
      db.ref('zeacrew/akun').on('value', (snapshot) => {
        this.data.akun = snapshot.val() || {};
        this.renderAkun();
        this.populateAkunSelects();
      });
      
      // Feed listener
      db.ref('zeacrew/feed').on('value', (snapshot) => {
        this.data.feed = snapshot.val() || {};
        this.renderFeed();
      });
      
      // Connection status
      db.ref('.info/connected').on('value', (snapshot) => {
        const status = document.getElementById('zeaConnectionStatus');
        const text = document.getElementById('zeaSyncText');
        if (snapshot.val()) {
          status.className = 'connection-status online';
          text.textContent = ' Online';
        } else {
          status.className = 'connection-status offline';
          text.textContent = ' Offline';
        }
      });
    },
    
    setupOnlinePresence: function() {
      if (!currentUser) return;
      
      const userRef = db.ref(`zeacrew/onlineUsers/${currentUser.username}`);
      const connectedRef = db.ref('.info/connected');
      
      connectedRef.on('value', (snap) => {
        if (snap.val()) {
          userRef.set({
            role: currentUser.role,
            name: currentUser.name || currentUser.username,
            timestamp: firebase.database.ServerValue.TIMESTAMP
          });
          userRef.onDisconnect().remove();
        }
      });
    },
    
    applyRolePermissions: function() {
      const role = currentUser.role;
      
      // Hide nav items based on role
      document.querySelectorAll('.zea-nav-item[data-roles]').forEach(item => {
        const roles = item.dataset.roles.split(',');
        if (!roles.includes(role)) {
          item.style.display = 'none';
        }
      });
      
      // Hide buttons based on role
      if (role === 'staff' || role === 'marketing') {
        document.getElementById('addStaffBtn').style.display = 'none';
        document.getElementById('addPengajuanBtn').style.display = 'none';
        document.getElementById('addAkunBtn').style.display = 'none';
        document.getElementById('unitFormCard').style.display = 'none';
      }
      
      // Show edit gaji button for owner only
      if (role === 'owner') {
        document.getElementById('editGajiBtn').style.display = 'inline-block';
      }
    },
    
    toggleSidebar: function() {
      document.getElementById('zeaSidebar').classList.toggle('open');
      document.getElementById('zeaSidebarOverlay').classList.toggle('open');
    },
    
    switchPage: function(page) {
      this.currentPage = page;
      
      // Update nav items
      document.querySelectorAll('.zea-nav-item').forEach(item => {
        item.classList.toggle('active', item.dataset.page === page);
      });
      
      // Update page content
      document.querySelectorAll('.zea-page').forEach(p => p.classList.remove('active'));
      document.getElementById('zea-page-' + page).classList.add('active');
      
      // Close sidebar on mobile
      document.getElementById('zeaSidebar').classList.remove('open');
      document.getElementById('zeaSidebarOverlay').classList.remove('open');
      
      // Page-specific actions
      if (page === 'dashboard') {
        this.updateDashboardStats();
        this.renderFeed();
      }
      if (page === 'staff') this.renderStaff();
      if (page === 'unit') this.renderUnit();
      if (page === 'token') this.renderToken();
      if (page === 'pengajuan') this.renderPengajuan();
      if (page === 'report') this.renderReport();
      if (page === 'absensi') this.renderAbsensi();
      if (page === 'gaji') this.populateStaffSelects();
      if (page === 'akun') this.renderAkun();
    },
    
    updateDashboardStats: function() {
      const staffCount = Object.keys(this.data.staff).length;
      const unitCount = Object.keys(this.data.unit).length;
      let maintCount = 0, readyCount = 0;
      
      Object.values(this.data.unit).forEach(u => {
        if (u.status === 'maintenance') maintCount++;
        else if (u.status === 'ready') readyCount++;
      });
      
      document.getElementById('statStaff').textContent = staffCount;
      document.getElementById('statUnit').textContent = unitCount;
      document.getElementById('statMaint').textContent = maintCount;
      document.getElementById('statReady').textContent = readyCount;
      
      document.getElementById('zeaWelcomeText').textContent = `Selamat datang, ${currentUser.name || currentUser.username} (${currentUser.role.toUpperCase()})`;
    },
    
    // ===== FEED FUNCTIONS =====
    selectPostType: function(type) {
      this.currentPostType = type;
      document.querySelectorAll('.zea-feed-type-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.type === type);
      });
    },
    
    postFeed: function() {
      const content = document.getElementById('feedInput').value.trim();
      if (!content) {
        alert('Tulis sesuatu terlebih dahulu!');
        return;
      }
      
      const postData = {
        id: Date.now().toString(),
        content,
        type: this.currentPostType,
        author: currentUser.name || currentUser.username,
        authorRole: currentUser.role,
        timestamp: firebase.database.ServerValue.TIMESTAMP,
        likes: 0,
        likedBy: {}
      };
      
      db.ref(`zeacrew/feed/${postData.id}`).set(postData);
      document.getElementById('feedInput').value = '';
    },
    
    renderFeed: function() {
      const container = document.getElementById('feedContainer');
      const posts = Object.values(this.data.feed).sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
      
      container.innerHTML = posts.map(post => {
        const isOwner = post.authorRole === 'owner';
        const date = post.timestamp ? new Date(post.timestamp).toLocaleString('id-ID') : '-';
        const typeClass = post.type || 'info';
        const typeLabels = { pengumuman: ' Pengumuman', info: ' Info', keluhan: ' Keluhan', lainnya: ' Lainnya' };
        
        return `
          <div class="zea-post-card ${isOwner ? 'owner-post' : ''}">
            <div class="zea-post-header">
              <div class="zea-post-avatar">${post.author ? post.author.charAt(0).toUpperCase() : '?'}</div>
              <div class="zea-post-meta">
                <div class="zea-post-author">
                  ${post.author}
                  ${isOwner ? '<span class="zea-verified-badge">OWNER</span>' : ''}
                </div>
                <div class="zea-post-time">${date}</div>
              </div>
              <span class="zea-post-type ${typeClass}">${typeLabels[typeClass] || typeClass}</span>
            </div>
            <div class="zea-post-content">${this.escapeHtml(post.content)}</div>
            <div class="zea-post-actions">
              <button class="zea-post-action-btn ${post.likedBy && post.likedBy[currentUser.username] ? 'liked' : ''}" onclick="ZeaApp.likePost('${post.id}')">
                 ${post.likes || 0}
              </button>
              ${post.author === (currentUser.name || currentUser.username) || currentUser.role === 'owner' ? `
                <button class="zea-post-action-btn" onclick="ZeaApp.deletePost('${post.id}')"> Hapus</button>
              ` : ''}
            </div>
          </div>
        `;
      }).join('') || '<div class="empty-state"><div class="empty-state-text">Belum ada postingan</div></div>';
    },
    
    likePost: function(postId) {
      const post = this.data.feed[postId];
      if (!post) return;
      
      const likedBy = post.likedBy || {};
      const username = currentUser.username;
      
      if (likedBy[username]) {
        likedBy[username] = null;
        db.ref(`zeacrew/feed/${postId}/likes`).set((post.likes || 1) - 1);
      } else {
        likedBy[username] = true;
        db.ref(`zeacrew/feed/${postId}/likes`).set((post.likes || 0) + 1);
      }
      
      db.ref(`zeacrew/feed/${postId}/likedBy`).set(likedBy);
    },
    
    deletePost: function(postId) {
      if (!confirm('Hapus postingan ini?')) return;
      db.ref(`zeacrew/feed/${postId}`).remove();
    },
    
    // ===== STAFF FUNCTIONS =====
    renderStaff: function() {
      const tbody = document.getElementById('staffTable');
      const staff = Object.entries(this.data.staff);
      
      tbody.innerHTML = staff.map(([id, s]) => `
        <tr>
          <td>
            <div class="zea-staff-info">
              <div class="zea-staff-avatar">${s.nama ? s.nama.charAt(0).toUpperCase() : '?'}</div>
              <div>
                <div class="zea-staff-name">${s.nama || '-'}</div>
                <div class="zea-staff-wa">${s.wa || '-'}</div>
              </div>
            </div>
          </td>
          <td><span class="badge badge-primary">${s.akun ? this.data.akun[s.akun]?.role || 'staff' : 'staff'}</span></td>
          <td>${s.cabang || '-'}</td>
          <td>${this.formatRupiah(s.gaji)}</td>
          <td>${this.formatRupiah(s.makan)}</td>
          <td>${s.jamMasuk || '08:00'} - ${s.jamPulang || '17:00'}</td>
          <td>${s.libur || '-'}</td>
          <td>
            <div class="zea-action-btns">
              ${currentUser.role !== 'staff' && currentUser.role !== 'marketing' ? `
                <button class="btn btn-primary btn-sm" onclick="ZeaApp.editStaff('${id}')">Edit</button>
                <button class="btn btn-danger btn-sm" onclick="ZeaApp.deleteStaff('${id}')">Hapus</button>
              ` : '-'}
            </div>
          </td>
        </tr>
      `).join('') || '<tr><td colspan="8" class="table-empty">Belum ada data staff</td></tr>';
    },
    
    showStaffModal: function() {
      document.getElementById('staffModalTitle').textContent = ' Tambah Staff';
      document.getElementById('staffEditId').value = '';
      document.getElementById('sNama').value = '';
      document.getElementById('sWA').value = '';
      document.getElementById('sGaji').value = '3000000';
      document.getElementById('sMakan').value = '20000';
      document.getElementById('sJamMasuk').value = '08:00';
      document.getElementById('sJamPulang').value = '17:00';
      this.showModal('staffModal');
    },
    
    editStaff: function(id) {
      const s = this.data.staff[id];
      if (!s) return;
      
      document.getElementById('staffModalTitle').textContent = ' Edit Staff';
      document.getElementById('staffEditId').value = id;
      document.getElementById('sAkun').value = s.akun || '';
      document.getElementById('sNama').value = s.nama || '';
      document.getElementById('sWA').value = s.wa || '';
      document.getElementById('sCabang').value = s.cabang || 'Gateway Pasteur';
      document.getElementById('sGaji').value = s.gaji || 3000000;
      document.getElementById('sMakan').value = s.makan || 20000;
      document.getElementById('sJamMasuk').value = s.jamMasuk || '08:00';
      document.getElementById('sJamPulang').value = s.jamPulang || '17:00';
      document.getElementById('sLibur').value = s.libur || '';
      this.showModal('staffModal');
    },
    
    saveStaff: function() {
      const id = document.getElementById('staffEditId').value || Date.now().toString();
      const staffData = {
        akun: document.getElementById('sAkun').value,
        nama: document.getElementById('sNama').value,
        wa: document.getElementById('sWA').value,
        cabang: document.getElementById('sCabang').value,
        gaji: parseInt(document.getElementById('sGaji').value) || 3000000,
        makan: parseInt(document.getElementById('sMakan').value) || 20000,
        jamMasuk: document.getElementById('sJamMasuk').value,
        jamPulang: document.getElementById('sJamPulang').value,
        libur: document.getElementById('sLibur').value
      };
      
      db.ref(`zeacrew/staff/${id}`).set(staffData);
      this.hideModal('staffModal');
    },
    
    deleteStaff: function(id) {
      if (!confirm('Hapus staff ini?')) return;
      db.ref(`zeacrew/staff/${id}`).remove();
    },
    
    // ===== UNIT FUNCTIONS =====
    renderUnit: function() {
      const units = Object.entries(this.data.unit);
      let readyCount = 0, maintCount = 0;
      const grouped = { Studio: [], '1BR': [], '2BR': [] };
      
      units.forEach(([id, u]) => {
        if (u.status === 'ready') readyCount++;
        else if (u.status === 'maintenance') maintCount++;
        
        if (grouped[u.tipe]) {
          grouped[u.tipe].push({ id, ...u });
        }
      });
      
      document.getElementById('unitReady').textContent = readyCount;
      document.getElementById('unitMaint').textContent = maintCount;
      
      // Render grids
      const gridMap = { 'Studio': 'unitGridStudio', '1BR': 'unitGrid1BR', '2BR': 'unitGrid2BR' };
      const countMap = { 'Studio': 'countStudio', '1BR': 'count1BR', '2BR': 'count2BR' };
      ['Studio', '1BR', '2BR'].forEach(type => {
        const gridEl = document.getElementById(gridMap[type]);
        const countEl = document.getElementById(countMap[type]);
        const typeUnits = grouped[type] || [];
        if (countEl) countEl.textContent = typeUnits.length;
        if (gridEl) {
          gridEl.innerHTML = typeUnits.map(u => `
            <div class="zea-unit-card ${u.status}" onclick="ZeaApp.showUnitDetail('${u.id}')">
              <div class="zea-unit-name">${u.nomor}</div>
              <div class="zea-unit-type">${u.status === 'ready' ? '' : ''} ${u.status}</div>
              ${u.tempo && ZeaApp.isNearDue(u.tempo) ? '<div class="zea-unit-warning"></div>' : ''}
            </div>
          `).join('') || '<div style="color:var(--text-muted);font-size:0.8rem;padding:8px;">Tidak ada unit</div>';
        }
      });
    },
    
    isNearDue: function(tempoDate) {
      const tempo = new Date(tempoDate);
      const now = new Date();
      const diffDays = Math.ceil((tempo - now) / (1000 * 60 * 60 * 24));
      return diffDays <= 7 && diffDays >= 0;
    },
    
    showUnitDetail: function(id) {
      const u = this.data.unit[id];
      if (!u) return;
      
      const content = document.getElementById('unitDetailContent');
      content.innerHTML = `
        <div class="form-grid">
          <div class="form-group"><label>Nomor Unit</label><input type="text" class="form-input" value="${u.nomor}" readonly></div>
          <div class="form-group"><label>Tipe</label><input type="text" class="form-input" value="${u.tipe}" readonly></div>
          <div class="form-group"><label>Status</label><input type="text" class="form-input" value="${u.status === 'ready' ? ' READY' : ' MAINTENANCE'}" readonly></div>
          <div class="form-group"><label>WiFi</label><input type="text" class="form-input" value="${u.wifi === 'ada' ? ' WiFi' : ' Non WiFi'}" readonly></div>
          <div class="form-group"><label>Owner</label><input type="text" class="form-input" value="${u.owner || '-'}" readonly></div>
          <div class="form-group"><label>Perpanjangan</label><input type="text" class="form-input" value="${this.formatRupiah(u.nominal)}" readonly></div>
          <div class="form-group"><label>Jatuh Tempo</label><input type="text" class="form-input" value="${u.tempo || '-'}" readonly></div>
        </div>
        <div style="margin-top:1rem;display:flex;gap:0.5rem;">
          ${currentUser.role !== 'staff' && currentUser.role !== 'marketing' ? `
            <button class="btn btn-primary" onclick="ZeaApp.editUnit('${id}')">Edit</button>
            <button class="btn btn-danger" onclick="ZeaApp.deleteUnit('${id}')">Hapus</button>
          ` : ''}
        </div>
      `;
      
      this.showModal('unitDetailModal');
    },
    
    editUnit: function(id) {
      this.hideModal('unitDetailModal');
      const u = this.data.unit[id];
      if (!u) return;
      
      document.getElementById('unitEditId').value = id;
      document.getElementById('uNomor').value = u.nomor;
      document.getElementById('uStatus').value = u.status;
      document.getElementById('uTipe').value = u.tipe;
      document.getElementById('uOwner').value = u.owner || '';
      document.getElementById('uWifi').value = u.wifi || 'ada';
      document.getElementById('uNominal').value = u.nominal || 2500000;
      document.getElementById('uTempo').value = u.tempo || '';
      document.getElementById('unitFormTitle').textContent = ' Edit Unit';
    },
    
    saveUnit: function() {
      const id = document.getElementById('unitEditId').value || Date.now().toString();
      const unitData = {
        nomor: document.getElementById('uNomor').value.toUpperCase(),
        status: document.getElementById('uStatus').value,
        tipe: document.getElementById('uTipe').value,
        owner: document.getElementById('uOwner').value,
        wifi: document.getElementById('uWifi').value,
        nominal: parseInt(document.getElementById('uNominal').value) || 2500000,
        tempo: document.getElementById('uTempo').value
      };
      
      db.ref(`zeacrew/unit/${id}`).set(unitData);
      this.resetUnitForm();
    },
    
    deleteUnit: function(id) {
      if (!confirm('Hapus unit ini?')) return;
      this.hideModal('unitDetailModal');
      db.ref(`zeacrew/unit/${id}`).remove();
    },
    
    resetUnitForm: function() {
      document.getElementById('unitEditId').value = '';
      document.getElementById('uNomor').value = '';
      document.getElementById('uStatus').value = 'ready';
      document.getElementById('uTipe').value = 'Studio';
      document.getElementById('uOwner').value = '';
      document.getElementById('uWifi').value = 'ada';
      document.getElementById('uNominal').value = '2500000';
      document.getElementById('unitFormTitle').textContent = 'Tambah/Update Unit';
    },
    
    // ===== TOKEN FUNCTIONS =====
    renderToken: function() {
      const filterUnit = document.getElementById('filterTokenUnit').value;
      let tokens = Object.entries(this.data.token);
      
      if (filterUnit) {
        tokens = tokens.filter(([id, t]) => t.unit === filterUnit);
      }
      
      tokens.sort((a, b) => (b[1].timestamp || 0) - (a[1].timestamp || 0));
      
      const tbody = document.getElementById('tokenTable');
      tbody.innerHTML = tokens.map(([id, t]) => `
        <tr>
          <td>${t.tanggal || '-'}</td>
          <td>${t.unit || '-'}</td>
          <td>${this.formatRupiah(t.nominal)}</td>
          <td>${t.meteran || '-'}</td>
          <td>${t.keterangan || '-'}</td>
          <td>${t.inputBy || '-'}</td>
          <td>
            ${currentUser.role !== 'staff' && currentUser.role !== 'marketing' ? `
              <button class="btn btn-primary btn-sm" onclick="ZeaApp.editToken('${id}')">Edit</button>
              <button class="btn btn-danger btn-sm" onclick="ZeaApp.deleteToken('${id}')">Hapus</button>
            ` : '-'}
          </td>
        </tr>
      `).join('') || '<tr><td colspan="7" class="table-empty">Belum ada data</td></tr>';
    },
    
    renderTokenAnalysis: function() {
      const tokens = Object.values(this.data.token);
      const unitTotals = {};
      
      tokens.forEach(t => {
        if (!unitTotals[t.unit]) unitTotals[t.unit] = 0;
        unitTotals[t.unit] += parseInt(t.nominal) || 0;
      });
      
      const analysis = document.getElementById('tokenAnalysis');
      analysis.innerHTML = Object.entries(unitTotals).map(([unit, total]) => {
        const isHigh = total > 500000;
        return `
          <div class="zea-token-item ${isHigh ? 'zea-token-high' : 'zea-token-normal'}">
            <div><strong>${unit}</strong> - ${this.formatRupiah(total)}/bulan</div>
            ${isHigh ? '<span class="badge badge-danger">BOROS</span>' : '<span class="badge badge-success">Normal</span>'}
          </div>
        `;
      }).join('') || '<div class="empty-state">Belum ada data</div>';
    },
    
    saveToken: function(e) {
      e.preventDefault();
      
      const id = this.editingTokenId || Date.now().toString();
      const tokenData = {
        unit: document.getElementById('tokenUnit').value,
        tanggal: document.getElementById('tokenDate').value,
        nominal: parseInt(document.getElementById('tokenNominal').value) || 0,
        meteran: document.getElementById('tokenMeteran').value,
        keterangan: document.getElementById('tokenKet').value,
        inputBy: currentUser.name || currentUser.username,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      };
      
      db.ref(`zeacrew/token/${id}`).set(tokenData);
      this.resetTokenForm();
      return false;
    },
    
    editToken: function(id) {
      const t = this.data.token[id];
      if (!t) return;
      
      this.editingTokenId = id;
      document.getElementById('tokenUnit').value = t.unit;
      document.getElementById('tokenDate').value = t.tanggal;
      document.getElementById('tokenNominal').value = t.nominal;
      document.getElementById('tokenMeteran').value = t.meteran || '';
      document.getElementById('tokenKet').value = t.keterangan || '';
      document.getElementById('tokenFormTitle').textContent = ' Edit Token';
      document.getElementById('cancelTokenEdit').style.display = 'inline-block';
    },
    
    deleteToken: function(id) {
      if (!confirm('Hapus data token ini?')) return;
      db.ref(`zeacrew/token/${id}`).remove();
    },
    
    resetTokenForm: function() {
      this.editingTokenId = null;
      document.getElementById('tokenForm').reset();
      const today = new Date();
      document.getElementById('tokenDate').value = today.toISOString().split('T')[0];
      document.getElementById('tokenFormTitle').textContent = 'Form Input Token Listrik';
      document.getElementById('cancelTokenEdit').style.display = 'none';
    },
    
    // ===== PENGAJUAN FUNCTIONS =====
    filterPengajuan: function(filter) {
      this.currentFilter = filter;
      document.querySelectorAll('#pengajuanTabs .zea-tab-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === filter);
      });
      this.renderPengajuan();
    },
    
    renderPengajuan: function() {
      let items = Object.entries(this.data.pengajuan);
      
      if (this.currentFilter !== 'semua') {
        items = items.filter(([id, p]) => p.jenis === this.currentFilter);
      }
      
      // Staff can only see their own
      if (currentUser.role === 'staff' || currentUser.role === 'marketing') {
        items = items.filter(([id, p]) => p.nama === (currentUser.name || currentUser.username));
      }
      
      items.sort((a, b) => (b[1].timestamp || 0) - (a[1].timestamp || 0));
      
      const tbody = document.getElementById('pengajuanTable');
      tbody.innerHTML = items.map(([id, p]) => {
        const statusBadge = {
          pending: '<span class="badge badge-warning"> Pending</span>',
          approved: '<span class="badge badge-success"> Approved</span>',
          rejected: '<span class="badge badge-danger"> Rejected</span>'
        }[p.status] || p.status;
        
        let detail = '';
        if (p.jenis === 'kasbon') detail = `${this.formatRupiah(p.nominal)}`;
        else if (p.jenis === 'cuti') detail = `${p.durasi} hari`;
        else if (p.jenis === 'reimburse') detail = `${this.formatRupiah(p.nominal)}`;
        
        return `
          <tr>
            <td>${p.tanggal || '-'}</td>
            <td>${p.nama || '-'}</td>
            <td>${p.jenis === 'kasbon' ? ' Kasbon' : p.jenis === 'cuti' ? ' Cuti' : ' Reimburse'}</td>
            <td>${detail}</td>
            <td>${statusBadge}</td>
            <td>
              ${currentUser.role !== 'staff' && currentUser.role !== 'marketing' ? `
                ${p.status === 'pending' ? `
                  <button class="btn btn-success btn-sm" onclick="ZeaApp.approvePengajuan('${id}')"></button>
                  <button class="btn btn-danger btn-sm" onclick="ZeaApp.rejectPengajuan('${id}')"></button>
                ` : ''}
              ` : ''}
            </td>
          </tr>
        `;
      }).join('') || '<tr><td colspan="6" class="table-empty">Belum ada pengajuan</td></tr>';
    },
    
    showPengajuanModal: function() {
      this.showModal('pengajuanModal');
    },
    
    onPengajuanJenisChange: function() {
      const jenis = document.getElementById('pJenis').value;
      document.getElementById('pNominalG').style.display = jenis === 'cuti' ? 'none' : 'block';
      document.getElementById('pDurasiG').style.display = jenis === 'cuti' ? 'block' : 'none';
      document.getElementById('pBuktiG').style.display = jenis === 'reimburse' ? 'block' : 'none';
    },
    
    savePengajuan: function() {
      const jenis = document.getElementById('pJenis').value;
      const pengajuanData = {
        id: Date.now().toString(),
        jenis,
        nama: currentUser.name || currentUser.username,
        tanggal: new Date().toISOString().split('T')[0],
        status: 'pending',
        timestamp: firebase.database.ServerValue.TIMESTAMP
      };
      
      if (jenis === 'kasbon' || jenis === 'reimburse') {
        pengajuanData.nominal = parseInt(document.getElementById('pNominal').value) || 0;
      }
      if (jenis === 'cuti') {
        pengajuanData.durasi = parseInt(document.getElementById('pDurasi').value) || 1;
      }
      if (jenis === 'reimburse') {
        pengajuanData.bukti = document.getElementById('pBukti').value;
      }
      pengajuanData.keterangan = document.getElementById('pKet').value;
      
      db.ref(`zeacrew/pengajuan/${pengajuanData.id}`).set(pengajuanData);
      this.hideModal('pengajuanModal');
      document.getElementById('pJenis').value = 'kasbon';
      document.getElementById('pNominal').value = '0';
      document.getElementById('pDurasi').value = '1';
      document.getElementById('pKet').value = '';
      document.getElementById('pBukti').value = '';
    },
    
    approvePengajuan: function(id) {
      db.ref(`zeacrew/pengajuan/${id}/status`).set('approved');
    },
    
    rejectPengajuan: function(id) {
      db.ref(`zeacrew/pengajuan/${id}/status`).set('rejected');
    },
    
    // ===== REPORT FUNCTIONS =====
    renderReport: function() {
      const reports = Object.entries(this.data.report).sort((a, b) => (b[1].timestamp || 0) - (a[1].timestamp || 0));
      
      const tbody = document.getElementById('reportTable');
      tbody.innerHTML = reports.map(([id, r]) => {
        const priorityBadge = {
          low: '<span class="badge badge-success"> Rendah</span>',
          medium: '<span class="badge badge-warning"> Sedang</span>',
          high: '<span class="badge badge-danger"> Tinggi</span>'
        }[r.priority] || r.priority;
        
        const statusBadge = {
          open: '<span class="badge badge-warning"> Open</span>',
          progress: '<span class="badge badge-cyan"> Progress</span>',
          done: '<span class="badge badge-success"> Done</span>'
        }[r.status] || r.status;
        
        return `
          <tr>
            <td>${r.tanggal || '-'}</td>
            <td>${r.unit || '-'}</td>
            <td>${priorityBadge}</td>
            <td>${r.deskripsi || '-'}</td>
            <td>${r.reporter || '-'}</td>
            <td>
              ${statusBadge}
              ${currentUser.role !== 'staff' && currentUser.role !== 'marketing' ? `
                <select onchange="ZeaApp.updateReportStatus('${id}', this.value)" style="margin-left:8px;padding:4px 8px;border-radius:4px;border:1px solid var(--border-color);background:var(--bg-input);color:var(--text-primary);">
                  <option value="">Update...</option>
                  <option value="open">Open</option>
                  <option value="progress">Progress</option>
                  <option value="done">Done</option>
                </select>
              ` : ''}
            </td>
          </tr>
        `;
      }).join('') || '<tr><td colspan="6" class="table-empty">Belum ada report</td></tr>';
    },
    
    saveReport: function(e) {
      e.preventDefault();
      
      const reportData = {
        id: Date.now().toString(),
        unit: document.getElementById('reportUnit').value,
        priority: document.getElementById('reportPriority').value,
        deskripsi: document.getElementById('reportDesc').value,
        reporter: currentUser.name || currentUser.username,
        tanggal: new Date().toISOString().split('T')[0],
        status: 'open',
        timestamp: firebase.database.ServerValue.TIMESTAMP
      };
      
      db.ref(`zeacrew/report/${reportData.id}`).set(reportData);
      document.getElementById('reportForm').reset();
      return false;
    },
    
    updateReportStatus: function(id, status) {
      if (!status) return;
      db.ref(`zeacrew/report/${id}/status`).set(status);
    },
    
    // ===== ABSENSI FUNCTIONS =====
    renderAbsensi: function() {
      const absensi = Object.entries(this.data.absensi).sort((a, b) => (b[1].timestamp || 0) - (a[1].timestamp || 0));
      
      const tbody = document.getElementById('absensiTable');
      tbody.innerHTML = absensi.map(([id, a]) => {
        const statusBadge = {
          hadir: '<span class="badge badge-success"> HADIR</span>',
          izin: '<span class="badge badge-warning"> IZIN</span>',
          sakit: '<span class="badge badge-cyan"> SAKIT</span>',
          alfa: '<span class="badge badge-danger"> ALFA</span>',
          libur: '<span class="badge badge-purple"> LIBUR</span>'
        }[a.status] || a.status;
        
        return `
          <tr>
            <td>${a.tanggal || '-'}</td>
            <td>${a.nama || '-'}</td>
            <td>${statusBadge}</td>
            <td>${a.jamMasuk || '-'} - ${a.jamPulang || '-'}</td>
            <td>${a.jamAktual || '-'}</td>
            <td>${a.terlambat || '-'}</td>
            <td style="color:var(--accent-danger);font-weight:600;">${a.potongan ? '-' + this.formatRupiah(a.potongan) : '-'}</td>
          </tr>
        `;
      }).join('') || '<tr><td colspan="7" class="table-empty">Belum ada data absensi</td></tr>';
    },
    
    updateAbsensiPreview: function() {
      document.getElementById('absensiPreview').dataset.potongan = '0';
      document.getElementById('absensiPreview').style.display = 'none';
      const staffId = document.getElementById('absensiStaff').value;
      const status = document.getElementById('absensiStatus').value;
      const aktual = document.getElementById('absensiAktual').value;
      
      if (!staffId) return;
      
      const staff = this.data.staff[staffId];
      if (!staff) return;
      
      const jamMasuk = staff.jamMasuk || '08:00';
      let preview = '';
      
      if (status === 'hadir' && aktual) {
        const [masukH, masukM] = jamMasuk.split(':').map(Number);
        const [aktualH, aktualM] = aktual.split(':').map(Number);
        
        const masukMinutes = masukH * 60 + masukM;
        const aktualMinutes = aktualH * 60 + aktualM;
        const diffMinutes = aktualMinutes - masukMinutes;
        
        let potongan = 0;
        if (diffMinutes <= 10) {
          preview = ` Tepat waktu (0-10 menit) - Tidak ada potongan`;
        } else if (diffMinutes <= 30) {
          potongan = 25000;
          preview = ` Terlambat ${diffMinutes} menit (11-30 menit) - Potongan Rp 25.000`;
        } else {
          const gajiPerHari = (staff.gaji || 3000000) / 26;
          potongan = Math.round(gajiPerHari);
          preview = ` Terlambat ${diffMinutes} menit (>30 menit) - Potongan 1 hari kerja (${this.formatRupiah(potongan)})`;
        }
        
        document.getElementById('absensiPreview').dataset.potongan = potongan;
      } else if (status === 'izin' || status === 'sakit' || status === 'alfa') {
        const gajiPerHari = (staff.gaji || 3000000) / 26;
        const potongan = Math.round(gajiPerHari);
        preview = ` Status ${status.toUpperCase()} - Potongan 1 hari kerja (${this.formatRupiah(potongan)})`;
        document.getElementById('absensiPreview').dataset.potongan = potongan;
      } else if (status === 'libur') {
        preview = ` LIBUR - Tidak ada potongan`;
        document.getElementById('absensiPreview').dataset.potongan = 0;
      }
      
      document.getElementById('absensiPreview').innerHTML = preview;
      document.getElementById('absensiPreview').style.display = preview ? 'block' : 'none';
    },
    
    saveAbsensi: function(e) {
      e.preventDefault();
      
      const staffId = document.getElementById('absensiStaff').value;
      const staff = this.data.staff[staffId];
      if (!staff) return false;
      
      const status = document.getElementById('absensiStatus').value;
      const potongan = parseInt(document.getElementById('absensiPreview').dataset.potongan) || 0;
      
      const absensiData = {
        id: Date.now().toString(),
        staffId,
        nama: staff.nama,
        tanggal: document.getElementById('absensiDate').value,
        status,
        jamMasuk: staff.jamMasuk || '08:00',
        jamPulang: staff.jamPulang || '17:00',
        jamAktual: document.getElementById('absensiAktual').value || null,
        terlambat: this.calculateTerlambat(staff.jamMasuk, document.getElementById('absensiAktual').value),
        potongan,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      };
      
      db.ref(`zeacrew/absensi/${absensiData.id}`).set(absensiData);
      document.getElementById('absensiForm').reset();
      document.getElementById('absensiPreview').style.display = 'none';
      return false;
    },
    
    calculateTerlambat: function(jamMasuk, jamAktual) {
      if (!jamMasuk || !jamAktual) return null;
      
      const [masukH, masukM] = jamMasuk.split(':').map(Number);
      const [aktualH, aktualM] = jamAktual.split(':').map(Number);
      
      const masukMinutes = masukH * 60 + masukM;
      const aktualMinutes = aktualH * 60 + aktualM;
      const diff = aktualMinutes - masukMinutes;
      
      if (diff <= 0) return 'Tepat waktu';
      return `${diff} menit`;
    },
    
    // ===== GAJI FUNCTIONS =====
    calcGaji: function() {
      const staffId = document.getElementById('gajiStaff').value;
      const bulan = parseInt(document.getElementById('gajiBulan').value);
      
      if (!staffId) {
        document.getElementById('slipContainer').style.display = 'none';
        return;
      }
      
      const staff = this.data.staff[staffId];
      if (!staff) return;
      
      const gajiPokok = staff.gaji || 3000000;
      const uangMakanPerHari = staff.makan || 20000;
      
      // Calculate period (27 last month to 26 this month)
      const now = new Date();
      const tahun = now.getFullYear();
      const periodeStart = new Date(tahun, bulan - 1, 27);
      const periodeEnd = new Date(tahun, bulan, 26);
      
      // Get absensi for this period
      const absensi = Object.values(this.data.absensi).filter(a => {
        if (!a.tanggal || a.staffId !== staffId) return false;
        const t = new Date(a.tanggal);
        return t >= periodeStart && t <= periodeEnd;
      });
      
      let hariMasuk = 0, hariLibur = 0;
      let potonganTerlambat = 0, potonganAbsen = 0;
      
      absensi.forEach(a => {
        if (a.status === 'hadir') {
          hariMasuk++;
          potonganTerlambat += a.potongan || 0;
        } else if (a.status === 'libur') {
          hariLibur++;
        } else if (a.status === 'izin' || a.status === 'sakit' || a.status === 'alfa') {
          potonganAbsen += a.potongan || 0;
        }
      });
      
      const totalUangMakan = hariMasuk * uangMakanPerHari;
      const potonganKasbon = parseInt(document.getElementById('gajiKasbon').value) || 0;
      const potonganGantiRugi = parseInt(document.getElementById('gajiGantiRugi').value) || 0;
      
      const totalPotongan = potonganTerlambat + potonganAbsen + potonganKasbon + potonganGantiRugi;
      const gajiBersih = gajiPokok - totalPotongan;
      
      // Update slip
      document.getElementById('slipPeriode').textContent = `${periodeStart.toLocaleDateString('id-ID')} - ${periodeEnd.toLocaleDateString('id-ID')}`;
      document.getElementById('slipNama').textContent = staff.nama;
      document.getElementById('slipGaji').textContent = this.formatRupiah(gajiPokok);
      document.getElementById('slipHari').textContent = hariMasuk;
      document.getElementById('slipMakan').textContent = this.formatRupiah(totalUangMakan) + ' (Cash)';
      document.getElementById('slipTelat').textContent = '- ' + this.formatRupiah(potonganTerlambat);
      document.getElementById('slipAbsen').textContent = '- ' + this.formatRupiah(potonganAbsen);
      document.getElementById('slipKasbon').textContent = '- ' + this.formatRupiah(potonganKasbon);
      document.getElementById('slipGantiRugi').textContent = '- ' + this.formatRupiah(potonganGantiRugi);
      document.getElementById('slipBersih').textContent = this.formatRupiah(gajiBersih);
      
      document.getElementById('slipContainer').style.display = 'block';
      
      // Store for WA
      this.currentGajiData = {
        staff,
        periode: `${periodeStart.toLocaleDateString('id-ID')} - ${periodeEnd.toLocaleDateString('id-ID')}`,
        gajiPokok,
        hariMasuk,
        totalUangMakan,
        potonganTerlambat,
        potonganAbsen,
        potonganKasbon,
        potonganGantiRugi,
        gajiBersih
      };
    },
    
    sendWA: function() {
      if (!this.currentGajiData) return;
      
      const d = this.currentGajiData;
      const message = ` *SLIP GAJI ZEA PROPERTY*\n\n` +
        ` *Nama:* ${d.staff.nama}\n` +
        ` *Periode:* ${d.periode}\n\n` +
        ` *Gaji Pokok:* ${this.formatRupiah(d.gajiPokok)}\n` +
        ` *Hari Masuk:* ${d.hariMasuk}\n` +
        ` *Uang Makan:* ${this.formatRupiah(d.totalUangMakan)} (Cash)\n\n` +
        `*POTONGAN:*\n` +
        ` Terlambat: -${this.formatRupiah(d.potonganTerlambat)}\n` +
        ` Absen: -${this.formatRupiah(d.potonganAbsen)}\n` +
        ` Kasbon: -${this.formatRupiah(d.potonganKasbon)}\n` +
        ` Ganti Rugi: -${this.formatRupiah(d.potonganGantiRugi)}\n\n` +
        ` *GAJI TRANSFER:* *${this.formatRupiah(d.gajiBersih)}*\n\n` +
        `Terima kasih atas kerja kerasnya! `;
      
      const waUrl = `https://wa.me/${d.staff.wa}?text=${encodeURIComponent(message)}`;
      window.open(waUrl, '_blank');
    },
    
    saveGaji: function() {
      if (!this.currentGajiData) return;
      
      const gajiData = { id: Date.now().toString() };
      const gajiRecord = {
        id: gajiData.id,
        staffId: document.getElementById('gajiStaff').value,
        staffNama: this.currentGajiData.staff.nama,
        bulan: document.getElementById('gajiBulan').value,
        tahun: new Date().getFullYear(),
        periode: this.currentGajiData.periode,
        gajiPokok: this.currentGajiData.gajiPokok,
        hariMasuk: this.currentGajiData.hariMasuk,
        totalUangMakan: this.currentGajiData.totalUangMakan,
        potonganTerlambat: this.currentGajiData.potonganTerlambat,
        potonganAbsen: this.currentGajiData.potonganAbsen,
        potonganKasbon: this.currentGajiData.potonganKasbon,
        potonganGantiRugi: this.currentGajiData.potonganGantiRugi,
        gajiBersih: this.currentGajiData.gajiBersih,
        timestamp: firebase.database.ServerValue.TIMESTAMP,
        processedBy: currentUser.username
      };
      db.ref('zeacrew/gaji/' + gajiRecord.id).set(gajiRecord);
      alert('Data gaji berhasil disimpan!');
    },
    
    showEditGajiModal: function() {
      const staffId = document.getElementById('gajiStaff').value;
      if (!staffId) {
        alert('Pilih staff terlebih dahulu!');
        return;
      }
      
      const staff = this.data.staff[staffId];
      document.getElementById('editGajiStaffId').value = staffId;
      document.getElementById('editGajiStaffName').textContent = staff.nama;
      document.getElementById('editGajiPokok').value = staff.gaji || 3000000;
      document.getElementById('editGajiMakan').value = staff.makan || 20000;
      this.showModal('editGajiModal');
    },
    
    saveEditGaji: function() {
      const staffId = document.getElementById('editGajiStaffId').value;
      const gaji = parseInt(document.getElementById('editGajiPokok').value) || 3000000;
      const makan = parseInt(document.getElementById('editGajiMakan').value) || 20000;
      
      db.ref(`zeacrew/staff/${staffId}/gaji`).set(gaji);
      db.ref(`zeacrew/staff/${staffId}/makan`).set(makan);
      
      this.hideModal('editGajiModal');
      alert('Data gaji berhasil diupdate!');
      this.calcGaji();
    },
    
    // ===== AKUN FUNCTIONS =====
    renderAkun: function() {
      const tbody = document.getElementById('akunTable');
      const akun = Object.entries(this.data.akun);
      
      tbody.innerHTML = akun.map(([id, a]) => `
        <tr>
          <td>${a.username || '-'}</td>
          <td><span class="badge badge-${a.role === 'owner' ? 'warning' : a.role === 'admin' ? 'cyan' : 'primary'}">${a.role}</span></td>
          <td><span class="badge badge-success">Active</span></td>
          <td>
            ${currentUser.role === 'owner' || currentUser.role === 'admin' ? `
              <button class="btn btn-danger btn-sm" onclick="ZeaApp.deleteAkun('${id}')">Hapus</button>
            ` : '-'}
          </td>
        </tr>
      `).join('') || '<tr><td colspan="4" class="table-empty">Belum ada akun</td></tr>';
    },
    
    showAkunModal: function() {
      this.showModal('akunModal');
    },
    
    saveAkun: function() {
      const akunData = {
        id: Date.now().toString(),
        username: document.getElementById('aUser').value,
        password: document.getElementById('aPass').value,
        role: document.getElementById('aRole').value,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      };
      
      db.ref(`zeacrew/akun/${akunData.id}`).set(akunData);
      this.hideModal('akunModal');
      document.getElementById('aUser').value = '';
      document.getElementById('aPass').value = '';
      document.getElementById('aRole').value = 'staff';
    },
    
    deleteAkun: function(id) {
      if (!confirm('Hapus akun ini?')) return;
      db.ref(`zeacrew/akun/${id}`).remove();
    },
    
    // ===== HELPER FUNCTIONS =====
    populateStaffSelects: function() {
      const absensiStaff = document.getElementById('absensiStaff');
      const gajiStaff = document.getElementById('gajiStaff');
      
      absensiStaff.innerHTML = '<option value="">Pilih Staff</option>';
      gajiStaff.innerHTML = '<option value="">Pilih Staff</option>';
      
      Object.entries(this.data.staff).forEach(([id, s]) => {
        absensiStaff.innerHTML += `<option value="${id}">${s.nama}</option>`;
        gajiStaff.innerHTML += `<option value="${id}">${s.nama}</option>`;
      });
    },
    
    populateUnitSelects: function() {
      const tokenUnit = document.getElementById('tokenUnit');
      const reportUnit = document.getElementById('reportUnit');
      const filterTokenUnit = document.getElementById('filterTokenUnit');
      
      tokenUnit.innerHTML = '<option value="">Pilih Unit</option>';
      reportUnit.innerHTML = '<option value="">Pilih Unit</option>';
      filterTokenUnit.innerHTML = '<option value="">Semua Unit</option>';
      
      Object.values(this.data.unit).forEach(u => {
        tokenUnit.innerHTML += `<option value="${u.nomor}">${u.nomor}</option>`;
        reportUnit.innerHTML += `<option value="${u.nomor}">${u.nomor}</option>`;
        filterTokenUnit.innerHTML += `<option value="${u.nomor}">${u.nomor}</option>`;
      });
    },
    
    populateAkunSelects: function() {
      const sAkun = document.getElementById('sAkun');
      sAkun.innerHTML = '<option value="">Pilih Akun (opsional)</option>';
      
      Object.entries(this.data.akun).forEach(([id, a]) => {
        sAkun.innerHTML += `<option value="${id}">${a.username} (${a.role})</option>`;
      });
    },
    
    showModal: function(modalId) {
      document.getElementById(modalId).classList.add('active');
    },
    
    hideModal: function(modalId) {
      document.getElementById(modalId).classList.remove('active');
    },
    
    formatRupiah: function(amount) {
      return 'Rp ' + (amount || 0).toLocaleString('id-ID');
    },
    
    escapeHtml: function(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  };

  /* ============================================================
     CORE INITIALIZATION
     ============================================================ */
  const Core = {
    init: function() {
      // Initialize any global event listeners
      document.addEventListener('DOMContentLoaded', () => {
        // Check for saved session
        const savedUser = localStorage.getItem('zeaUser');
        if (savedUser) {
          try {
            const userData = JSON.parse(savedUser);
            // Could auto-login here if needed
          } catch (e) {
            localStorage.removeItem('zeaUser');
          }
        }
      });
      
      // Handle visibility change for online status
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          // User left the page
        } else {
          // User returned - refresh data
          if (currentApp === 'saldozea' && SaldoApp.updateDashboard) {
            SaldoApp.updateDashboard();
          } else if (currentApp === 'zeacrew' && ZeaApp.updateDashboardStats) {
            ZeaApp.updateDashboardStats();
          }
        }
      });
      
      // Prevent zoom on iOS double-tap
      let lastTouchEnd = 0;
      document.addEventListener('touchend', (e) => {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) {
          e.preventDefault();
        }
        lastTouchEnd = now;
      }, false);
    }
  };
  
  // Initialize Core
  Core.init();
  </script>

</body>
</html>
